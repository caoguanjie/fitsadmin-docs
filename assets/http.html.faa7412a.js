import{J as k,M as u,K as d,L as m,N as n,O as a,T as t,P as s,Q as l}from"./clientConfigs.7ea3e47f.js";var v="/fitsadmin-docs/images/20220823045254.png",b="/fitsadmin-docs/images/20220823045745.png";const g={},f=n("h1",{id:"http\u670D\u52A1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#http\u670D\u52A1","aria-hidden":"true"},"#"),s(" HTTP\u670D\u52A1")],-1),y=n("h2",{id:"\u524D\u8A00",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u524D\u8A00","aria-hidden":"true"},"#"),s(" \u524D\u8A00")],-1),h=s("\u5728\u524D\u540E\u7AEF\u5206\u79BB\u7684\u9879\u76EE\u4E2D\uFF0C\u6211\u4E2A\u4EBA\u8BA4\u4E3Ahttp\u534F\u8BAE\u662F\u6700\u91CD\u8981\u7684\u4E00\u73AF\uFF0C\u5B83\u662F\u524D\u540E\u7AEF\u6C9F\u901A\u7684\u6865\u6881\uFF0C\u4E5F\u662F\u6570\u636E\u52A8\u6001\u5316\u7684\u552F\u4E00\u9014\u5F84\uFF0C\u6240\u4EE5\u6BCF\u4E00\u4E2A\u65B0\u6846\u67B6\u642D\u5EFA\u7684\u65F6\u5019\uFF0Chttp\u670D\u52A1\u7684\u5C01\u88C5\u6C38\u8FDC\u90FD\u662F\u6211\u82B1\u8D39\u6700\u591A\u5FC3\u601D\u7684\u6A21\u5757\u3002\u672C\u6B21ionic5\u7684\u6846\u67B6\u4E5F\u4E0D\u4F8B\u5916\uFF0Cionic5 Vue\u7248\u672C\uFF0C\u6BEB\u65E0\u7591\u95EE\u662F\u91C7\u7528\u5B83\u7684\u8001\u670B\u53CB"),w=n("code",null,"axios",-1),x=s(",\u5B83\u662F\u57FA\u4E8Epromise\u7684http\u5E93\uFF0C\u53EF\u8FD0\u884C\u5728\u6D4F\u89C8\u5668\u7AEF\u548Cnode.js\u4E2D\u3002\u4ED6\u6709\u5F88\u591A\u4F18\u79C0\u7684\u7279\u6027\uFF0C\u4F8B\u5982\u62E6\u622A\u8BF7\u6C42\u548C\u54CD\u5E94\u3001\u53D6\u6D88\u8BF7\u6C42\u3001\u8F6C\u6362json\u3001\u5BA2\u6237\u7AEF\u9632\u5FA1XSRF\u7B49\u3002\u6240\u4EE5\u6211\u4EEC\u7684\u5C24\u5927\u5927\u4E5F\u662F\u679C\u65AD\u653E\u5F03\u4E86\u5BF9\u5176\u5B98\u65B9\u5E93vue-resource\u7684\u7EF4\u62A4\uFF0C\u76F4\u63A5\u63A8\u8350\u6211\u4EEC\u4F7F\u7528axios\u5E93\u3002\u5982\u679C\u8FD8\u5BF9axios\u4E0D\u4E86\u89E3\u7684\uFF0C\u53EF\u4EE5\u79FB\u6B65"),R={href:"https://axios-http.com/zh/docs/intro",target:"_blank",rel:"noopener noreferrer"},E=s("axios\u6587\u6863"),A=s("\u3002"),_=l("\u5728\u8FD9\u91CC\u6211\u53EF\u80FD\u8981\u591A\u5570\u55E6\u51E0\u53E5\uFF0C\u8FD9\u6B21\u5C01\u88C5http\u7ED9\u6211\u7684\u611F\u89E6\u5F88\u5927\uFF0C\u56E0\u4E3A\u6211\u4E24\u5E74\u524D\u7528angular2+\u5C01\u88C5\u4E86http\u670D\u52A1\uFF0C\u901A\u8FC7\u5BF9\u6BD4\u53D1\u73B0\u8FD9\u4E24\u8005\u7684\u533A\u522B\u5F88\u5927\uFF0Cangular2+ \u7ED9\u5E94\u7528\u63D0\u4F9B\u4E86\u4E00\u4E2A HTTP \u5BA2\u6237\u7AEF API\uFF0C\u4E5F\u5C31\u662F <code>@angular/common/http</code> \u4E2D\u7684 <code>HttpClient</code> \u670D\u52A1\u7C7B\u3002\u5B83\u57FA\u4E8E\u6D4F\u89C8\u5668\u63D0\u4F9B\u7684 <code>XMLHttpRequest</code> \u63A5\u53E3\u3002 <code>HttpClient</code> \u5E26\u6765\u7684\u5176\u5B83\u4F18\u70B9\u5305\u62EC\uFF1A\u53EF\u6D4B\u8BD5\u6027\u3001\u5F3A\u7C7B\u578B\u7684\u8BF7\u6C42\u548C\u54CD\u5E94\u5BF9\u8C61\u3001\u53D1\u8D77\u8BF7\u6C42\u4E0E\u63A5\u6536\u54CD\u5E94\u65F6\u7684\u62E6\u622A\u5668\u652F\u6301\uFF0C\u4EE5\u53CA\u66F4\u597D\u7684\u3001\u57FA\u4E8E\u53EF\u89C2\u5BDF<code>\uFF08Observable\uFF09</code>\u5BF9\u8C61\u7684 API \u4EE5\u53CA\u6D41\u5F0F\u9519\u8BEF\u5904\u7406\u673A\u5236\u3002\u5728\u6700\u65B0angular\u7684\u5B98\u65B9\u6587\u6863\u4E0A\uFF0C <code>HttpClient</code> \u548C <code>Rxjs</code>\u7ED3\u5408\u8D8A\u6765\u8D8A\u7D27\u5BC6\u4E86\uFF0C\u5982\u679C\u8FD8\u5BF9Rxjs\u4E0D\u4E86\u89E3\u7684\uFF0C\u53EF\u4EE5\u79FB\u6B65",15),C={href:"https://cn.rx.js.org/",target:"_blank",rel:"noopener noreferrer"},T=s("Rxjs\u6587\u6863"),q=l(`<p>\u603B\u7ED3\u4E00\u4E0B\u5C31\u662Fvue\u662Faxios\u5E93\u7684<code>Promise</code>\uFF08\u627F\u8BFA\uFF09\uFF0Cangular2+\u662F\u7528<code>Observable</code>\uFF08\u53EF\u89C2\u5BDF\u8005\u5BF9\u8C61\uFF09.</p><div class="custom-container info"><p class="custom-container-title">\u53EF\u89C2\u5BDF\u5BF9\u8C61(Observable) vs \u627F\u8BFA(Promise)</p><p>\u53EF\u89C2\u5BDF\u5BF9\u8C61\u7ECF\u5E38\u62FF\u6765\u548C\u627F\u8BFA\u8FDB\u884C\u5BF9\u6BD4\u3002\u6709\u4E00\u4E9B\u5173\u952E\u7684\u4E0D\u540C\u70B9\uFF1A</p><ul><li>\u53EF\u89C2\u5BDF\u5BF9\u8C61\u662F\u58F0\u660E\u5F0F\u7684\uFF0C\u5728\u88AB\u8BA2\u9605\u4E4B\u524D\uFF0C\u5B83\u4E0D\u4F1A\u5F00\u59CB\u6267\u884C\u3002\u627F\u8BFA\u662F\u5728\u521B\u5EFA\u65F6\u5C31\u7ACB\u5373\u6267\u884C\u7684\u3002\u8FD9\u8BA9\u53EF\u89C2\u5BDF\u5BF9\u8C61\u53EF\u7528\u4E8E\u5B9A\u4E49\u90A3\u4E9B\u5E94\u8BE5\u6309\u9700\u6267\u884C\u7684\u83DC\u8C31\u3002</li><li>\u53EF\u89C2\u5BDF\u5BF9\u8C61\u80FD\u63D0\u4F9B\u591A\u4E2A\u503C\u3002\u627F\u8BFA\u53EA\u63D0\u4F9B\u4E00\u4E2A\u3002\u8FD9\u8BA9\u53EF\u89C2\u5BDF\u5BF9\u8C61\u53EF\u7528\u4E8E\u968F\u7740\u65F6\u95F4\u7684\u63A8\u79FB\u83B7\u53D6\u591A\u4E2A\u503C\u3002</li><li>\u53EF\u89C2\u5BDF\u5BF9\u8C61\u4F1A\u533A\u5206\u4E32\u8054\u5904\u7406\u548C\u8BA2\u9605\u8BED\u53E5\u3002\u627F\u8BFA\u53EA\u6709 <code>.then()</code> \u8BED\u53E5\u3002\u8FD9\u8BA9\u53EF\u89C2\u5BDF\u5BF9\u8C61\u53EF\u7528\u4E8E\u521B\u5EFA\u4F9B\u7CFB\u7EDF\u7684\u5176\u5B83\u90E8\u5206\u4F7F\u7528\u800C\u4E0D\u5E0C\u671B\u7ACB\u5373\u6267\u884C\u7684\u590D\u6742\u83DC\u8C31\u3002</li><li>\u53EF\u89C2\u5BDF\u5BF9\u8C61\u7684 <code>subscribe()</code> \u4F1A\u8D1F\u8D23\u5904\u7406\u9519\u8BEF\u3002\u627F\u8BFA\u4F1A\u628A\u9519\u8BEF\u63A8\u9001\u7ED9\u5B83\u7684\u5B50\u627F\u8BFA\u3002\u8FD9\u8BA9\u53EF\u89C2\u5BDF\u5BF9\u8C61\u53EF\u7528\u4E8E\u8FDB\u884C\u96C6\u4E2D\u5F0F\u3001\u53EF\u9884\u6D4B\u7684\u9519\u8BEF\u5904\u7406\u3002</li></ul></div><h5 id="\u5982\u679C\u770B\u6210\u72B6\u6001\u673A" tabindex="-1"><a class="header-anchor" href="#\u5982\u679C\u770B\u6210\u72B6\u6001\u673A" aria-hidden="true">#</a> \u5982\u679C\u770B\u6210\u72B6\u6001\u673A</h5><ul><li>Promise \u5177\u6709 3 \u4E2A\u72B6\u6001\uFF1Apending\u3001resolved\u3001rejected\uFF08\u5982\u679C Cancelable Promise \u6B63\u5F0F\u901A\u8FC7\uFF0C\u90A3\u4E48\u8FD8\u4F1A\u589E\u52A0\u4E00\u4E2A\u72B6\u6001\uFF09\u3002</li><li>Observable \u6709 N + 3 \u4E2A\u72B6\u6001\uFF1Aidle\u3001pending\u3001resolved_0\u3001resolved_1 \u2026 resolved_N\u3001completed \u548C error\u3002</li></ul><p>\u603B\u7ED3\uFF1A\u76F8\u6BD4\u4E8E Promise \u8FD9\u4E2A\u6709\u9650\u72B6\u6001\u673A\u800C\u8A00\uFF0CObservable \u65E2\u53EF\u80FD\u662F\u6709\u9650\u72B6\u6001\u673A\uFF0C\u4E5F\u53EF\u80FD\u662F\u65E0\u9650\u72B6\u6001\u673A\uFF08N \u4E3A\u65E0\u7A77\uFF09\u3002</p><p>\u6211\u4E2A\u4EBA\u7528\u4E86promise\u548CObservable\u4E24\u8005\u4E4B\u540E\uFF0C\u6211\u7B80\u5355\u7684\u3001\u7C97\u7565\u5730\u53D1\u8868\u4E00\u4E9B\u610F\u89C1\uFF0C\u4E0D\u4E00\u5B9A\u767E\u5206\u767E\u5BF9\uFF0C\u53EF\u4EE5\u4F5C\u4E3A\u5927\u5BB6\u7684\u4E00\u4E2A\u53C2\u8003\u601D\u8DEF\uFF0C\u6211\u8BA4\u4E3AObservable\u5C31\u60F3\u4E00\u4E2A\u5DE5\u4F5C\u6D41\uFF0C\u5F53\u7528\u6237\u6267\u884C<code>subscribe</code>\u8BA2\u9605\u4E4B\u540E\uFF0C\u6570\u636E\u88AB\u521B\u5EFA\uFF0C\u5230\u4F20\u8F93\u5230<code>subscribe</code>\u63A5\u53E3\u8FD9\u6BB5\u65F6\u95F4\u4E4B\u95F4\uFF0CObservable\u53EF\u4EE5\u7528\u5F88\u591A\u64CD\u4F5C\u7B26\u53F7\uFF0C\u4F8B\u5982<code>map()</code>\u3001<code>do()</code>\u7B49\u7B49\u65B9\u5F0F\uFF0C\u5BF9\u6570\u636E\u8FDB\u884C\u4F18\u96C5\u7684\u5904\u7406\uFF0C\u7136\u540E\u8FD4\u56DE\u7528\u6237\u60F3\u8981\u7684\u6570\u636E\u3002\u5C31\u4F8B\u5982\u4E00\u5934\u732A\u88AB\u5BB0\u4E86\u4E4B\u540E\uFF0C\u653E\u5728\u5C60\u5BB0\u573A\u7684\u5DE5\u4F5C\u53F0\u6D41\u6C34\u7EBF\u4E0A\u8FDB\u884C\u5207\u5272\u3001\u5206\u62E3\u3001\u6E05\u6D17\u3001\u5305\u88C5\u4E4B\u540E\uFF0C\u518D\u62C9\u5230\u8D85\u5E02\u4E0A\u8D29\u5356\u7684\u8FC7\u7A0B\u4E00\u6837\uFF0C<code>subscribe</code>\u65B9\u6CD5\u62FF\u5230\u7684\u6570\u636E\uFF0C\u5C31\u662F\u8D85\u5E02\u4E0A\u552E\u5356\u7684\u6210\u54C1\u732A\u8089\u3002Observable\u53EF\u4EE5\u5E72\u9884\u6D41\u6C34\u7EBF\u4E0A\u6240\u6709\u6D41\u7A0B\uFF0C\u5B9E\u73B0\u5BF9\u6570\u636E\u7684\u5B9A\u5236\u5316\u3002Promise\u5C31\u4E0D\u80FD\u5E72\u9884\u6D41\u6C34\u7EBF\u4E0A\u4EFB\u4F55\u6D41\u7A0B\uFF0C\u5B83\u80FD\u505A\u5C31\u662F\u4E0B\u5355\u4E70\u732A\u8089\uFF0C\u5C60\u5BB0\u573A\u505A\u597D\u7684\u6210\u54C1\u4E86\uFF0C\u4ED6\u62FF\u5230\u5C31\u662F\u8D85\u5E02\u5728\u552E\u5356\u7684\u6210\u54C1\u732A\u8089\u3002\u6240\u4EE5\u6211\u5728\u4F7F\u7528axios\u5E93\u7684\u65F6\u5019\uFF0C\u5BF9\u8BF7\u6C42\u6570\u636E\u7684\u5904\u7406\u548C\u6570\u636E\u5B8C\u6210\u540E\u7684\u5904\u7406\uFF0C\u53EA\u80FD\u5728axios\u5E93\u4E2D<code>interceptors</code>\u62E6\u622A\u5668\u5B8C\u6210\uFF0C\u4F46\u662Fangular2+\u5C31\u4E0D\u7528\u4F7F\u7528http\u7684\u62E6\u622A\u5668\uFF0C\u4E00\u6837\u5F88\u4F18\u96C5\u5904\u7406\u5404\u79CD\u6570\u636E\uFF0C\u4E24\u8005\u5404\u6709\u4F18\u52A3\u3002</p><h2 id="\u9879\u76EE\u9700\u6C42" tabindex="-1"><a class="header-anchor" href="#\u9879\u76EE\u9700\u6C42" aria-hidden="true">#</a> \u9879\u76EE\u9700\u6C42</h2><p>\u4E00\u4E2A\u5B8C\u6574\u7684HTTP\u670D\u52A1\u8981\u5305\u62EC\u4EE5\u4E0B\u5185\u5BB9\uFF1A</p><ol><li>\u80FD\u8F6C\u5316\u7279\u6B8A\u5B57\u7B26\uFF0C\u4F8B\u5982+\uFF0C-\uFF0C[]</li><li>\u80FD\u8BC6\u522B\u6D4F\u89C8\u5668\u7684\u4E0D\u540C\u72B6\u6001\u7801,\u4F8B\u5982\uFF1A5xx/4xx/3xx</li><li>\u5BF9\u8BF7\u6C42\u670D\u52A1\u8FDB\u884C\u62E6\u622A\uFF0C\u5904\u7406get\u548Cpost\u3001put\u7B49\u4E0D\u540C\u7C7B\u578B\u7684\u8BF7\u6C42\u53C2\u6570</li><li>\u5BF9\u6355\u83B7\u9519\u8BEF\u7EDF\u4E00\u62A5\u9519\uFF08\u5305\u62EC\u8BF7\u6C42\u8D85\u65F6\uFF0C\u7EDF\u4E00\u62A5\u9519\uFF09</li><li>\u5728HTTP\u8BF7\u6C42\u53D1\u8D77\u6216\u8005\u7ED3\u675F\uFF0C\u5F00\u542F\u6216\u8005\u5173\u95EDloading\u52A8\u753B</li><li>\u5BF9\u8BF7\u6C42\u6210\u529F\u8FD4\u56DE\u7684\u72B6\u6001\u8FDB\u884C\u9884\u5904\u7406</li><li>\u5BF9\u8BF7\u6C42\u5931\u8D25\u7684\u5F02\u5E38\u4FE1\u606F\u8FDB\u884C\u9884\u5904\u7406</li><li>\u540C\u4E00\u4E2A\u9875\u9762\u591A\u4E2A\u8BF7\u6C42\u53EA\u53D1\u8D77\u4E00\u4E2Aloading\u52A8\u753B</li><li>\u591A\u6B21\u70B9\u51FB\u6309\u94AE\uFF0C\u53EA\u80FD\u89E6\u53D1\u4E00\u6B21\u8BF7\u6C42\uFF0C\u80FD\u505A\u5230\u62E6\u622A\u91CD\u590D\u8BF7\u6C42\uFF0C\u53D6\u6D88\u8BF7\u6C42</li><li>\u652F\u6301\u540C\u6B65\u8BF7\u6C42\uFF0C\u4E3B\u8981\u4F5C\u7528\u4E8E\u9ED8\u9ED8\u767B\u5F55\uFF0C\u767B\u5F55\u5B8C\u4E4B\u540E\uFF0C\u7528\u6237\u65E0\u611F\u77E5\u83B7\u53D6\u65B0token\uFF0C\u4E0D\u5F71\u54CD\u539F\u6765\u7684\u63A5\u53E3\u8FD4\u56DE\u53C2\u6570</li><li>\u63A5\u53D7\u8BF7\u6C42\u8D85\u65F6\u6216\u8005http\u72B6\u6001\u4E3A5xx\u7684\u65F6\u5019\uFF0C\u8FDB\u884C\u91CD\u8BD5\u63A5\u53E3</li><li>\u8DEF\u7531\u5207\u6362\u53D6\u6D88\u5F53\u524D\u6240\u6709pending\u72B6\u6001\u7684\u8BF7\u6C42,\u5E76\u4E14\u53EF\u914D\u7F6E\u767D\u540D\u5355</li><li>\u5355\u72EC\u53D6\u6D88\u53D1\u51FA\u7684\u67D0\u4E2A\u8BF7\u6C42\uFF0C\u9488\u5BF9\u4F8B\u5982\uFF1A\u6587\u4EF6\u4E0A\u4F20\u6BD4\u8F83\u4E45\uFF0C\u7136\u540E\u60F3\u53D6\u6D88\u7684\u3002\uFF08\u5C1A\u672A\u5F00\u53D1\uFF09</li></ol><h2 id="\u76EE\u5F55\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u76EE\u5F55\u8BF4\u660E" aria-hidden="true">#</a> \u76EE\u5F55\u8BF4\u660E</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>                        
\u251C\u2500\u2500 src                                 
\u2502   \u251C\u2500\u2500 utils                     <span class="token comment"># \u5DE5\u5177\u7C7B</span>
\u2502       \u251C\u2500\u2500 http                  <span class="token comment"># http\u670D\u52A1</span>
\u2502           \u251C\u2500\u2500 axiosCancle.ts    <span class="token comment"># \u62E6\u622A\u91CD\u590D\u8BF7\u6C42\uFF0C\u53D6\u6D88\u8BF7\u6C42</span>
\u2502           \u251C\u2500\u2500 axiosLoading.ts   <span class="token comment"># \u663E\u793Aloading\u754C\u9762\u548C\u9690\u85CFloading\u754C\u9762\u7684\u903B\u8F91</span>
\u2502           \u251C\u2500\u2500 axiosRetry.ts     <span class="token comment"># \u91CD\u8BD5\u63A5\u53E3\u7684\u903B\u8F91</span>
\u2502           \u251C\u2500\u2500 checkStatus.ts    <span class="token comment"># \u4E3B\u8981\u9488\u5BF9\u4E00\u4E9Bhttp\u534F\u8BAE\u7684\u72B6\u6001\u7801\u8FDB\u884C\u9488\u5BF9\u6027\u7684\u4E00\u4E9B\u5904\u7406</span>
\u2502           \u251C\u2500\u2500 index.ts          <span class="token comment"># http\u670D\u52A1\u7684\u5165\u53E3\u6587\u4EF6\uFF0C\u521D\u6B65\u5B9A\u4E49\u4E86axios\u7684\u4E00\u4E9B\u57FA\u672C\u5C5E\u6027</span>
\u2502           \u251C\u2500\u2500 interceptors.ts   <span class="token comment"># axios\u5E93\u7684\u62E6\u622A\u5668\u65B9\u6CD5</span>
\u2502           \u2514\u2500\u2500 types.ts          <span class="token comment"># \u9884\u5B9A\u4E49\u7684\u63A5\u53E3\u7C7B\u578B</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>http\u670D\u52A1\u5B58\u653E\u5728<code>/src/utils/http</code>\u76EE\u5F55\u5E95\u4E0B\uFF0C\u4E00\u5171\u67097\u4E2A\u6587\u4EF6\uFF0C\u5206\u522B\u7684\u529F\u80FD\u5982\u4E0B\uFF1A</p><ul><li><code>axiosCancle.ts</code>\u6587\u4EF6\u4E3B\u8981\u89E3\u51B3\u4E86\u591A\u6B21\u70B9\u51FB\u6309\u94AE\uFF0C\u53EA\u80FD\u89E6\u53D1\u4E00\u6B21\u8BF7\u6C42\uFF0C\u80FD\u505A\u5230\u62E6\u622A\u91CD\u590D\u8BF7\u6C42\uFF0C\u53D6\u6D88\u8BF7\u6C42\u7684\u529F\u80FD</li><li><code>axiosLoading.ts</code>\u6587\u4EF6\u4E3B\u8981\u5C01\u88C5\u4E86 \u663E\u793Aloading\u754C\u9762\u548C\u9690\u85CFloading\u754C\u9762\u7684\u903B\u8F91</li><li><code>axiosRetry.ts</code> \u6587\u4EF6\u4E3B\u8981\u5C01\u88C5\u4E86\u5F53\u63A5\u53E3\u7C7B\u578B\u4E3Aget/put/delete,\u4E14\u8BF7\u6C42\u8D85\u65F6\u6216\u8005\u72B6\u6001\u7801\u4E3A5xx\u7684\u65F6\u5019\uFF0C\u4F1A\u53D1\u8D77\u4E24\u6B21\u91CD\u8BD5\u63A5\u53E3\u7684\u903B\u8F91</li><li><code>checkStatus.ts</code> \u6587\u4EF6\u4E3B\u8981\u9488\u5BF9\u4E00\u4E9Bhttp\u534F\u8BAE\u7684\u72B6\u6001\u7801\u8FDB\u884C\u9488\u5BF9\u6027\u7684\u4E00\u4E9B\u5904\u7406</li><li><code>index.ts</code> http\u670D\u52A1\u7684\u5165\u53E3\u6587\u4EF6\uFF0C\u521D\u6B65\u5B9A\u4E49\u4E86axios\u7684\u4E00\u4E9B\u57FA\u672C\u5C5E\u6027\uFF0C\b\u4F8B\u5982api\u5730\u5740\uFF0C\u62E6\u622A\u5668\u7684\u65B9\u6CD5\u7B49\u7B49</li><li><code>interceptors.ts</code> axios\u5E93\u7684\u62E6\u622A\u5668\u65B9\u6CD5\uFF0C\u5305\u62EC\u8BF7\u6C42\u62E6\u622A\u548C\u54CD\u5E94\u62E6\u622A\uFF0C\u4E0A\u9762\u6240\u6709\u6587\u4EF6\uFF0C\u90FD\u662F\u56F4\u7ED5\u7740\u8FD9\u4E2A\u6587\u4EF6\u7684\u903B\u8F91\u5904\u7406\u8FDB\u884C\uFF0C\u91CC\u9762\u662Fhttp\u670D\u52A1\u5C01\u88C5\u7684\u6838\u5FC3\u5185\u5BB9\u3002</li><li><code>types.ts</code> \u5728\u5C01\u88C5http\u670D\u52A1\u8FC7\u7A0B\u4E2D\u8981\u5B9A\u4E49\u4E00\u4E9B\u63A5\u53E3\u7C7B\u578B\uFF0C\u6216\u8005\u9488\u5BF9axios\u7684\u5DF2\u6709\u63A5\u53E3\u7C7B\u578B\u8FDB\u884C\u63A5\u53E3\u62D3\u5C55\u6216\u8005\u7EE7\u627F\uFF0C\u90FD\u5C06\u5728\u8FD9\u4E2A\u6587\u4EF6\u5B9A\u4E49\uFF0C\u53EF\u4EE5\u8BF4\u8FD9\u4E2A\u6587\u4EF6\u4E3B\u8981\u662F\u5B9A\u4E49\u6216\u8005\u58F0\u660E\u53D8\u91CF\u63A5\u53E3\u7684\u4E00\u4E2A\u96C6\u4E2D\u6587\u4EF6\u3002</li></ul><h2 id="\u5B89\u88C5-axios" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-axios" aria-hidden="true">#</a> \u5B89\u88C5 axios</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> axios<span class="token punctuation">;</span> // \u5B89\u88C5axios
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="\u57FA\u672C\u6846\u67B6" tabindex="-1"><a class="header-anchor" href="#\u57FA\u672C\u6846\u67B6" aria-hidden="true">#</a> \u57FA\u672C\u6846\u67B6</h2><p><code>index.ts</code>http\u670D\u52A1\u7684\u5165\u53E3\u6587\u4EF6\uFF0C\u521D\u6B65\u5B9A\u4E49\u4E86axios\u7684\u4E00\u4E9B\u57FA\u672C\u5C5E\u6027\uFF0C\b\u4F8B\u5982api\u5730\u5740\uFF0C\u62E6\u622A\u5668\u7684\u65B9\u6CD5\u7B49\u7B49</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> axios<span class="token punctuation">,</span> <span class="token punctuation">{</span> AxiosInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> requestFail<span class="token punctuation">,</span> requestSuccess<span class="token punctuation">,</span> responseFail<span class="token punctuation">,</span> responseSuccess <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./interceptors&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> service<span class="token operator">:</span> AxiosInstance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token operator">:</span> fitsConfig<span class="token punctuation">.</span>baseURL<span class="token punctuation">,</span> <span class="token comment">// url = base url + request url</span>
  timeout<span class="token operator">:</span> fitsConfig<span class="token punctuation">.</span>httpTimeOut<span class="token punctuation">,</span>
  retries<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// \u91CD\u8BD5\u7684\u6B21\u6570</span>
  retryDelay<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token comment">// \u6BCF\u4E00\u6B21\u91CD\u8BD5\uFF0C\u4F1A\u5EF6\u8FDF\u591A\u5C11\u79D2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u8BF7\u6C42\u62E6\u622A</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>requestSuccess<span class="token punctuation">,</span> requestFail<span class="token punctuation">)</span>

<span class="token comment">// \u54CD\u5E94\u62E6\u622A</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>responseSuccess<span class="token punctuation">,</span> responseFail<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> service<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="http\u670D\u52A1\u7684\u8C03\u7528\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#http\u670D\u52A1\u7684\u8C03\u7528\u65B9\u5F0F" aria-hidden="true">#</a> http\u670D\u52A1\u7684\u8C03\u7528\u65B9\u5F0F</h3><p>\u5728<code>src/api/app.ts</code>\u653Ehttp\u7684\u8C03\u7528\u63A5\u53E3\u3002</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u5BFC\u5165index\u6587\u4EF6\u4E2Dhttp\u6A21\u5757</span>
<span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">&quot;@/utils/http&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getUserInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">&#39;/Common/User&#39;</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1111</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">&quot;ddd&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    isLoading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// \u62D3\u5C55\u7684\u5C5E\u6027</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="http\u7684\u63A5\u53E3\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#http\u7684\u63A5\u53E3\u7C7B\u578B" aria-hidden="true">#</a> http\u7684\u63A5\u53E3\u7C7B\u578B</h2><p><code>types.ts</code> \u5728\u5C01\u88C5http\u670D\u52A1\u8FC7\u7A0B\u4E2D\u8981\u5B9A\u4E49\u4E00\u4E9B\u63A5\u53E3\u7C7B\u578B\uFF0C\u6216\u8005\u9488\u5BF9axios\u7684\u5DF2\u6709\u63A5\u53E3\u7C7B\u578B\u8FDB\u884C\u63A5\u53E3\u62D3\u5C55\u6216\u8005\u7EE7\u627F\uFF0C\u90FD\u5C06\u5728\u8FD9\u4E2A\u6587\u4EF6\u5B9A\u4E49\uFF0C\u53EF\u4EE5\u8BF4\u8FD9\u4E2A\u6587\u4EF6\u4E3B\u8981\u662F\u5B9A\u4E49\u6216\u8005\u58F0\u660E\u53D8\u91CF\u63A5\u53E3\u7684\u4E00\u4E2A\u96C6\u4E2D\u6587\u4EF6\u3002</p><p>\u5728\u8FD9\u4E2A\u6587\u4EF6\u4E2D\uFF0C\u4F60\u53EF\u4EE5\u770B\u5230ts\u4E2D\u5173\u4E8E\u63A5\u53E3\u7C7B\u578B\u7684\u679A\u4E3E\u3001\u63A5\u53E3\u7684\u62D3\u5C55\u3002</p><h3 id="\u63A5\u53E3\u7684\u6269\u5C55" tabindex="-1"><a class="header-anchor" href="#\u63A5\u53E3\u7684\u6269\u5C55" aria-hidden="true">#</a> \u63A5\u53E3\u7684\u6269\u5C55</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u62D3\u5C55AxiosRequestConfig\u7684\u63A5\u53E3\uFF0C\u5728\u4ED6\u539F\u6765\u5DF2\u6709\u7684\u57FA\u7840\u4E0A\u62D3\u5C55\u66F4\u591A\u7684\u5C5E\u6027</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
       <span class="token comment">// \u662F\u5426\u663E\u793Aloading\u754C\u9762</span>
       isLoading<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// \u662F\u5426\u663E\u793A\u63D0\u793A\u4FE1\u606F</span>
       isShowMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// \u6210\u529F\u7684\u6587\u672C\u4FE1\u606F</span>
       successMessageText<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
       <span class="token comment">// \u662F\u5426\u663E\u793A\u6210\u529F\u4FE1\u606F</span>
       isShowSuccessMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// \u662F\u5426\u663E\u793A\u5931\u8D25\u4FE1\u606F</span>
       isShowErrorMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// \u9519\u8BEF\u7684\u6587\u672C\u4FE1\u606F</span>
       errorMessageText<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
       <span class="token comment">// \u65E7\u7684\u53C2\u6570\u7C7B\u578B\uFF0C\u9ED8\u9ED8\u767B\u5F55\uFF0C\u6362token\u7684\u65F6\u5019\uFF0C\u9700\u8981</span>
       oldParams<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
       <span class="token comment">// \u65E7\u7684URL\uFF0CURL\u5728\u8BF7\u6C42\u62E6\u622A\u4F1A\u88AB\u6539\u53D8\uFF0C\u9ED8\u9ED8\u767B\u5F55\uFF0C\u6362token\u7684\u65F6\u5019\uFF0C\u9700\u8981</span>
       oldURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
       <span class="token comment">// \u9519\u8BEF\u6D88\u606F\u63D0\u793A\u7C7B\u578B</span>
       errorMessageMode<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&#39;alert&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;toast&#39;</span><span class="token punctuation">;</span>
       <span class="token comment">// \u5931\u8D25\u524D\u91CD\u8BD5\u7684\u6B21\u6570,\u9ED8\u8BA4\u662F\u4E00\u6B21</span>
       retries<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> 
       <span class="token comment">// \u63A7\u5236\u91CD\u8BD5\u8BF7\u6C42\u4E4B\u95F4\u5EF6\u8FDF\u7684\u56DE\u8C03\u3002\u9ED8\u8BA4\u662F2000\u6BEB\u79D2\uFF0C\u9ED8\u8BA4\u662F1\u79D2</span>
       retryDelay<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
       <span class="token comment">// \u5F53\u524D\u91CD\u8BD5\u7684\u6B21\u6570\uFF0C\u6216\u8005\u8BF4\u5F53\u524D\u662F\u7B2C\u51E0\u6B21\u91CD\u8BD5</span>
       retryCount<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name">AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span><span class="token punctuation">{</span>
        RetCode<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
        Message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
        ReturnData<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container danger"><p class="custom-container-title">\u4E3A\u4EC0\u4E48\u8981\u6269\u5C55AxiosRequestConfig?</p></div><p>\u9996\u5148\u5728vscode\u4E0A\uFF0C\u627E\u5230index.ts\u5165\u53E3\u6587\u4EF6\uFF0C\u70B9\u51FB\u5173\u952E\u5B57<code>axios</code>,\u6309\u4F4FCtrl\u952E\uFF0C\u70B9\u51FB\u5173\u952E\u5B57\uFF0C\u67E5\u770B\u6E90\u7801\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
  url<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  method<span class="token operator">?</span><span class="token operator">:</span> Method<span class="token punctuation">;</span>
  baseURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  transformRequest<span class="token operator">?</span><span class="token operator">:</span> AxiosTransformer <span class="token operator">|</span> AxiosTransformer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  transformResponse<span class="token operator">?</span><span class="token operator">:</span> AxiosTransformer <span class="token operator">|</span> AxiosTransformer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  headers<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  params<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  paramsSerializer<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  timeoutErrorMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  withCredentials<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  adapter<span class="token operator">?</span><span class="token operator">:</span> AxiosAdapter<span class="token punctuation">;</span>
  auth<span class="token operator">?</span><span class="token operator">:</span> AxiosBasicCredentials<span class="token punctuation">;</span>
  responseType<span class="token operator">?</span><span class="token operator">:</span> ResponseType<span class="token punctuation">;</span>
  xsrfCookieName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  xsrfHeaderName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  onUploadProgress<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>progressEvent<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  onDownloadProgress<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>progressEvent<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  maxContentLength<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  validateStatus<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>status<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  maxBodyLength<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  maxRedirects<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  socketPath<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  httpAgent<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  httpsAgent<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  proxy<span class="token operator">?</span><span class="token operator">:</span> AxiosProxyConfig <span class="token operator">|</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  cancelToken<span class="token operator">?</span><span class="token operator">:</span> CancelToken<span class="token punctuation">;</span>
  decompress<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosInstance</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosPromise<span class="token punctuation">;</span>
  <span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosPromise<span class="token punctuation">;</span>
  defaults<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">;</span>
  interceptors<span class="token operator">:</span> <span class="token punctuation">{</span>
    request<span class="token operator">:</span> AxiosInterceptorManager<span class="token operator">&lt;</span>AxiosRequestConfig<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    response<span class="token operator">:</span> AxiosInterceptorManager<span class="token operator">&lt;</span>AxiosResponse<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">getUri</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span> <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">delete</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">head</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">options</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">put</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">patch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosStatic</span> <span class="token keyword">extends</span> <span class="token class-name">AxiosInstance</span> <span class="token punctuation">{</span>
  <span class="token function">create</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosInstance<span class="token punctuation">;</span>
  Cancel<span class="token operator">:</span> CancelStatic<span class="token punctuation">;</span>
  CancelToken<span class="token operator">:</span> CancelTokenStatic<span class="token punctuation">;</span>
  <span class="token function">isCancel</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">all</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>values<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">spread</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">R</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>array<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">R</span><span class="token punctuation">;</span>
  <span class="token function">isAxiosError</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> payload <span class="token keyword">is</span> AxiosError<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> <span class="token keyword">const</span> axios<span class="token operator">:</span> AxiosStatic<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u770B\u5230\u6E90\u7801\u53EF\u4EE5\u53D1\u73B0\uFF0Caxios \u5B9E\u4F8B\u5316 <code>create</code>\u4E8B\u4EF6\u7684\u51FA\u5165\u53C2\u6570\u63A5\u53E3\u7C7B\u578B\u90FD\u662F\uFF1A <code>AxiosRequestConfig</code></p><p>\u7136\u800C\u6E90\u7801\u4E2D\u7684\u5C5E\u6027\u662F\u56FA\u5B9A\u7684\uFF0C\u4F46\u662F\u6211\u4EEC\u9700\u8981\u66F4\u591A\u5C5E\u6027\u53BB\u914D\u5408\u6211\u4EEC\u505A\u4E1A\u52A1\u4E0A\u7684\u53D8\u5316\uFF0C\u4F8B\u5982\u662F\u5426\u63A7\u5236loading\u7684\u663E\u793A\u9690\u85CF\u3001\u662F\u5426\u9700\u8981\u6253\u5F00\u63D0\u793A\u6846\uFF0C\u5B9A\u4E49\u91CD\u8BD5\u7684\u6B21\u6570\u548C\u5EF6\u8FDF\u65F6\u95F4\u7B49\u7B49\uFF0C\u8FD9\u4E9B\u5C5E\u6027\u90FD\u662F\u6E90\u7801\u6CA1\u6709\u7684\u3002\u57FA\u4E8E\u8FD9\u79CD\u539F\u56E0\uFF0C\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u62D3\u5C55\u66F4\u591A\u5C5E\u6027\uFF0C\u53EF\u80FD\u6709\u4EBA\u4F1A\u95EE\u4E0D\u62D3\u5C55\u4F1A\u53D1\u751F\u4EC0\u4E48\uFF1F\u4F1A\u4EA7\u751F\u4EC0\u4E48\u95EE\u9898\uFF1F</p><p>\u5982\u679C\u4E0D\u62D3\u5C55\u63A5\u53E3\u5C5E\u6027\uFF0C\u5728ts\u9879\u76EE\u4E2D\uFF0C\u56E0\u4E3A\u6CA1\u6709\u53D1\u73B0\u8FD9\u4E2A\u5C5E\u6027\uFF0C\u6240\u4EE5\u4F1A\u62A5\u9519\uFF0C\u7F16\u8BD1\u5C31\u4F1A\u4E0D\u901A\u8FC7\uFF0C\u5982\u679C\u4E0D\u662F\u5F00\u542F\u4E25\u683C\u6A21\u5F0F\uFF0C\u5728\u4E00\u822C\u7684js\u9879\u76EE\u4E2D\uFF0C\u8FD9\u79CD\u4E00\u822C\u4E0D\u4F1A\u6709\u95EE\u9898\uFF0C\u5728js\u4E2D\uFF0C\u5982\u679C\u6CA1\u6709\u8FD9\u4E2A\u5C5E\u6027\uFF0C\u4F1A\u81EA\u52A8\u6DFB\u52A0\u8FD9\u4E2A\u5C5E\u6027\uFF0C\u5728tslint\u7684\u89C4\u5219\u4E2D\uFF0C\u56E0\u4E3A\u662F\u5F3A\u7C7B\u578B\u8BED\u8A00\uFF0C\u6240\u4EE5\u4E0D\u62D3\u5C55\u5C5E\u6027\uFF0C\u5C31\u4F1A\u7F16\u8BD1\u4E0D\u901A\u8FC7</p><p><img src="`+v+`" alt="\u56FE 2"></p><p>\u63A5\u53E3\u7684\u62D3\u5C55\u540E\uFF0C\u4E0D\u4EC5\u80FD\u62E5\u6709\u539F\u6765\u7684\u5C5E\u6027\uFF0C\u8FD8\u80FD\u81EA\u52A8\u5408\u5E76\u4F60\u5B9A\u4E49\u7684\u5C5E\u6027\uFF0C\u63A5\u53E3\u7684\u62D3\u5C55\u5173\u952E\u4EE3\u7801\u662F</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u81EA\u5B9A\u4E49\u5C5E\u6027</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u5728\u5176\u4E2D\u8FD8\u5C1D\u8BD5\u8FC7ts\u7684\u63A5\u53E3\u7EE7\u627F\uFF0C\u4F46\u662F\u5728\u5B9E\u9645\u5F00\u53D1\u8FC7\u7A0B\u53D1\u73B0\u4E0D\u592A\u5408\u9002\uFF0C\u56E0\u4E3A\u4F1A\u6539\u53D8\u63A5\u53E3\u7C7B\u578B\u7684\u540D\u5B57\uFF0C\u4EE5\u4E0B\u662F\u63A5\u53E3\u7EE7\u627F\u7684\u8303\u4F8B:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> AxiosRequestConfig from axios
<span class="token keyword">interface</span> <span class="token class-name">customAxiosRequestConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u81EA\u5B9A\u4E49\u5C5E\u6027</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u4E0A\u9762\u4EE3\u7801\u53EF\u4EE5\u770B\u51FA\u6765\uFF0C\u5B9A\u4E49\u7684<code>customAxiosRequestConfig</code>\u63A5\u53E3\u662F\u53EF\u4EE5\u7EE7\u627F<code>AxiosRequestConfig</code>\u6240\u6709\u5C5E\u6027\u548C\u81EA\u5B9A\u4E49\u5C5E\u6027\u7684\uFF0C\u4F46\u662F\u4E0D\u7B26\u5408\u6211\u4EEC\u7684\u9700\u6C42\uFF0C\u5982\u679C\u6211\u4EEC\u7528\u4E86<code>customAxiosRequestConfig</code>\u63A5\u53E3\u540D\u5B57\uFF0C\u5C31\u6539\u53D8\u4E86\u6E90\u7801\u4E2D<code>AxiosRequestConfig</code>\u7684\u63A5\u53E3\u540D\u5B57\uFF0C\u4F1A\u5BFC\u81F4\u6E90\u7801\u4E2D\u5F88\u591A\u5B9A\u4E49\u4E86\u8FD9\u4E2A\u540D\u5B57\u7684\u63A5\u53E3\u90FD\u8981\u76F8\u5E94\u7684\u4FEE\u6539\uFF0C\u5DE5\u7A0B\u91CF\u592A\u5927\uFF0C\u800C\u4E14\u6CA1\u5FC5\u8981\uFF0C\u56E0\u4E3A\u63A5\u53E3\u7684\u62D3\u5C55\u5C31\u5DF2\u7ECF\u5F88\u5B8C\u7F8E\u7684\u89E3\u51B3\u95EE\u9898\u4E86\uFF0C\u4E0D\u9700\u8981\u7EE7\u627F\u3002</p><h3 id="ts\u4E2D\u7684\u679A\u4E3E\u7528\u6CD5" tabindex="-1"><a class="header-anchor" href="#ts\u4E2D\u7684\u679A\u4E3E\u7528\u6CD5" aria-hidden="true">#</a> ts\u4E2D\u7684\u679A\u4E3E\u7528\u6CD5</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: \u8BF7\u6C42\u7ED3\u679C\u96C6
 */</span>
<span class="token keyword">export</span> <span class="token keyword">enum</span> ResultEnum <span class="token punctuation">{</span>
    <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token comment">// \u67E5\u8BE2\u6210\u529F\u3001\u64CD\u4F5C\u6210\u529F  </span>
    <span class="token constant">ERROR</span> <span class="token operator">=</span> <span class="token number">1002</span><span class="token punctuation">,</span>   <span class="token comment">// \u64CD\u4F5C\u5931\u8D25\u3001\u67E5\u8BE2\u5931\u8D25  </span>
    <span class="token constant">STYSTEM_ERROR</span> <span class="token operator">=</span> <span class="token number">2001</span><span class="token punctuation">,</span> <span class="token comment">// \u7CFB\u7EDF\u5F02\u5E38  </span>
    <span class="token constant">LOGIN_FAIL</span> <span class="token operator">=</span> <span class="token number">2002</span><span class="token punctuation">,</span>    <span class="token comment">// \u767B\u5F55\u8EAB\u4EFD\u9A8C\u8BC1\u5931\u6548</span>
    <span class="token constant">DOUBLE_REQUEST</span> <span class="token operator">=</span> <span class="token number">2003</span><span class="token punctuation">,</span> <span class="token comment">// \u91CD\u590D\u8BF7\u6C42</span>
    <span class="token constant">PARAMAR_ERROR</span> <span class="token operator">=</span> <span class="token number">2004</span><span class="token punctuation">,</span>  <span class="token comment">// \u53C2\u6570\u4E0D\u7B26\u5408\u8981\u6C42</span>
    <span class="token constant">APPID_LOWER</span> <span class="token operator">=</span> <span class="token number">2005</span><span class="token punctuation">,</span>  <span class="token comment">// APP\u7248\u672C\u8FC7\u4F4E</span>
    <span class="token constant">APPID_ERROR</span> <span class="token operator">=</span> <span class="token number">2006</span><span class="token punctuation">,</span>  <span class="token comment">// APPID\u65E0\u6548\u3001\u5FAE\u4FE1\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25</span>
    <span class="token constant">HOT_UNPDATE</span> <span class="token operator">=</span> <span class="token number">2007</span><span class="token punctuation">,</span>  <span class="token comment">// \u9700\u8981\u8FDB\u884C\u70ED\u66F4\u65B0\u68C0\u67E5</span>
    <span class="token constant">USER_UNPDATE</span><span class="token operator">=</span> <span class="token number">2008</span><span class="token punctuation">,</span>  <span class="token comment">// \u7528\u6237\u4FE1\u606F\u5DF2\u53D8\u66F4		</span>
    <span class="token constant">FORCE_OFFLINE</span><span class="token operator">=</span><span class="token number">2009</span><span class="token punctuation">,</span>  <span class="token comment">// \u5F3A\u5236\u4E0B\u7EBF</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="axios\u62E6\u622A\u5668" tabindex="-1"><a class="header-anchor" href="#axios\u62E6\u622A\u5668" aria-hidden="true">#</a> axios\u62E6\u622A\u5668</h2><p>\u6253\u5F00<code>interceptors.ts</code>\u6587\u4EF6\uFF0C\u53EF\u4EE5\u770B\u5230\u8BF7\u6C42\u62E6\u622A\u548C\u54CD\u5E94\u62E6\u622A\uFF0C\u57FA\u672C\u6846\u67B6\u5982\u4E0B\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u8BF7\u6C42\u62E6\u622A\u5668</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">requestSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5224\u65AD\u5F53\u524D\u8BF7\u6C42\u662F\u5426\u8BBE\u7F6E\u4E86\u4E0D\u663E\u793ALoading</span>
    <span class="token comment">// \u5728\u8BF7\u6C42\u53D1\u51FA\u53BB\u4E4B\u524D\u62E6\u622A\u8BF7\u6C42\u53C2\u6570\uFF0C\u5305\u62ECparam\u548Cbody\uFF0C</span>
    <span class="token comment">// get\u63A5\u53E3\u7684\u6570\u636E\uFF0C\u5C5E\u6027\u8981\u7528Data[id]=1111&amp;Data[text]\u8FD9\u4E2A\u683C\u5F0F\u624D\u80FD\u8BF7\u6C42\u6210\u529F</span>
    <span class="token comment">// post\u8BF7\u6C42\uFF0C\u9700\u8981\u628A\u6240\u6709\u5C5E\u6027\u7684\u6570\u636E\u5305\u88F9\u5728Data{}\u91CC\u9762</span>
    <span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// \u8BF7\u6C42\u5931\u8D25\u62E6\u622A</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">requestFail</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u8FD9\u91CC\u6781\u5C11\u60C5\u51B5\u4F1A\u8FDB\u6765\uFF0C\u6682\u65F6\u6CA1\u6709\u627E\u5230\u4E3B\u52A8\u89E6\u53D1\u7684\u65B9\u6CD5\uFF0C\u4F30\u8BA1\u53EA\u6709\u6D4F\u89C8\u5668\u4E0D\u517C\u5BB9\u65F6\u624D\u4F1A\u89E6\u53D1\uFF0C\u6B22\u8FCE\u540E\u9762\u540C\u5B66\u8865\u5145</span>
    <span class="token comment">// \u770B\u4E86\u51E0\u4E2AGitHub\u7684issue\uFF0C\u6709\u4EBA\u751A\u81F3\u63D0\u51FA\u4E86\u8FD9\u4E2A\u65B9\u6CD5\u662F\u4E0D\u5FC5\u8981\u7684\uFF08\u56E0\u4E3A\u6CA1\u6709\u89E6\u53D1\u7684\u573A\u666F\uFF09\uFF0C\u4E0D\u8FC7\u8FD8\u662F\u5EFA\u8BAE\u5927\u5BB6\u6309\u7167\u5B98\u65B9\u7684\u5199\u6CD5\uFF0C\u907F\u514D\u4E0D\u5FC5\u8981\u7684\u9519\u8BEF</span>
    <span class="token comment">// \u8FDB\u6765\u4E4B\u540E\u6CA1\u6CD5\u53D1\u8D77\u8BF7\u6C42</span>
    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u7528resolve\u4F1A\u4EE4\u8FD9\u4E2A\u8BF7\u6C42\u7684promise\u4E0D\u4F1A\u88AB\u4E2D\u65AD\uFF0C\u8FD8\u662F\u4F1A\u628Aerror\u8FD4\u56DE\u5230\u8BF7\u6C42\u4E2D\u7684then\u7684\u6D41\u7A0B\u4E2D</span>
    <span class="token comment">// return Promise.resolve(error); </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * \u54CD\u5E94\u6210\u529F\u62E6\u622A\u5668
 * \u53EA\u6709\u8FD4\u56DE\u7684\u72B6\u6001\u7801\u662F2xx\uFF0C\u90FD\u4F1A\u8FDB\u6765\u8FD9\u91CC
 * 1. \u8FD4\u56DEdata\u91CC\u9762\u7684\u6570\u636E\uFF0C\u53EA\u4FDD\u7559\u516C\u53F8\u63A5\u53E3\u89C4\u8303\u7684\u6570\u636E
 * 2. Axios \u63A5\u53E3\u8D85\u65F6\u7EDF\u4E00\u5904\u7406\uFF0C\u8BF7\u6C42\u8D85\u65F6\u7684\u8BDD\uFF0C\u53EF\u4EE5\u91CD\u65B0\u53D1\u8D77\u4E00\u6B21\u8BF7\u6C42
 * 3. \u9488\u5BF9\u516C\u53F8\u81EA\u5B9A\u4E49\u7684\u5404\u79CD\u72B6\u6001\u7801\u8FDB\u884C\u5904\u7406
 * 4. \u80FD\u9ED8\u9ED8\u767B\u5F55\uFF0C\u6362\u53D6\u65B0\u7684token
 * 5. \u80FD\u5173\u95EDloading\u754C\u9762
 * <span class="token keyword">@param</span> <span class="token parameter">response</span> 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> \u54CD\u5E94\u5931\u8D25\u62E6\u622A\u5668 \u7EDF\u4E00\u5904\u7406http\u5F02\u5E38
 * <span class="token keyword">@description</span> \u6CE8\u610F\u5982\u679C\u53D6\u6D88\u8BF7\u6C42\uFF0C\u4E00\u6837\u8D70responseFail\u7684\u6D41\u7A0B
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseFail</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> AxiosError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. http\u72B6\u6001\u7801\u975E2\u5F00\u5934\u7684\u90FD\u4F1A\u8FDB\u6765\u8FD9\u91CC\uFF0C\u5982404,500\u7B49</span>
    <span class="token comment">// 2. \u53D6\u6D88\u8BF7\u6C42\u4E5F\u4F1A\u8FDB\u5165\u8FD9\u91CC\uFF0CCancelToken\uFF0C\u53EF\u4EE5\u7528axios.isCancel(err)\u6765\u5224\u65AD\u662F\u53D6\u6D88\u7684\u8BF7\u6C42</span>
    <span class="token comment">// 3. \u8BF7\u6C42\u8FD0\u884C\u6709\u5F02\u5E38\u4E5F\u4F1A\u8FDB\u5165\u8FD9\u91CC\uFF0C\u5982\u6545\u610F\u5C06headers\u5199\u9519\uFF1Aaxios.defaults.headers = &#39;123&#39;,\u6216\u8005\u5728request\u4E2D\u6709\u8BED\u6CD5\u6216\u89E3\u6790\u9519\u8BEF\u4E5F\u4F1A\u8FDB\u5165\u8FD9\u91CC</span>
    <span class="token comment">// 4. \u8FD9\u91CC\u4F1A\u5904\u7406\u4E00\u4E9B\u8FBE\u5230\u91CD\u8FDE\u7684\u6761\u4EF6\u7684\u63A5\u53E3\uFF0C\u8FDB\u884C\u91CD\u8FDE\u3002</span>
    <span class="token comment">// \u8FDB\u5165\u8FD9\u91CC\u610F\u5473\u7740\u8BF7\u6C42\u5931\u8D25\uFF0Caxios\u4F1A\u8FDB\u5165catch\u5206\u652F</span>
   
        <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5982\u4F55\u53D6\u6D88\u91CD\u590D\u8BF7\u6C42" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u53D6\u6D88\u91CD\u590D\u8BF7\u6C42" aria-hidden="true">#</a> \u5982\u4F55\u53D6\u6D88\u91CD\u590D\u8BF7\u6C42</h2><p>\u5728\u5F00\u53D1\u4E2D\uFF0C\u7ECF\u5E38\u4F1A\u9047\u5230\u63A5\u53E3\u91CD\u590D\u8BF7\u6C42\u5BFC\u81F4\u7684\u5404\u79CD\u95EE\u9898\u3002</p><p>\u5BF9\u4E8E\u91CD\u590D\u7684get\u8BF7\u6C42\uFF0C\u4F1A\u5BFC\u81F4\u9875\u9762\u66F4\u65B0\u591A\u6B21\uFF0C\u53D1\u751F\u9875\u9762\u6296\u52A8\u7684\u73B0\u8C61\uFF0C\u5F71\u54CD\u7528\u6237\u4F53\u9A8C\u3002</p><p>\u5BF9\u4E8E\u91CD\u590D\u7684post\u8BF7\u6C42\uFF0C\u4F1A\u5BFC\u81F4\u5728\u670D\u52A1\u7AEF\u751F\u6210\u4E24\u6B21\u8BB0\u5F55\uFF08\u4F8B\u5982\u8FD0\u7EF4\u7EC4\u63D0\u4EA4\u9000\u4EF6\u7533\u8BF7\uFF0C\u4E00\u4E0D\u5C0F\u5FC3\u5C31\u4F1A\u5728\u540E\u53F0\u4EA7\u751F\u4E24\u6761\u8BB0\u5F55\uFF09\u3002</p><p>\u672C\u6B21http\u670D\u52A1\u66F4\u65B0\uFF0C\u63D0\u4F9B\u4EE5\u4E0B\u95EE\u9898\u7684\u89E3\u51B3\u65B9\u6848\uFF1A</p><ol><li>\u8DEF\u7531\u5207\u6362\u7684\u65F6\u5019\uFF0C\u53D6\u6D88\u5F53\u524D\u6240\u6709\u63A5\u53E3\u5904\u4E8Epending\u72B6\u6001\u7684\u8BF7\u6C42</li><li>\u5F53\u7528\u6237\u591A\u6B21\u70B9\u51FB\u6309\u94AE\uFF0C\u5BF9\u540C\u4E00\u4E2A\u63A5\u53E3\u540C\u65F6\u53D1\u8D77\u591A\u6B21\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u4FDD\u7559\u7B2C\u4E00\u6B21\u8BF7\u6C42\uFF0C\u4E2D\u65AD\u540E\u9762\u591A\u4F59\u7684\u8BF7\u6C42\u3002</li></ol><p>\u7F51\u4E0A\u627E\u4E86\u4E00\u4E9B\u535A\u4E3B\u7684\u65B9\u6CD5\uFF0C\u5927\u90E8\u5206\u90FD\u662F\u62E6\u622A\u4E86\u524D\u9762\u7684\u8BF7\u6C42\u3002\u6BD4\u5982\u8BF4\u53D1\u4E86\u4E00\u4E2A\u8BF7\u6C42a, \u5728 a \u8FD8\u6CA1\u6709\u5B8C\u6210\u65F6\uFF0C\u53C8\u53D1\u4E86\u4E00\u4E2A\u4E0E a \u4E00\u6837\u7684\u8BF7\u6C42 a2 ,\u5927\u90E8\u5206\u7684\u65B9\u6CD5\u662F\u53D6\u6D88\u4E86\u8BF7\u6C42a\u53EA\u4FDD\u7559a2\uFF0C\u4EE5\u4E0A\u65B9\u6CD5\u5728\u63A5\u53E3\u5FEB\u7684\u65F6\u5019\u662F\u4E0D\u4F1A\u6709\u95EE\u9898\u7684\u3002\u4F46\u662F\u63A5\u53E3\u6162\u7684\u65F6\u5019\uFF0Ca\u63A5\u53E3\u90FD\u5FEB\u8981\u8BF7\u6C42\u5B8C\u6210\u4E86\uFF0C\u8FD9\u65F6\u7ED9\u5B83\u6765\u4E86\u4E2A\u53D6\u6D88\uFF0C\u5F88\u6D6A\u8D39\u540E\u7AEF\u8D44\u6E90\uFF0C\u5C31\u662F\u7B2C\u4E00\u4E2A\u63A5\u53E3a\u540E\u7AEF\u5DF2\u7ECF\u5DEE\u4E0D\u591A\u5904\u7406\u597D\u6570\u636E\uFF0C\u6B63\u51C6\u5907\u8FD4\u56DE\u7684\u65F6\u5019\uFF0C\u524D\u7AEF\u7A81\u7136\u4E2D\u65AD\u5B83\uFF0C\u7136\u540E\u518D\u53D1\u8D77\u4E00\u4E2A\u76F8\u540C\u7684\u63A5\u53E3a2\uFF0C\u540E\u7AEF\u53C8\u8981\u91CD\u65B0\u5904\u7406\u4E00\u904D\uFF0C\u56E0\u6B64\u4E0D\u592A\u5408\u7406\u3002</p><h3 id="axios-\u7684-canceltoken" tabindex="-1"><a class="header-anchor" href="#axios-\u7684-canceltoken" aria-hidden="true">#</a> axios \u7684 cancelToken</h3><p>\u5728axios\u5B98\u65B9\u6587\u6863\u4E0A\u8981\u53D6\u6D88\u4E00\u4E2A\u6B63\u5728\u53D1\u51FA\u6216\u5DF2\u53D1\u51FA\u4F46\u662F\u8FD8\u6CA1\u6709\u8FD4\u56DE\u6570\u636E\u7684\u8BF7\u6C42\uFF0C\u7528\u5230\u7684\u662Faxios.CancelToken\u8FD9\u4E2A\u5BF9\u50CF\u91CC\u9762\u7684\u65B9\u6CD5\uFF0C\u5B98\u65B9\u6848\u4F8B\u5982\u4E0B\uFF1A</p><p>\u7B2C\u4E00\u79CD\u65B9\u6CD5\uFF1A\u4F7F\u7528 CancelToken.source \u5DE5\u5382\u65B9\u6CD5\u521B\u5EFA cancel token\uFF0C\u50CF\u8FD9\u6837\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/user/12345&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Request canceled&#39;</span><span class="token punctuation">,</span> thrown<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token comment">// \u5904\u7406\u9519\u8BEF</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/user/12345&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#39;new name&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u53D6\u6D88\u8BF7\u6C42\uFF08message \u53C2\u6570\u662F\u53EF\u9009\u7684\uFF09</span>
source<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">&#39;Operation canceled by the user.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B2C\u4E8C\u79CD\u65B9\u6CD5\uFF1A \u901A\u8FC7\u4F20\u9012\u4E00\u4E2A executor \u51FD\u6570\u5230 CancelToken \u7684\u6784\u9020\u51FD\u6570\u6765\u521B\u5EFA cancel token\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">let</span> cancel<span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/user/12345&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// executor \u51FD\u6570\u63A5\u6536\u4E00\u4E2A cancel \u51FD\u6570\u4F5C\u4E3A\u53C2\u6570</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cancel the request</span>
<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4E24\u79CD\u65B9\u6CD5\u7684\u533A\u522B\u4E0E\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#\u4E24\u79CD\u65B9\u6CD5\u7684\u533A\u522B\u4E0E\u5E94\u7528" aria-hidden="true">#</a> \u4E24\u79CD\u65B9\u6CD5\u7684\u533A\u522B\u4E0E\u5E94\u7528</h3><p>\u7B2C\u4E00\u79CD\u65B9\u6CD5\u662F\u591A\u4E2A\u8BF7\u6C42\u5171\u7528\u4E00\u4E2Atoken,\u9002\u5408\u5728\u67D0\u4E00\u65F6\u95F4\u540C\u65F6\u53D6\u6D88\u6240\u6709\u8BF7\u6C42\uFF0C\u7B2C\u4E8C\u79CD\u65B9\u6CD5\u6BCF\u4E2A\u8BF7\u6C42\u6709\u72EC\u7ACB\u7684token,\u9002\u5408\u6BCF\u4E2A\u8BF7\u6C42\u5206\u60C5\u51B5\u662F\u5426\u8FDB\u884C\u5355\u72EC\u53D6\u6D88\u3002</p><p>\u6839\u636E\u6211\u4EEC\u7684\u9700\u6C42\uFF0C\u5F88\u660E\u663E\u6211\u4EEC\u8981\u91C7\u7528\u7B2C\u4E8C\u79CD\u66F4\u52A0\u7075\u6D3B\u3002</p><h3 id="canceltoken\u7684\u6E90\u7801\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#canceltoken\u7684\u6E90\u7801\u5206\u6790" aria-hidden="true">#</a> cancelToken\u7684\u6E90\u7801\u5206\u6790</h3><p>\u4E3A\u4E86\u8BA9\u5927\u5BB6\u66F4\u52A0\u76F4\u89C2\u4E86\u89E3cancelToken\u662F\u5982\u4F55\u505A\u5230\u751F\u6210\u4EE4\u724C\uFF0C\u901A\u8FC7\u4EE4\u724C\u662F\u53D6\u6D88\u63A5\u53E3\uFF0C\u6211\u4EEC\u5BF9\u6E90\u7801\u8FDB\u884C\u4E00\u6CE2\u5206\u6790\uFF0C\u8BA9\u5927\u5BB6\u4E86\u89E3\u4E00\u4E0B\u4ED6\u7684\u8BBE\u8BA1\u601D\u60F3</p><p>\u5148\u770B\u5B98\u65B9\u7684\u6E90\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u8DEF\u5F84\u5728\uFF1A node_module/axios/lib/cancel/CancelToken.js</span>

<span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Cancel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./Cancel&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">CancelToken</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> executor <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&#39;executor must be a function.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
    * \u5B9A\u4E49\u4E00\u4E2A\u5C06\u6765\u80FD\u6267\u884C\u53D6\u6D88\u8BF7\u6C42\u7684promise\u5BF9\u8C61\uFF0C\u5F53\u8FD9\u4E2Apromise\u7684\u72B6\u6001\u4E3A\u5B8C\u6210\u65F6(fullfilled),
    * \u5C31\u4F1A\u89E6\u53D1\u53D6\u6D88\u8BF7\u6C42\u7684\u64CD\u4F5C\uFF08\u6267\u884Cthen\u51FD\u6570\uFF09\u3002\u800C\u6267\u884Cresolve\u5C31\u80FD\u5C06promise\u7684\u72B6\u6001\u7F6E\u4E3A\u5B8C\u6210\u72B6\u6001\u3002
    * \u8FD9\u91CC\u628Aresolve\u8D4B\u503C\u7ED9resolvePromise\uFF0C\u5C31\u662F\u4E3A\u4E86\u5728\u8FD9\u4E2Apromise\u5916\u80FD\u6267\u884Cresolve\u800C\u6539\u53D8\u8FD9\u4E2Apromise\u7684\u72B6\u6001
    * \u6CE8\u610F\u8FD9\u4E2Apromise\u5BF9\u8C61\u88AB\u8D4B\u503C\u7ED9CancelToken\u5B9E\u4F8B\u7684\u5C5E\u6027promise\uFF0C\u5C06\u6765\u5B9A\u4E49then\u51FD\u6570\u5C31\u662F\u901A\u8FC7\u8FD9\u4E2A\u5C5E\u6027\u5F97\u5230promise
    */</span>
    <span class="token keyword">var</span> resolvePromise<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">promiseExecutor</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resolvePromise <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
    * \u5C06CancelToken\u5B9E\u4F8B\u8D4B\u503C\u7ED9token
    * \u6267\u884Cexecutor\u51FD\u6570\uFF0C\u5C06cancel\u65B9\u6CD5\u4F20\u5165executor\uFF0C
    * cancel\u65B9\u6CD5\u53EF\u8C03\u7528resolvePromise\u65B9\u6CD5\uFF0C\u5373\u89E6\u53D1\u53D6\u6D88\u8BF7\u6C42\u7684\u64CD\u4F5C
    */</span>
    <span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u53D6\u6D88\u5DF2\u54CD\u5E94 \u8FD4\u56DE</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        token<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u8FD9\u91CC\u6267\u884C\u7684\u5C31\u662Fpromise\u7684resolve\u65B9\u6CD5\uFF0C\u6539\u53D8\u72B6\u6001</span>
        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">CancelToken</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">throwIfRequested</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">throwIfRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// \u8FD9\u91CC\u53EF\u4EE5\u770B\u6E05\u695Asource\u51FD\u6570\u7684\u771F\u9762\u76EE</span>
CancelToken<span class="token punctuation">.</span><span class="token function-variable function">source</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> cancel<span class="token punctuation">;</span>
    <span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// c \u5C31\u662FCancelToken\u4E2D\u7ED9executor\u4F20\u5165\u7684cancel\u65B9\u6CD5</span>
        cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">token</span><span class="token operator">:</span> token<span class="token punctuation">,</span>
        <span class="token literal-property property">cancel</span><span class="token operator">:</span> cancel
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CancelToken<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>CancelToken</code>\u662F\u4E00\u4E2A\u6784\u9020\u51FD\u6570\uFF0C\u901A\u8FC7<code>new CancelToken()</code>\u5F97\u5230\u7684\u662F\u4E00\u4E2A\u5B9E\u4F8B\u5BF9\u8C61\uFF0C\u5B83\u53EA\u6709\u4E00\u4E2A\u5C5E\u6027<code>promise</code>, \u5B83\u7684\u503C\u662F\u4E00\u4E2A\u80FD\u89E6\u53D1\u53D6\u6D88\u8BF7\u6C42\u7684Promise\u5BF9\u8C61\u3002</p><pre><code>token = new CancelToken(executor function) ===&gt; { promise: Promise\u5BF9\u8C61 }
</code></pre><p>\u6267\u884CCancelToken\u51FD\u6570\u505A\u4E86\u4E24\u4EF6\u4E8B\uFF1A</p><ol><li>\u521B\u5EFA\u4E00\u4E2APromise\u5BF9\u8C61\uFF0C\u4E14\u5C06\u8FD9\u4E2A\u5BF9\u8C61\u8D4B\u503C\u7ED9promise\u5C5E\u6027\uFF0C\u5176resolve\u53C2\u6570\u88AB\u66B4\u9732\u51FA\u6765\u4EE5\u5907cancel\u51FD\u6570\u6267\u884C\u3002\u8FD9\u4E2A\u5C31\u662F\u70B9\u775B\u4E4B\u7B14\uFF0C\u901A\u8FC7\u66B4\u9732resolve\u7ED9\u5168\u5C40\u53D8\u91CF\uFF0C\u8BA9promise\u89E6\u53D1\u65F6\u673A\uFF0C\u7531\u5916\u9762\u7684\u65B9\u6CD5\u6240\u63A7\u5236\u3002</li><li>\u6267\u884C<code>executor</code>\u51FD\u6570\uFF0C\u5C06\u5185\u90E8\u5B9A\u4E49\u7684<code>cancel</code>\u51FD\u6570\u4F5C\u4E3A\u53C2\u6570\u4F20\u9012\u7ED9<code>executor</code></li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u6E90\u7801\u76F8\u5F53\u4E8E\uFF1A</span>
<span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u53D6\u6D88\u52A8\u4F5C\u5DF2\u54CD\u5E94 \u8FD4\u56DE</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    token<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u8FD9\u91CC\u6267\u884C\u7684\u5C31\u662Fpromise\u7684resolve\u65B9\u6CD5\uFF0C\u6539\u53D8\u72B6\u6001</span>
    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">executor</span><span class="token punctuation">(</span>cancel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6240\u4EE5\u6267\u884C</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">let</span> cancel
token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56E0\u6B64\u5F97\u5230\u7ED3\u679C\u662F\uFF1A</p><ul><li>token\u503C\u4E3A{promise: Promise\u5BF9\u8C61}</li><li>executor\u51FD\u6570\u88AB\u6267\u884C\uFF0C\u5373cancel = c\u6267\u884C\uFF0C\u56E0\u6B64\u53D8\u91CFcancel\u88AB\u8D4B\u503C\u4E86\uFF0C\u503C\u5C31\u662FCanelToken\u5185\u90E8\u7684\u90A3\u4E2Acancel\u51FD\u6570\u3002</li></ul><h3 id="canceltoken\u7684\u5B9E\u9645\u5E94\u7528" tabindex="-1"><a class="header-anchor" href="#canceltoken\u7684\u5B9E\u9645\u5E94\u7528" aria-hidden="true">#</a> CancelToken\u7684\u5B9E\u9645\u5E94\u7528</h3><p>\u4E0A\u9762\u6211\u4EEC\u8BB2\u660E\u767D\u4E86\u539F\u7406\uFF0C\u4E0B\u9762\u8BB2\u4E00\u4E0B\u5B9E\u9645\u5982\u4F55\u4F7F\u7528</p>`,74),P=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[s(`
`),n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@description"),s(` \u6DFB\u52A0\u8BF7\u6C42\uFF0C\u521B\u5EFA\u53D6\u6D88\u8BF7\u6C42\u7684\u4EE4\u724C\uFF0C\u628Atoken\u548C\u63A5\u53E3\u4FE1\u606F\u4F5C\u4E3A\u952E\u503C\u5BF9\u4FDD\u5B58\u5230map
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"config"),s(` 
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"addPending"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token operator"},":"),s(" AxiosRequestConfig"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" url "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getPendingUrl"),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("pendingMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"has"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u5982\u679C pending \u4E2D\u4E0D\u5B58\u5728\u5F53\u524D\u8BF7\u6C42\uFF0C\u5219\u6DFB\u52A0\u8FDB\u53BB,"),s(`
    config`),n("span",{class:"token punctuation"},"."),s("cancelToken "),n("span",{class:"token operator"},"="),s(`
      config`),n("span",{class:"token punctuation"},"."),s("cancelToken "),n("span",{class:"token operator"},"||"),s(`
      `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"axios"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CancelToken"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("cancel"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// \u628A\u7B2C\u4E00\u4E2A\u63A5\u53E3\u7684token\u4FDD\u5B58\u8D77\u6765"),s(`
        pendingMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},","),s(" cancel"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u5982\u4F55pending\u4E2D\u5B58\u5728\u5F53\u524D\u8BF7\u6C42\uFF0C\u5219\u9A6C\u4E0A\u53D6\u6D88\u5F53\u524D\u8BF7\u6C42\uFF0C\u5E76\u79FB\u9664\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u662F\u53D6\u6D88\u7B2C\u4E8C\u6B21\u91CD\u590D\u8BF7\u6C42\uFF0C\u4FDD\u7559\u7B2C\u4E00\u6B21\u8BF7\u6C42"),s(`
    config`),n("span",{class:"token punctuation"},"."),s("cancelToken "),n("span",{class:"token operator"},"="),s(" config"),n("span",{class:"token punctuation"},"."),s("cancelToken "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"axios"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CancelToken"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("cancle"),n("span",{class:"token operator"},":"),s(" Canceler"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token function"},"cancle"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"\u91CD\u590D\u7684\u8BF7\u6C42\u88AB\u4E3B\u52A8\u62E6\u622A:  method: "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("config"),n("span",{class:"token punctuation"},"."),s("method"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," --> "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("config"),n("span",{class:"token punctuation"},"."),s("url"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," --> "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("qs"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stringify"),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},","),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("qs"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"stringify"),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token punctuation"},"."),s("params"),n("span",{class:"token punctuation"},")"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@description"),s(` \u6E05\u9664\u5F53\u524D\u8BF7\u6C42\u961F\u5217\u7684\u6570\u636E\u3002\u8FD9\u4E2A\u65B9\u6CD5\u4FDD\u7559\u7B2C\u4E00\u4E2A\u8BF7\u6C42\uFF0C\u53D6\u6D88\u540E\u9762\u53D1\u8D77\u7684\u8BF7\u6C42
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"config"),s(` 
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"removePendingMap"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token operator"},":"),s(" AxiosRequestConfig"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  config`),n("span",{class:"token punctuation"},"."),s("data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"typeof"),s(" config"),n("span",{class:"token punctuation"},"."),s("data "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'string'"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token constant"},"JSON"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"parse"),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},":"),s(" config"),n("span",{class:"token punctuation"},"."),s(`data
  `),n("span",{class:"token keyword"},"const"),s(" url "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getPendingUrl"),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  pendingMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"delete"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),D=n("p",null,"\u4E0A\u9762\u7684\u548C\u4E0B\u9762\u7684\u4EE3\u7801\u6709\u4F55\u533A\u522B\u5462\uFF1F\uFF1F\uFF1F",-1),L=n("p",null,"\u4E0A\u9762\u7684\u4EE3\u7801\u4E3A\u4E86\u662F\u4FDD\u7559\u7B2C\u4E00\u4E2A\u63A5\u53E3\uFF0C\u53D6\u6D88\u540E\u9762\u65B0\u589E\u7684\u91CD\u590D\u63A5\u53E3",-1),O=n("p",null,"\u4E0B\u9762\u7684\u4EE3\u7801\u4E3B\u8981\u662F\u53D6\u6D88\u524D\u9762\u91CD\u590D\u7684\u63A5\u53E3\uFF0C\u4FDD\u7559\u540E\u9762\u6700\u540E\u4E00\u6B21\u7684\u63A5\u53E3\u3002",-1),U=n("p",null,[s("\u4E3B\u8981\u8981\u9009\u7528\u90A3\u79CD\u65B9\u6CD5\uFF0C\u53D6\u51B3\u4E8E"),n("code",null,"\u6DFB\u52A0pending"),s("\u7684\u65B9\u6CD5\u5982\u4F55\u5B9E\u73B0\u3002")],-1),I=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token doc-comment comment"},[s(`/**
 * cancel\u8FD9\u91CC\u8C03\u7528\u6709\u4E2A\u95EE\u9898,\u5C31\u662F\u5982\u679C\u4F60\u5728response\u7684\u54CD\u5E94\u4F53
 * `),n("span",{class:"token keyword"},"@description"),s(`  \u79FB\u9664\u8BF7\u6C42\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u662F\u540C\u65F6\u591A\u4E2A\u91CD\u590D\u63A5\u53E3\uFF0C\u6E05\u9664\u524D\u9762\u591A\u4F59\u63A5\u53E3\uFF0C\u4FDD\u7559\u6700\u540E\u4E00\u6B21\u8BF7\u6C42
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token punctuation"},"{"),s("CustomAxiosRequestConfig"),n("span",{class:"token punctuation"},"}"),s(` config 
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"removePending"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token operator"},":"),s(" AxiosRequestConfig"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" url "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getPendingUrl"),n("span",{class:"token punctuation"},"("),s("config"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("pendingMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"has"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// \u5982\u679C\u5728 pending \u4E2D\u5B58\u5728\u5F53\u524D\u8BF7\u6C42\u6807\u8BC6\uFF0C\u9700\u8981\u53D6\u6D88\u5F53\u524D\u8BF7\u6C42\uFF0C\u5E76\u4E14\u79FB\u9664"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" cancel "),n("span",{class:"token operator"},"="),s(" pendingMap"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// js\u7684\u77ED\u8DEF\u8FD0\u7B97"),s(`
    `),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("cancel"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"// cancel && cancel(`\u91CD\u590D\u7684\u8BF7\u6C42\u88AB\u4E3B\u52A8\u62E6\u622A:  method: ${config.method} --> ${config.url} --> ${qs.stringify(config.data)},${qs.stringify(config.params)}`);"),s(`
    pendingMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"delete"),n("span",{class:"token punctuation"},"("),s("url"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token doc-comment comment"},[s(`/**
 * \u7528\u4E8E\u53EF\u4EE5\u5728\u9875\u9762\u4E0A\u4E00\u6B21\u6027\u53D6\u6D88\u6240\u6709\u63A5\u53E3\u7684\u8BF7\u6C42
 * `),n("span",{class:"token keyword"},"@description"),s(`: \u6E05\u7A7A\u6240\u6709pending
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"removeAllPending"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  pendingMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("cancel"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    cancel `),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token function"},"isFunction"),n("span",{class:"token punctuation"},"("),s("cancel"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token function"},"cancel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'\u6E05\u9664\u591A\u4E2A\u91CD\u590D\u8BF7\u6C42'"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  pendingMap`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"clear"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),B=n("p",null,"\u8FD9\u91CC\u7684\u65B9\u6CD5\u4E3B\u8981\u7684\u4F5C\u7528\u662F\uFF0C\u653E\u5728\u8DEF\u7531\u5B88\u536B\u7684\u65B9\u6CD5\u8C03\u7528\u91CC\u9762\uFF0C\u9488\u5BF9\u8DEF\u7531\u7684\u6539\u53D8\uFF0C\u53D6\u6D88\u4E0A\u4E00\u4E2A\u9875\u9762\u6CA1\u6709\u5B8C\u6210\u7684\u6240\u6709\u63A5\u53E3",-1),j=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token comment"},"// \u8DEF\u5F84\uFF1Asrc/router/routeGuard.ts"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" removeAllPending "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"@/utils/http/axiosCancle"'),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" Router "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},'"vue-router"'),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@description"),s(` \u521B\u5EFA\u8DEF\u7531\u5B88\u536B
 * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"router"),s(` 
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"createRouterGuards"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("router"),n("span",{class:"token operator"},":"),s(" Router"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    router`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"beforeEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),s("to"),n("span",{class:"token punctuation"},","),s(" from"),n("span",{class:"token punctuation"},","),s(" next"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"removeAllPending"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),F=l('<p>\u4E0A\u9762\u91CD\u8981\u7684\u77E5\u8BC6\u70B9\u662F\uFF1Aes6\u8BED\u6CD5\u4E2D\u7684Map\u7684\u65B9\u6CD5\u7684\u5177\u4F53\u4F7F\u7528\u3002\u6709\u5174\u8DA3\u7684\u540C\u5B66\uFF0C\u767E\u5EA6\u67E5\u4E00\u4E0B\u5177\u4F53\u7528\u6CD5\u3002</p><h2 id="loading\u7684\u663E\u793A\u548C\u9690\u85CF" tabindex="-1"><a class="header-anchor" href="#loading\u7684\u663E\u793A\u548C\u9690\u85CF" aria-hidden="true">#</a> loading\u7684\u663E\u793A\u548C\u9690\u85CF</h2><h3 id="\u4EE3\u7801\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u4EE3\u7801\u8BF4\u660E" aria-hidden="true">#</a> \u4EE3\u7801\u8BF4\u660E</h3><ol><li>\u57FA\u672C\u539F\u7406\u662F\u901A\u8FC7 axios \u63D0\u4F9B\u7684\u8BF7\u6C42\u62E6\u622A\u548C\u54CD\u5E94\u62E6\u622A\u7684\u63A5\u53E3\uFF0C\u63A7\u5236 loading \u7684\u663E\u793A\u6216\u8005\u9690\u85CF\u3002</li><li>loding \u6548\u679C\u8FD9\u91CC\u91C7\u7528\u7684\u662F ionic \u4E2D\u63D0\u4F9B\u7684 loadingController \u7EC4\u4EF6\u6765\u5B9E\u73B0</li><li>\u5185\u90E8\u6709\u4E2A\u8BA1\u6570\u5668\uFF0C\u786E\u4FDD\u540C\u4E00\u65F6\u523B\u5982\u679C\u6709\u591A\u4E2A\u8BF7\u6C42\u7684\u8BDD\uFF0C\u4E0D\u4F1A\u540C\u65F6\u51FA\u73B0\u591A\u4E2A loading\uFF0C\u800C\u662F\u53EA\u6709 1 \u4E2A\u3002\u5E76\u4E14\u5728\u6240\u6709\u8BF7\u6C42\u7ED3\u675F\u540E\u624D\u4F1A\u9690\u85CF loading\u3002</li><li>\u4F7F\u7528\u4E86 lodash \u7684 debounce \u9632\u6296\u3002\u56E0\u4E3A\u6709\u65F6\u4F1A\u78B0\u5230\u5728\u4E00\u6B21\u8BF7\u6C42\u5B8C\u6BD5\u540E\u53C8\u7ACB\u523B\u53C8\u53D1\u8D77\u4E00\u4E2A\u65B0\u7684\u8BF7\u6C42\u7684\u60C5\u51B5\uFF08\u6BD4\u5982\u5220\u9664\u4E00\u4E2A\u8868\u683C\u6761\u76EE\u540E\u7ACB\u523B\u8FDB\u884C\u5237\u65B0\uFF09\u3002\u8FD9\u79CD\u60C5\u51B5\u4F1A\u9020\u6210\u8FDE\u7EED loading \u4E24\u6B21\uFF0C\u5E76\u4E14\u4E2D\u95F4\u6709\u4E00\u6B21\u6781\u77ED\u7684\u95EA\u70C1\u3002\u901A\u8FC7\u9632\u6296\u53EF\u4EE5\u8BA9 300ms \u95F4\u9694\u5185\u7684 loading \u4FBF\u5408\u5E76\u4E3A\u4E00\u6B21\uFF0C\u907F\u514D\u95EA\u70C1\u7684\u60C5\u51B5\u3002</li><li>\u9ED8\u8BA4\u6240\u6709\u8BF7\u6C42\u90FD\u4F1A\u81EA\u52A8\u6709 loading \u6548\u679C\u3002\u5982\u679C\u67D0\u4E2A\u8BF7\u6C42\u4E0D\u9700\u8981 loading \u6548\u679C\uFF0C\u53EF\u4EE5\u5728\u8BF7\u6C42\u53C2\u6570AxiosRequestConfig\u4E2D\u8BBE\u7F6EisLoading\u8BBE\u7F6E\u4E3Afalse</li></ol>',4),N=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[s(`
`),n("span",{class:"token comment"},"// \u4FDD\u5B58\u5B9A\u65F6\u5668\uFF0C\u4EE5\u4FBF\u65B9\u4FBF\u53D6\u6D88"),s(`
`),n("span",{class:"token keyword"},"let"),s(" timer"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"//\u5F53\u524D\u6B63\u5728\u8BF7\u6C42\u7684\u6570\u91CF"),s(`
`),n("span",{class:"token keyword"},"let"),s(" currentLoadingRequestCount "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@description"),s(` \u663E\u793Aloading\u754C\u9762
 * \u8BF7\u6C42\u5982\u679C\u8D85\u8FC7300ms\uFF0C\u5C31\u4F1A\u53D1\u8D77loading\uFF0C\u5982\u679C\u4F4E\u4E8E300ms\uFF0C\u4E0D\u4F1A\u4EA7\u751Floading\u754C\u9762
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"showLoading"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("timer"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        timer `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"setTimeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token comment"},"// loadObject = new LoadingService();"),s(`
            loadObject`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"present"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"300"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    currentLoadingRequestCount`),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),H=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@description"),s(` \u9690\u85CFloading\u7684\u754C\u9762
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"hideLoading"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    currentLoadingRequestCount`),n("span",{class:"token operator"},"--"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// \u9632\u6B62\u51FA\u73B0\u8D1F\u6570\uFF0C\u6700\u4F4E\u662F0\uFF1B"),s(`
    currentLoadingRequestCount `),n("span",{class:"token operator"},"="),s(" Math"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"max"),n("span",{class:"token punctuation"},"("),s("currentLoadingRequestCount"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("currentLoadingRequestCount "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// \u4E0D\u7BA1300ms\u662F\u5426\u8FBE\u5230\uFF0C\u53D6\u6D88\u6296\u52A8\u7684\u5B9A\u65F6\u5668\u3002"),s(`
        timer `),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token function"},"clearTimeout"),n("span",{class:"token punctuation"},"("),s("timer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        timer `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// \u5173\u95ED\u5F39\u7A97\uFF0C\u9632\u6296\uFF1A\u5C06 300ms \u95F4\u9694\u5185\u7684\u5173\u95ED loading \u4FBF\u5408\u5E76\u4E3A\u4E00\u6B21\u3002\u9632\u6B62\u8FDE\u7EED\u8BF7\u6C42\u65F6\uFF0C loading\u95EA\u70C1\u7684\u95EE\u9898\u3002"),s(`
        _`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"debounce"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
            loadObject `),n("span",{class:"token operator"},"&&"),s(" loadObject"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"dismiss"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token comment"},"// loadObject = null;"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"300"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        
    `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),G=n("h2",{id:"\u5982\u4F55\u91CD\u8BD5\u8BF7\u6C42",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5982\u4F55\u91CD\u8BD5\u8BF7\u6C42","aria-hidden":"true"},"#"),s(" \u5982\u4F55\u91CD\u8BD5\u8BF7\u6C42")],-1),$=n("p",null,"\u8FD9\u91CC\u4E3B\u8981\u5C01\u88C5\u5173\u4E8Ehttp\u51FA\u73B0\u7F51\u7EDC\u9519\u8BEF\u6216\u5E42\u7B49\u8BF7\u6C42\uFF08GET\u3001HEAD\u3001OPTIONS\u3001PUT \u6216 DELETE\uFF09\u4E0A\u7684 5xx \u9519\u8BEF\uFF0Chttp\u8BF7\u6C42\u5C06\u4F1A\u91CD\u8FDE\u7684\u64CD\u4F5C",-1),Q=s("\u8FD9\u91CC\u8BBE\u8BA1\u4E86\u4E00\u4E2Ahttp\u7684\u6982\u5FF5\uFF1A"),Y={href:"https://www.zuimoban.com/php/other/7171_2.html",target:"_blank",rel:"noopener noreferrer"},z=s("\u5E42\u7B49\u8BF7\u6C42"),V=n("p",null,"\u9488\u5BF9\u662F\u5426\u8FBE\u5230\u91CD\u8BD5\u7684\u6761\u4EF6\uFF0C\u6211\u505A\u4E86\u4EE5\u4E0B\u5224\u65AD",-1),J=n("p",null,[s("\u8FD9\u91CC\u6D89\u53CA\u4E86\u4E00\u4E2A\u65B0\u7684\u5E93\uFF0C"),n("code",null,"is-retry-allowed"),s("\u68C0\u67E5\u662F\u5426\u8BF7\u6C42\u53EF\u4EE5\u57FA\u4E8E\u91CD\u8BD5error.code")],-1),W=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(" isRetryAllowed "),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'is-retry-allowed'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"isNetworkError"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s("  "),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token builtin"},"console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},"."),s("config"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),s(`
        `),n("span",{class:"token operator"},"!"),s("error"),n("span",{class:"token punctuation"},"."),s("response "),n("span",{class:"token operator"},"&&"),s(`
        `),n("span",{class:"token function"},"Boolean"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},"."),s("code"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token comment"},"// \u9632\u6B62\u91CD\u8BD5\u5DF2\u53D6\u6D88\u7684\u8BF7\u6C42"),s(`
        `),n("span",{class:"token function"},"isRetryAllowed"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// \u9632\u6B62\u91CD\u8BD5\u4E0D\u5B89\u5168\u7684\u9519\u8BEF"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),X=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token doc-comment comment"},[s(`/**
* `),n("span",{class:"token keyword"},"@param"),s("  "),n("span",{class:"token punctuation"},"{"),s("Error"),n("span",{class:"token punctuation"},"}"),s(`  error
* `),n("span",{class:"token keyword"},"@return"),s(),n("span",{class:"token punctuation"},"{"),s("boolean"),n("span",{class:"token punctuation"},"}"),s(`
*/`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"isRetryableError"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),s(`
        `),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("error"),n("span",{class:"token punctuation"},"."),s("response "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},"."),s("response"),n("span",{class:"token punctuation"},"."),s("status "),n("span",{class:"token operator"},">="),s(),n("span",{class:"token number"},"500"),s(),n("span",{class:"token operator"},"&&"),s(" error"),n("span",{class:"token punctuation"},"."),s("response"),n("span",{class:"token punctuation"},"."),s("status "),n("span",{class:"token operator"},"<="),s(),n("span",{class:"token number"},"599"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),K=n("div",{class:"language-typescript ext-ts line-numbers-mode"},[n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"SAFE_HTTP_METHODS"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'get'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'head'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'options'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"IDEMPOTENT_HTTP_METHODS"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token constant"},"SAFE_HTTP_METHODS"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"concat"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'put'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'delete'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token doc-comment comment"},[s(`/**
 * `),n("span",{class:"token keyword"},"@param"),s("  "),n("span",{class:"token punctuation"},"{"),s("Error"),n("span",{class:"token punctuation"},"}"),s(`  error
 * `),n("span",{class:"token keyword"},"@return"),s(),n("span",{class:"token punctuation"},"{"),s("boolean"),n("span",{class:"token punctuation"},"}"),s(`
 */`)]),s(`
`),n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"isIdempotentRequestError"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("error"),n("span",{class:"token punctuation"},"."),s("config"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// \u65E0\u6CD5\u786E\u5B9A\u662F\u5426\u53EF\u4EE5\u91CD\u8BD5\u8BF7\u6C42"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"isRetryableError"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token constant"},"IDEMPOTENT_HTTP_METHODS"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"indexOf"),n("span",{class:"token punctuation"},"("),s("error"),n("span",{class:"token punctuation"},"."),s("config"),n("span",{class:"token punctuation"},"."),s("method"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Z=l(`<h3 id="\u6838\u5FC3\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#\u6838\u5FC3\u5B9E\u73B0" aria-hidden="true">#</a> \u6838\u5FC3\u5B9E\u73B0</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> \u54CD\u5E94\u5931\u8D25\u62E6\u622A\u5668 \u7EDF\u4E00\u5904\u7406http\u5F02\u5E38
 * <span class="token keyword">@param</span> <span class="token parameter">error</span> CustomAxiosError \u81EA\u5B9A\u4E49\u7C7B\u578B
 * <span class="token keyword">@returns</span> 
 * <span class="token keyword">@description</span> \u6CE8\u610F\u5982\u679C\u53D6\u6D88\u8BF7\u6C42\uFF0C\u4E00\u6837\u8D70responseFail\u7684\u6D41\u7A0B
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseFail</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> AxiosError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// more something code</span>

  <span class="token comment">// \u4EE5\u4E0B\u662F\u91CD\u8BD5\u903B\u8F91</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">.</span>config <span class="token operator">||</span> <span class="token operator">!</span>error<span class="token punctuation">.</span>config<span class="token punctuation">.</span>retries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>config<span class="token punctuation">}</span> <span class="token operator">=</span> error<span class="token punctuation">;</span>
        config<span class="token punctuation">.</span>retryCount <span class="token operator">=</span> config<span class="token punctuation">.</span>retryCount <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> shouldRetry <span class="token operator">=</span> <span class="token function">isNetworkOrIdempotentRequestErrors</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>retryCount  <span class="token operator">&lt;</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>retries <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldRetry<span class="token punctuation">)</span><span class="token punctuation">{</span>
            config<span class="token punctuation">.</span>retryCount <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                config<span class="token punctuation">.</span>url <span class="token operator">=</span> config<span class="token punctuation">.</span>oldURL<span class="token punctuation">;</span>
                config<span class="token punctuation">.</span>params <span class="token operator">=</span> config<span class="token punctuation">.</span>oldParams<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>retryDelay <span class="token operator">||</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5237\u65B0token" tabindex="-1"><a class="header-anchor" href="#\u5237\u65B0token" aria-hidden="true">#</a> \u5237\u65B0token</h2><p>\u9879\u76EE\u4E00\u76F4\u5B58\u5728\u4E00\u4E2A\u9700\u6C42\uFF1A\u524D\u7AEF\u767B\u5F55\u540E\uFF0C\u540E\u7AEF\u8FD4\u56DEtoken\uFF0C\u5F53\u63A5\u53E3\u8FD4\u56DEtoken\u8FC7\u671F\u65F6\uFF0C\u8981\u6C42\u7528\u767B\u5F55\u63A5\u53E3\uFF0C\u9ED8\u9ED8\u767B\u5F55\uFF0C\u83B7\u53D6\u65B0\u7684token\uFF0C\u524D\u7AEF\u9700\u8981\u505A\u5230\u65E0\u75DB\u5237\u65B0token\uFF0C\u5373\u8BF7\u6C42\u5237\u65B0token\u65F6\u8981\u505A\u5230\u7528\u6237\u65E0\u611F\u77E5\u3002</p><h3 id="\u5B9E\u73B0\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u601D\u8DEF" aria-hidden="true">#</a> \u5B9E\u73B0\u601D\u8DEF</h3><p>\u62E6\u622A\u63A5\u53E3\u8FD4\u56DE\u540E\u7684\u6570\u636E\u3002\u68C0\u67E5\u5982\u679C\u662Ftoken\u8FC7\u671F\u7684\u72B6\u6001\u7801\uFF0C\u5148\u53D1\u8D77\u767B\u5F55\u8BF7\u6C42\uFF0C\u83B7\u53D6\u63A5\u53E3\u8FD4\u56DE\u7684\u65B0token\uFF0C\u4FDD\u5B58\u5230\u672C\u5730\uFF0C\u518D\u8FDB\u884C\u6240\u6709\u63A5\u53E3\u7684\u91CD\u8BD5\u3002</p><h3 id="\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> \u4EE3\u7801\u5B9E\u73B0</h3><p>\u540E\u7AEF\u63A5\u53E3\u4E00\u822C\u4F1A\u6709\u4E00\u4E2A\u7EA6\u5B9A\u597D\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u5982\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span><span class="token literal-property property">RetCode</span><span class="token operator">:</span> <span class="token number">2002</span><span class="token punctuation">,</span> <span class="token literal-property property">Message</span><span class="token operator">:</span> <span class="token string">&#39;token\u8FC7\u671F&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">ReturnData</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u6211\u8FD9\u91CC\uFF0C\u540E\u7AEF\u7EA6\u5B9A\u5F53{RetCode === 2002\u65F6\u8868\u793Atoken\u8FC7\u671F\u4E86\uFF0C\u6B64\u65F6\u5C31\u8981\u6C42\u5237\u65B0token\u3002\u6211\u4E3B\u8981\u4F7F\u7528\u7684\u54CD\u5E94\u62E6\u622A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: \u8BF7\u6C42\u7ED3\u679C\u96C6
 */</span>
<span class="token keyword">export</span> <span class="token keyword">enum</span> ResultEnum <span class="token punctuation">{</span>
    <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token comment">// \u67E5\u8BE2\u6210\u529F\u3001\u64CD\u4F5C\u6210\u529F  </span>
    <span class="token constant">ERROR</span> <span class="token operator">=</span> <span class="token number">1002</span><span class="token punctuation">,</span>   <span class="token comment">// \u64CD\u4F5C\u5931\u8D25\u3001\u67E5\u8BE2\u5931\u8D25  </span>
    <span class="token constant">STYSTEM_ERROR</span> <span class="token operator">=</span> <span class="token number">2001</span><span class="token punctuation">,</span> <span class="token comment">// \u7CFB\u7EDF\u5F02\u5E38  </span>
    <span class="token constant">LOGIN_FAIL</span> <span class="token operator">=</span> <span class="token number">2002</span><span class="token punctuation">,</span>    <span class="token comment">// \u767B\u5F55\u8EAB\u4EFD\u9A8C\u8BC1\u5931\u6548</span>
    <span class="token constant">DOUBLE_REQUEST</span> <span class="token operator">=</span> <span class="token number">2003</span><span class="token punctuation">,</span> <span class="token comment">// \u91CD\u590D\u8BF7\u6C42</span>
    <span class="token constant">PARAMAR_ERROR</span> <span class="token operator">=</span> <span class="token number">2004</span><span class="token punctuation">,</span>  <span class="token comment">// \u53C2\u6570\u4E0D\u7B26\u5408\u8981\u6C42</span>
    <span class="token constant">APPID_LOWER</span> <span class="token operator">=</span> <span class="token number">2005</span><span class="token punctuation">,</span>  <span class="token comment">// APP\u7248\u672C\u8FC7\u4F4E</span>
    <span class="token constant">APPID_ERROR</span> <span class="token operator">=</span> <span class="token number">2006</span><span class="token punctuation">,</span>  <span class="token comment">// APPID\u65E0\u6548\u3001\u5FAE\u4FE1\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25</span>
    <span class="token constant">HOT_UNPDATE</span> <span class="token operator">=</span> <span class="token number">2007</span><span class="token punctuation">,</span>  <span class="token comment">// \u9700\u8981\u8FDB\u884C\u70ED\u66F4\u65B0\u68C0\u67E5</span>
    <span class="token constant">USER_UNPDATE</span><span class="token operator">=</span> <span class="token number">2008</span><span class="token punctuation">,</span>  <span class="token comment">// \u7528\u6237\u4FE1\u606F\u5DF2\u53D8\u66F4		</span>
    <span class="token constant">FORCE_OFFLINE</span><span class="token operator">=</span><span class="token number">2009</span><span class="token punctuation">,</span>  <span class="token comment">// \u5F3A\u5236\u4E0B\u7EBF</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u5C5E\u6027token\u7684\u65B9\u6CD5</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">refreshToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> LoginID<span class="token operator">:</span> <span class="token string">&#39;caogj&#39;</span><span class="token punctuation">,</span> Password<span class="token operator">:</span> <span class="token string">&#39;1111111&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u91CD\u65B0\u8BF7\u6C42</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> RetCode<span class="token punctuation">,</span> ReturnData <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>RetCode <span class="token operator">===</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;app/setToken&#39;</span><span class="token punctuation">,</span> ReturnData<span class="token punctuation">.</span>LoginToken<span class="token punctuation">)</span>
            <span class="token keyword">const</span> config <span class="token operator">=</span> response<span class="token punctuation">.</span>config
            <span class="token comment">// \u7531\u4E8ErequestSuccess\u62E6\u622A\u5668\u91CC\u9762\u5BF9URL\u8FDB\u884C\u4E86\u6539\u9020\uFF0C\u6240\u4EE5\u8FD9\u91CC\u628A\u6700\u539F\u59CB\u7684URL\u8F6C\u5316\u51FA\u6765</span>
            config<span class="token punctuation">.</span>url <span class="token operator">=</span> config<span class="token punctuation">.</span>oldURL<span class="token punctuation">;</span>
            config<span class="token punctuation">.</span>params <span class="token operator">=</span> config<span class="token punctuation">.</span>oldParams<span class="token punctuation">;</span>
            <span class="token comment">// \u6700\u5148\u7684\u63A5\u53E3\u8FD4\u56DE2002\uFF0C\u4E5F\u662F\u6700\u5148\u8FD4\u56DE\u6B63\u5F0F\u7684\u7ED3\u679C\uFF0C\u5269\u4F59\u7684\u63A5\u53E3\u518D\u6309\u987A\u5E8F\u8FD4\u56DE</span>
            <span class="token keyword">return</span> <span class="token function">http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u5237\u65B0token\u5931\u8D25\uFF0C\u795E\u4ED9\u4E5F\u6551\u4E0D\u4E86\u4E86\uFF0C\u8DF3\u8F6C\u5230\u9996\u9875\u91CD\u65B0\u767B\u5F55\u5427</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;refreshtoken error =&gt;&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token comment">//\u5237\u65B0token\u5931\u8D25\uFF0C\u795E\u4ED9\u4E5F\u6551\u4E0D\u4E86\u4E86\uFF0C\u8DF3\u8F6C\u5230\u9996\u9875\u91CD\u65B0\u767B\u5F55\u5427 </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * \u54CD\u5E94\u6210\u529F\u62E6\u622A\u5668
 * \u53EA\u6709\u8FD4\u56DE\u7684\u72B6\u6001\u7801\u662F2xx\uFF0C\u90FD\u4F1A\u8FDB\u6765\u8FD9\u91CC
 * 1. \u8FD4\u56DEdata\u91CC\u9762\u7684\u6570\u636E\uFF0C\u53EA\u4FDD\u7559\u516C\u53F8\u63A5\u53E3\u89C4\u8303\u7684\u6570\u636E
 * 2. Axios \u63A5\u53E3\u8D85\u65F6\u7EDF\u4E00\u5904\u7406\uFF0C\u8BF7\u6C42\u8D85\u65F6\u7684\u8BDD\uFF0C\u53EF\u4EE5\u91CD\u65B0\u53D1\u8D77\u4E00\u6B21\u8BF7\u6C42
 * 3. \u8BEF\u89E6\u6309\u94AE\u5BFC\u81F4\u91CD\u590D\u8BF7\u6C42\u53EF\u4EE5\u88AB\u53D6\u6D88
 * <span class="token keyword">@param</span> <span class="token parameter">response</span> 
 * <span class="token keyword">@returns</span> 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>config <span class="token operator">&amp;&amp;</span> <span class="token function">removePendingMap</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>config <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>config<span class="token punctuation">.</span>isLoading <span class="token operator">!==</span> <span class="token boolean">false</span>  <span class="token operator">&amp;&amp;</span> <span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// \u5173\u95EDloading</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> RetCode<span class="token punctuation">,</span> Message<span class="token punctuation">,</span> ReturnData <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u6210\u529F</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u5931\u8D25</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u7CFB\u7EDF\u5F02\u5E38</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// \u8FD9\u91CC\u7406\u89E3\u4E3A2002</span>
            <span class="token comment">// \u767B\u5F55\u5931\u8D25</span>
           <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u66F4\u591A\u72B6\u6001\uFF0C\u8BF7\u53C2\u7167\u679A\u4E3EResultEnum\u7C7B\u578B\uFF0C\u8FDB\u884C\u4E1A\u52A1\u5904\u7406</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u8981\u6CE8\u610F\u51E0\u4EF6\u4E8B\uFF1A</p><ul><li>\u771F\u5B9E\u9879\u76EE\u4E2D\u8BF7\u6C42\u767B\u5F55\u7684\u8D26\u53F7\u5BC6\u7801<code>{ LoginID: &#39;caogj&#39;, Password: &#39;1111111&#39; }</code>\u4F1A\u7531store\u5168\u5C40\u8C03\u7528\u3002</li><li>\u7531\u4E8ErequestSuccess\u62E6\u622A\u5668\u91CC\u9762\u5BF9URL\u8FDB\u884C\u4E86\u6539\u9020\uFF0C\u6240\u4EE5\u8FD9\u91CC\u628A\u6700\u539F\u59CB\u7684URL\u8F6C\u5316\u51FA\u6765\uFF0C\u6211\u4EEC\u518D\u53D1\u8D77\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u8981\u628AURL\u548Cparams\u91CD\u65B0\u8F6C\u5316\u4E00\u4E0B\u3002</li></ul><p>\u4EE5\u4E0A\u5C31\u57FA\u672C\u505A\u5230\u4E86\u65E0\u75DB\u5237\u65B0token\uFF0C\u5F53token\u6B63\u5E38\u65F6\uFF0C\u6B63\u5E38\u8FD4\u56DE\uFF0C\u5F53token\u5DF2\u8FC7\u671F\uFF0C\u5219axios\u5185\u90E8\u8FDB\u884C\u4E00\u6B21\u5237\u65B0token\u548C\u91CD\u8BD5\u3002\u5BF9\u8C03\u7528\u8005\u6765\u8BF4\uFF0Caxios\u5185\u90E8\u7684\u5237\u65B0token\u662F\u4E00\u4E2A\u9ED1\u76D2\uFF0C\u662F\u65E0\u611F\u77E5\u7684\uFF0C\u56E0\u6B64\u9700\u6C42\u5DF2\u7ECF\u505A\u5230\u4E86\u3002</p><h3 id="\u53D1\u73B0\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u53D1\u73B0\u95EE\u9898" aria-hidden="true">#</a> \u53D1\u73B0\u95EE\u9898</h3><p>\u4E0A\u9762\u7684\u4EE3\u7801\u8FD8\u662F\u5B58\u5728\u4E00\u4E9B\u95EE\u9898\u7684\uFF0C\u6CA1\u6709\u8003\u8651\u5230\u591A\u6B21\u8BF7\u6C42\u7684\u95EE\u9898\uFF0C\u56E0\u6B64\u9700\u8981\u8FDB\u4E00\u6B65\u4F18\u5316\u3002</p><h4 id="\u5982\u4F55\u9632\u6B62\u591A\u6B21\u5237\u65B0token" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u9632\u6B62\u591A\u6B21\u5237\u65B0token" aria-hidden="true">#</a> \u5982\u4F55\u9632\u6B62\u591A\u6B21\u5237\u65B0token</h4><p>\u5982\u679CrefreshToken\u63A5\u53E3\u8FD8\u6CA1\u8FD4\u56DE\uFF0C\u6B64\u65F6\u518D\u6709\u4E00\u4E2A\u8FC7\u671F\u7684\u8BF7\u6C42\u8FDB\u6765\uFF0C\u4E0A\u9762\u7684\u4EE3\u7801\u5C31\u4F1A\u518D\u4E00\u6B21\u6267\u884CrefreshToken\uFF0C\u8FD9\u5C31\u4F1A\u5BFC\u81F4\u591A\u6B21\u6267\u884C\u5237\u65B0token\u7684\u63A5\u53E3\uFF0C\u56E0\u6B64\u9700\u8981\u9632\u6B62\u8FD9\u4E2A\u95EE\u9898\u3002\u6211\u4EEC\u53EF\u4EE5\u5728request.js\u4E2D\u7528\u4E00\u4E2A\u53D8\u91CFisRefreshing\u6765\u6807\u8BB0\u5F53\u524D\u662F\u5426\u6B63\u5728\u5237\u65B0token\u7684\u72B6\u6001\uFF0C\u5982\u679C\u6B63\u5728\u5237\u65B0\u5219\u4E0D\u518D\u8C03\u7528\u5237\u65B0token\u7684\u63A5\u53E3\u3002</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u662F\u5426\u6B63\u5728\u5237\u65B0\u7684\u6807\u8BB0</span>
<span class="token keyword">let</span> isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u6210\u529F</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u5931\u8D25</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u7CFB\u7EDF\u5F02\u5E38</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// \u8FD9\u91CC\u7406\u89E3\u4E3A2002</span>
            <span class="token comment">// \u767B\u5F55\u5931\u8D25</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>

        <span class="token comment">// \u66F4\u591A\u72B6\u6001\uFF0C\u8BF7\u53C2\u7167\u679A\u4E3EResultEnum\u7C7B\u578B\uFF0C\u8FDB\u884C\u4E1A\u52A1\u5904\u7406</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u6837\u5B50\u5C31\u53EF\u4EE5\u907F\u514D\u5728\u5237\u65B0token\u65F6\u518D\u8FDB\u5165\u65B9\u6CD5\u4E86\u3002\u4F46\u662F\u8FD9\u79CD\u505A\u6CD5\u662F\u76F8\u5F53\u4E8E\u628A\u5176\u4ED6\u5931\u8D25\u7684\u63A5\u53E3\u7ED9\u820D\u5F03\u4E86\uFF0C\u5047\u5982\u540C\u65F6\u53D1\u8D77\u4E24\u4E2A\u8BF7\u6C42\uFF0C\u4E14\u51E0\u4E4E\u540C\u65F6\u8FD4\u56DE\uFF0C\u7B2C\u4E00\u4E2A\u8BF7\u6C42\u80AF\u5B9A\u662F\u8FDB\u5165\u4E86refreshToken\u540E\u518D\u91CD\u8BD5\uFF0C\u800C\u7B2C\u4E8C\u4E2A\u8BF7\u6C42\u5219\u88AB\u4E22\u5F03\u4E86\uFF0C\u4ECD\u662F\u8FD4\u56DE\u5931\u8D25\uFF0C\u6240\u4EE5\u63A5\u4E0B\u6765\u8FD8\u5F97\u89E3\u51B3\u5176\u4ED6\u63A5\u53E3\u7684\u91CD\u8BD5\u95EE\u9898\u3002</p><h3 id="\u540C\u65F6\u53D1\u8D77\u4E24\u4E2A\u6216\u4EE5\u4E0A\u7684\u8BF7\u6C42\u65F6-\u5176\u4ED6\u63A5\u53E3\u5982\u4F55\u91CD\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u540C\u65F6\u53D1\u8D77\u4E24\u4E2A\u6216\u4EE5\u4E0A\u7684\u8BF7\u6C42\u65F6-\u5176\u4ED6\u63A5\u53E3\u5982\u4F55\u91CD\u8BD5" aria-hidden="true">#</a> \u540C\u65F6\u53D1\u8D77\u4E24\u4E2A\u6216\u4EE5\u4E0A\u7684\u8BF7\u6C42\u65F6\uFF0C\u5176\u4ED6\u63A5\u53E3\u5982\u4F55\u91CD\u8BD5</h3><p>\u4E24\u4E2A\u63A5\u53E3\u51E0\u4E4E\u540C\u65F6\u53D1\u8D77\u548C\u8FD4\u56DE\uFF0C\u7B2C\u4E00\u4E2A\u63A5\u53E3\u4F1A\u8FDB\u5165\u5237\u65B0token\u540E\u91CD\u8BD5\u7684\u6D41\u7A0B\uFF0C\u800C\u7B2C\u4E8C\u4E2A\u63A5\u53E3\u9700\u8981\u5148\u5B58\u8D77\u6765\uFF0C\u7136\u540E\u7B49\u5237\u65B0token\u540E\u518D\u91CD\u8BD5\u3002\u540C\u6837\uFF0C\u5982\u679C\u540C\u65F6\u53D1\u8D77\u4E09\u4E2A\u8BF7\u6C42\uFF0C\u6B64\u65F6\u9700\u8981\u7F13\u5B58\u540E\u4E24\u4E2A\u63A5\u53E3\uFF0C\u7B49\u5237\u65B0token\u540E\u518D\u91CD\u8BD5\u3002\u7531\u4E8E\u63A5\u53E3\u90FD\u662F\u5F02\u6B65\u7684\uFF0C\u5904\u7406\u8D77\u6765\u4F1A\u6709\u70B9\u9EBB\u70E6\u3002</p><p>\u5F53\u7B2C\u4E8C\u4E2A\u8FC7\u671F\u7684\u8BF7\u6C42\u8FDB\u6765\uFF0Ctoken\u6B63\u5728\u5237\u65B0\uFF0C\u6211\u4EEC\u5148\u5C06\u8FD9\u4E2A\u8BF7\u6C42\u5B58\u5230\u4E00\u4E2A\u6570\u7EC4\u961F\u5217\u4E2D\uFF0C\u60F3\u529E\u6CD5\u8BA9\u8FD9\u4E2A\u8BF7\u6C42\u5904\u4E8E\u7B49\u5F85\u4E2D\uFF0C\u4E00\u76F4\u7B49\u5230\u5237\u65B0token\u540E\u518D\u9010\u4E2A\u91CD\u8BD5\u6E05\u7A7A\u8BF7\u6C42\u961F\u5217\u3002 \u90A3\u4E48\u5982\u4F55\u505A\u5230\u8BA9\u8FD9\u4E2A\u8BF7\u6C42\u5904\u4E8E\u7B49\u5F85\u4E2D\u5462\uFF1F\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u5F97\u501F\u52A9Promise\u3002\u5C06\u8BF7\u6C42\u5B58\u8FDB\u961F\u5217\u4E2D\u540E\uFF0C\u540C\u65F6\u8FD4\u56DE\u4E00\u4E2APromise\uFF0C\u8BA9\u8FD9\u4E2APromise\u4E00\u76F4\u5904\u4E8EPending\u72B6\u6001\uFF08\u5373\u4E0D\u8C03\u7528resolve\uFF09\uFF0C\u6B64\u65F6\u8FD9\u4E2A\u8BF7\u6C42\u5C31\u4F1A\u4E00\u76F4\u7B49\u554A\u7B49\uFF0C\u53EA\u8981\u6211\u4EEC\u4E0D\u6267\u884Cresolve\uFF0C\u8FD9\u4E2A\u8BF7\u6C42\u5C31\u4F1A\u4E00\u76F4\u5728\u7B49\u5F85\u3002\u5F53\u5237\u65B0\u8BF7\u6C42\u7684\u63A5\u53E3\u8FD4\u56DE\u6765\u540E\uFF0C\u6211\u4EEC\u518D\u8C03\u7528resolve\uFF0C\u9010\u4E2A\u91CD\u8BD5\u3002\u6700\u7EC8\u4EE3\u7801\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u662F\u5426\u6B63\u5728\u5237\u65B0\u7684\u6807\u8BB0</span>
<span class="token keyword">let</span> isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">// \u91CD\u8BD5\u961F\u5217\uFF0C\u6BCF\u4E00\u9879\u5C06\u662F\u4E00\u4E2A\u5F85\u6267\u884C\u7684\u51FD\u6570\u5F62\u5F0F</span>
<span class="token keyword">let</span> requestQueues<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">refreshToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> LoginID<span class="token operator">:</span> <span class="token string">&#39;caogj&#39;</span><span class="token punctuation">,</span> Password<span class="token operator">:</span> <span class="token string">&#39;1111111&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u91CD\u65B0\u8BF7\u6C42</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> RetCode<span class="token punctuation">,</span> ReturnData <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>RetCode <span class="token operator">===</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span> <span class="token comment">// something</span>
            <span class="token comment">// \u6700\u5148\u7684\u63A5\u53E3\u8FD4\u56DE2002\uFF0C\u4E5F\u662F\u6700\u5148\u8FD4\u56DE\u6B63\u5F0F\u7684\u7ED3\u679C\uFF0C\u5269\u4F59\u7684\u63A5\u53E3\u518D\u6309\u987A\u5E8F\u8FD4\u56DE</span>
            <span class="token comment">// \u5DF2\u7ECF\u5237\u65B0\u4E86token\uFF0C\u5C06\u6240\u6709\u961F\u5217\u4E2D\u7684\u8BF7\u6C42\u8FDB\u884C\u91CD\u8BD5</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>requestQueues <span class="token operator">&amp;&amp;</span> requestQueues<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                requestQueues<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>callback <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                requestQueues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u5237\u65B0token\u5931\u8D25\uFF0C\u795E\u4ED9\u4E5F\u6551\u4E0D\u4E86\u4E86\uFF0C\u8DF3\u8F6C\u5230\u9996\u9875\u91CD\u65B0\u767B\u5F55\u5427</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;refreshtoken error =&gt;&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token comment">//\u5237\u65B0token\u5931\u8D25\uFF0C\u795E\u4ED9\u4E5F\u6551\u4E0D\u4E86\u4E86\uFF0C\u8DF3\u8F6C\u5230\u9996\u9875\u91CD\u65B0\u767B\u5F55\u5427 </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u6210\u529F</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u5931\u8D25</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u7CFB\u7EDF\u5F02\u5E38</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// \u8FD9\u91CC\u7406\u89E3\u4E3A2002</span>
            <span class="token comment">// \u767B\u5F55\u5931\u8D25</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// \u5F53\u9047\u5230\u6B63\u5728\u9ED8\u9ED8\u767B\u5F55\u7684\u63A5\u53E3\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u672A\u6267\u884Cresolve\u7684promise</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u5C06resolve\u653E\u8FDB\u961F\u5217\uFF0C\u7528\u4E00\u4E2A\u51FD\u6570\u5F62\u5F0F\u6765\u4FDD\u5B58\uFF0C\u7B49token\u5237\u65B0\u540E\u76F4\u63A5\u6267\u884C</span>
                    requestQueues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">http</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>

        <span class="token comment">// \u66F4\u591A\u72B6\u6001\uFF0C\u8BF7\u53C2\u7167\u679A\u4E3EResultEnum\u7C7B\u578B\uFF0C\u8FDB\u884C\u4E1A\u52A1\u5904\u7406</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u53EF\u80FD\u6BD4\u8F83\u96BE\u7406\u89E3\u7684\u662Frequests\u8FD9\u4E2A\u961F\u5217\u4E2D\u4FDD\u5B58\u7684\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u8FD9\u662F\u4E3A\u4E86\u8BA9resolve\u4E0D\u6267\u884C\uFF0C\u5148\u5B58\u8D77\u6765\uFF0C\u7B49\u5237\u65B0token\u540E\u66F4\u65B9\u4FBF\u8C03\u7528\u8FD9\u4E2A\u51FD\u6570\u4F7F\u5F97resolve\u6267\u884C\u3002\u8FD9\u4E2A\u8BBE\u8BA1\u601D\u60F3\u8DDFaxios\u4E2D\u7684\u53D6\u6D88\u8BF7\u6C42\u7684\u4EE4\u724CcancelToken\u662F\u4E00\u6837\u7684\uFF0C\u5927\u5BB6\u53EF\u4EE5\u770B\u56DE\u524D\u9762\u7684\u6E90\u7801\u5206\u6790\u3002</p><h3 id="\u4E0D\u540C\u65F6\u95F4\u5DEE\u53D1\u8D77\u4E24\u4E2A\u6216\u4EE5\u4E0A\u7684\u8BF7\u6C42\u65F6-\u5176\u4ED6\u63A5\u53E3\u5982\u4F55\u91CD\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u4E0D\u540C\u65F6\u95F4\u5DEE\u53D1\u8D77\u4E24\u4E2A\u6216\u4EE5\u4E0A\u7684\u8BF7\u6C42\u65F6-\u5176\u4ED6\u63A5\u53E3\u5982\u4F55\u91CD\u8BD5" aria-hidden="true">#</a> \u4E0D\u540C\u65F6\u95F4\u5DEE\u53D1\u8D77\u4E24\u4E2A\u6216\u4EE5\u4E0A\u7684\u8BF7\u6C42\u65F6\uFF0C\u5176\u4ED6\u63A5\u53E3\u5982\u4F55\u91CD\u8BD5</h3><p>\u8FD9\u91CC\u7684\u610F\u601D\u662F\u5F53\u9875\u9762\u6709\u4E24\u4E2A\u63A5\u53E3a\u548Cb\u63A5\u53E3\uFF0Ca\u63A5\u53E3\u53D1\u8D77\u4E86token\u5237\u65B0\u91CD\u8BD5\u64CD\u4F5C\uFF0C\u5F53token\u63A5\u53E3\u6CA1\u6709\u53CA\u65F6\u8FD4\u56DEtoken\u7684\u65F6\u5019\uFF0Cb\u63A5\u53E3\u9A6C\u4E0A\u5C31\u53D1\u8D77\u4E86\uFF0C\u8FD9\u4E2A\u65F6\u5019token\u8FD8\u6CA1\u6709\u56DE\u6765\uFF0C\u8FD9\u6837\u4F1A\u5BFC\u81F4\u4E86a\u548Cb\u63A5\u53E3\u90FD\u6267\u884C\u4E86\u4E00\u6B21\u5237\u65B0token\u7684\u64CD\u4F5C\uFF0C\u8FD9\u6837\u4F1A\u5F15\u53D1\u4E00\u7CFB\u5217\u7684\u95EE\u9898\uFF0C\u4F8B\u5982\u7B2C\u4E00\u6B21\u6362\u53D6\u7684token\u4F1A\u88AB\u7B2C\u4E8C\u6B21token\u8986\u76D6\uFF0C\u6216\u8005\u7B2C\u4E00\u6B21\u662F\u901A\u8FC7\u6388\u6743\u7801\u6362\u53D6\u7684token\uFF0C\u7B2C\u4E8C\u6B21\u6388\u6743\u7801\u5931\u6548\u4E86\u5BFC\u81F4\u4E86b\u63A5\u53E3\u7684\u5931\u8D25\u3002</p><p>\u9488\u5BF9\u4EE5\u4E0A\u7684\u60C5\u51B5\uFF0C\u6211\u4EEC\u8C03\u6574\u4EE5\u4E0B\u6B65\u9AA4</p>`,28),nn=l(`<p>\u6700\u7EC8\u4EE3\u7801\uFF1A</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u91CD\u7F6E\u8BF7\u6C42\u53C2\u6570</span>
<span class="token keyword">const</span> <span class="token function-variable function">resetRequestParams</span> <span class="token operator">=</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>url <span class="token operator">=</span> config<span class="token punctuation">.</span>oldURL
    config<span class="token punctuation">.</span>params <span class="token operator">=</span> config<span class="token punctuation">.</span>oldParams
    <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u6210\u529F</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u8BF7\u6C42\u5931\u8D25</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// \u7CFB\u7EDF\u5F02\u5E38</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// \u8FD9\u91CC\u7406\u89E3\u4E3A2002</span>
            <span class="token comment">// \u767B\u5F55\u5931\u8D25</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>UserModule<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                  <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  <span class="token comment">// \u5F53\u9047\u5230\u6B63\u5728\u9ED8\u9ED8\u767B\u5F55\u7684\u63A5\u53E3\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u672A\u6267\u884Cresolve\u7684promise</span>
                  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                      <span class="token comment">// \u5C06resolve\u653E\u8FDB\u961F\u5217\uFF0C\u7528\u4E00\u4E2A\u51FD\u6570\u5F62\u5F0F\u6765\u4FDD\u5B58\uFF0C\u7B49token\u5237\u65B0\u540E\u76F4\u63A5\u6267\u884C</span>
                      requestQueues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">http</span><span class="token punctuation">(</span><span class="token function">resetRequestParams</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                      <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span> 
         <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
         	<span class="token comment">// \u5F53\u7531\u4E8E\u63A5\u53E3\u5FEB\u6162\u95EE\u9898\uFF0C\u4F1A\u5BFC\u81F4\u6388\u6743\u63A5\u53E3\u8FD8\u6CA1\u6709\u8FD4\u56DEtoken\u7684\u65F6\u5019\uFF0C\u7136\u540E\u53C8\u53D1\u8D77\u4E86\u65B0\u4E00\u4E2A\u8BF7\u6C42\uFF0C</span>
          <span class="token comment">// \u65B0\u8BF7\u6C42\u56E0\u4E3A\u6CA1\u6709token\uFF0C\u53C8\u4F1A\u76F4\u63A5\u62A52002\uFF0C\u5BFC\u81F4\u53C8\u9700\u8981\u53BB\u8BF7\u6C42\u4E00\u6B21\u6388\u6743\uFF0C\u6709\u65F6\u5019\u4F1A\u8986\u76D6token\u6216\u8005\u5F15\u53D1\u5176\u4ED6\u95EE\u9898\u3002</span>
                <span class="token keyword">return</span> <span class="token function">http</span><span class="token punctuation">(</span><span class="token function">resetRequestParams</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u66F4\u591A\u72B6\u6001\uFF0C\u8BF7\u53C2\u7167\u679A\u4E3EResultEnum\u7C7B\u578B\uFF0C\u8FDB\u884C\u4E1A\u52A1\u5904\u7406</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u8F6C\u6362\u8BF7\u6C42\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#\u8F6C\u6362\u8BF7\u6C42\u53C2\u6570" aria-hidden="true">#</a> \u8F6C\u6362\u8BF7\u6C42\u53C2\u6570</h2><p>\u8F6C\u6362\u53C2\u6570\u7684\u903B\u8F91\uFF0C\u662F\u653E\u5728\u8BF7\u6C42\u4E4B\u524D\u7684\u62E6\u622A\u5668\u91CC\u9762\uFF1ArequestSuccess</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// \u8BF7\u6C42\u62E6\u622A\u5668</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">requestSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5224\u65AD\u5F53\u524D\u8BF7\u6C42\u662F\u5426\u8BBE\u7F6E\u4E86\u4E0D\u663E\u793ALoading</span>
    request<span class="token punctuation">.</span>isLoading <span class="token operator">!==</span> <span class="token boolean">false</span>  <span class="token operator">&amp;&amp;</span> <span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> _params <span class="token operator">=</span> <span class="token punctuation">{</span>
        token<span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>token<span class="token punctuation">,</span>
        AppID<span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppID<span class="token punctuation">,</span>
        sourceType<span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>platform
    <span class="token punctuation">}</span>
    <span class="token comment">// \u9ED8\u9ED8\u767B\u5F55\u65F6\u5019\uFF0C\u9700\u8981\u8FD9\u4E24\u4E2A\u53C2\u6570</span>
    request<span class="token punctuation">.</span>oldParams <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
    request<span class="token punctuation">.</span>oldURL <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;GET&#39;</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// fits get\u63A5\u53E3\u7684\u6570\u636E\uFF0C\u5C5E\u6027\u8981\u7528Data[id]=1111&amp;Data[text]\u8FD9\u4E2A\u683C\u5F0F\u624D\u80FD\u8BF7\u6C42\u6210\u529F</span>
        <span class="token keyword">let</span> url<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
        url <span class="token operator">+=</span> <span class="token string">&#39;?&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            url <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Data[&#39;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&#39;]&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">\`</span></span>
        <span class="token punctuation">}</span>
        request<span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u516C\u53F8\u7684\u63A5\u53E3post\u7684\u6570\u636E\u8981\u5305\u88F9\u5728 Data\u5BF9\u8C61\u91CC\u9762\u3002</span>

       <span class="token comment">// \u4E3A\u4E86\u89E3\u51B3\u91CD\u8BD5\u51E0\u6B21\u63A5\u53E3\u4E4B\u540E\uFF0CData\u5BF9\u8C61\u4E0D\u65AD\u88AB\u91CD\u590D\u5305\u88F9\uFF0C\u6240\u4EE5\u8981\u52A0\u4E00\u5C42\u5224\u65AD\uFF0C\u5982\u679C\u4E00\u65E6\u5B58\u5728\u4E4B\u540E\uFF0C\u4E0D\u5728\u518D\u5305\u88F9\u4E00\u5C42</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> _data <span class="token operator">=</span> <span class="token punctuation">{</span> Data<span class="token operator">:</span> request<span class="token punctuation">.</span>data <span class="token punctuation">}</span>
            request<span class="token punctuation">.</span>data <span class="token operator">=</span> _data
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// console.log(request)</span>
    <span class="token comment">// \u5C06token\u3001APPid\u7B49\u4FE1\u606F\u5408\u5E76\u5230\u539F\u6765params\u4E0A\u9762</span>
    request<span class="token punctuation">.</span>params <span class="token operator">=</span> _params
    <span class="token function">addPending</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5173\u952E\u4EE3\u7801:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  url <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Data[&#39;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&#39;]&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">\`</span></span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E3A\u4EC0\u4E48\u8981\u7EC4\u88C5get\u7684\u53C2\u6570\uFF0C\u662F\u56E0\u4E3A\u516C\u53F8\u8981\u6C42get\u7684\u53C2\u6570\u8981\u88ABData[]\u5305\u4F4F\u3002\u8FD9\u6837\u62FC\u63A5\u6210URL\u8F6C\u6362\uFF0C\u653E\u5230URL\u7684\u5C5E\u6027\u4E0A\u9762\uFF0C\u5728\u6D4F\u89C8\u5668\u4E0A\u7684network\u4E0A\u80FD\u770B\u5230\u6CA1\u6709\u8F6C\u4E49\u7684\u4E2D\u62EC\u53F7\u7684\u53C2\u6570\u3002\u5982\u679C\u76F4\u63A5\u653E\u5230Parman\u91CC\u9762\uFF0C\u5219\u4F1A\u5728\u8C37\u6B4C\u4E0A\u770B\u5230\u8F6C\u4E49\u540E\u7684\u4E71\u7801\u53C2\u6570 <img src="`+b+'" alt="\u56FE 3"></p><h2 id="\u53C2\u8003\u8D44\u6599" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u8D44\u6599" aria-hidden="true">#</a> \u53C2\u8003\u8D44\u6599</h2>',9),sn={href:"https://zhuanlan.zhihu.com/p/133739952",target:"_blank",rel:"noopener noreferrer"},an=s("Angular\u4E0ERxjs\u5B66\u4E60"),tn={href:"https://segmentfault.com/a/1190000020210980",target:"_blank",rel:"noopener noreferrer"},en=s("axios\u5982\u4F55\u5229\u7528promise\u65E0\u75DB\u5237\u65B0token"),pn={href:"https://segmentfault.com/a/1190000023073514",target:"_blank",rel:"noopener noreferrer"},on=s("axios\u62E6\u622A\u91CD\u590D\u8BF7\u6C42"),cn={href:"https://segmentfault.com/a/1190000027078266",target:"_blank",rel:"noopener noreferrer"},ln=s("\u4E00\u5957\u5168\u9762\u53C8\u6709\u5B9E\u9645\u610F\u4E49\u7684axios\u5C01\u88C5+api\u7BA1\u7406\u65B9\u6848");function un(rn,kn){const e=u("ExternalLinkIcon"),i=u("Tabs"),r=u("Mermaid");return d(),m("div",null,[f,y,n("p",null,[h,w,x,n("a",R,[E,a(e)]),A]),n("p",null,[_,n("a",C,[T,a(e)])]),q,a(i,{data:[{title:"\u6DFB\u52A0Pending"},{title:"\u53D6\u6D88\u91CD\u590D\u63A5\u53E3"},{title:"\u53D6\u6D88\u6240\u6709\u63A5\u53E3"}],active:0},{tab0:t(({title:p,value:o,isActive:c})=>[P]),tab1:t(({title:p,value:o,isActive:c})=>[S,D,L,O,U,I]),tab2:t(({title:p,value:o,isActive:c})=>[M,B,j]),_:1}),F,a(i,{data:[{title:"\u663E\u793Aloading"},{title:"\u9690\u85CFloading"}],active:0},{tab0:t(({title:p,value:o,isActive:c})=>[N]),tab1:t(({title:p,value:o,isActive:c})=>[H]),_:1}),G,$,n("p",null,[Q,n("a",Y,[z,a(e)])]),V,a(i,{data:[{title:"\u5224\u65AD\u7F51\u7EDC\u72B6\u6001"},{title:"\u5224\u65AD\u72B6\u6001\u7801"},{title:"\u5224\u65AD\u8BF7\u6C42\u7C7B\u578B"}],active:0},{tab0:t(({title:p,value:o,isActive:c})=>[J,W]),tab1:t(({title:p,value:o,isActive:c})=>[X]),tab2:t(({title:p,value:o,isActive:c})=>[K]),_:1}),Z,a(r,{id:"mermaid-64a551ea",code:"graph%20TD%3B%0A%20%20%20%20A%5Btoken%E9%87%8D%E8%AF%95%E6%93%8D%E4%BD%9C%5D%20--%3E%20B%7B%E5%88%A4%E6%96%ADvuex%E6%98%AF%E5%90%A6%E5%AD%98%E6%9C%89token%7D%0A%20%20%20%20B%20--%20%E5%AD%98%E5%9C%A8%20--%3E%20C%5B%E9%87%8D%E6%96%B0%E5%8F%91%E8%B5%B7%E8%B0%83%E7%94%A8%E8%87%AA%E8%BA%AB%E7%9A%84%E8%AF%B7%E6%B1%82%5D%0A%20%20%20%20C%20--%3E%20D%7B%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%87%8D%E5%88%B7token%E7%9A%84%E6%93%8D%E4%BD%9C%7D%0A%20%20%20%20D%20--%20%E6%98%AF%20--%3E%20F%5B%E9%87%8D%E6%96%B0%E5%88%B7%E6%96%B0%E6%8E%A5%E5%8F%A3%5D%0A%20%20%20%20D%20--%20%E5%90%A6%20--%3E%20G%5B%E4%BF%9D%E5%AD%98%E5%BD%93%E5%89%8D%E6%8E%A5%E5%8F%A3%E7%AD%89%E5%BE%85%E8%A2%AB%E8%B0%83%E7%94%A8%5D%0A"}),nn,n("ol",null,[n("li",null,[n("a",sn,[an,a(e)])]),n("li",null,[n("a",tn,[en,a(e)])]),n("li",null,[n("a",pn,[on,a(e)])]),n("li",null,[n("a",cn,[ln,a(e)])])])])}var mn=k(g,[["render",un],["__file","http.html.vue"]]);export{mn as default};
