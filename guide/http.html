<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://192.168.32.60:8080/fitsadmin-docs/guide/http.html"><meta property="og:site_name" content="FitsAdmin"><meta property="og:title" content="HTTP服务"><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-07-05T03:00:45.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="caoguanjie"><meta property="article:published_time" content="2021-07-14T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-05T03:00:45.000Z"><link rel="icon" href=" /fitsadmin-docs/images/favicon.ico"><title>HTTP服务 | FitsAdmin</title><meta name="description" content="基于vue3-element-admin为模板的前端框架">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/fitsadmin-docs/assets/style.683853ee.css">
    <link rel="modulepreload" href="/fitsadmin-docs/assets/app.5dd2b556.js"><link rel="modulepreload" href="/fitsadmin-docs/assets/clientConfigs.7ea3e47f.js"><link rel="modulepreload" href="/fitsadmin-docs/assets/http.html.faa7412a.js"><link rel="modulepreload" href="/fitsadmin-docs/assets/http.html.00c82c85.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/fitsadmin-docs/" class="brand"><img class="logo" src="/fitsadmin-docs/images/logo.png" alt="FitsAdmin"><!----><span class="site-name hide-in-pad">FitsAdmin</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/fitsadmin-docs/guide/quickstart.html" class="nav-link active" aria-label="指南"><!---->指南<!----></a></div><div class="nav-item hide-in-mobile"><a href="/fitsadmin-docs/components/about.html" class="nav-link" aria-label="组件"><!---->组件<!----></a></div><div class="nav-item hide-in-mobile"><a href="/fitsadmin-docs/resources/" class="nav-link" aria-label="资源"><!---->资源<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="生态系统"><span class="title"><!---->生态系统</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架相关</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://192.168.32.60:3002/" rel="noopener noreferrer" target="_blank" aria-label="FitsAdminV2" class="nav-link"><!---->FitsAdminV2<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="http://192.168.32.108:3000/" rel="noopener noreferrer" target="_blank" aria-label="Yapi接口管理" class="nav-link"><!---->Yapi接口管理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="/fitsadmin-docs/resources/encrypt.html" class="nav-link" aria-label="项目的SVN地址"><!---->项目的SVN地址<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>官方库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://cn.vuejs.org/" rel="noopener noreferrer" target="_blank" aria-label="Vue3.x" class="nav-link"><!---->Vue3.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://pinia.vuejs.org/" rel="noopener noreferrer" target="_blank" aria-label="Pinia" class="nav-link"><!---->Pinia<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://cn.vitejs.dev/" rel="noopener noreferrer" target="_blank" aria-label="Vite" class="nav-link"><!---->Vite<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://vueuse.org/" rel="noopener noreferrer" target="_blank" aria-label="VueUse" class="nav-link"><!---->VueUse<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://router.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="Vue Router" class="nav-link"><!---->Vue Router<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://element-plus.org/zh-CN/#/zh-CN" rel="noopener noreferrer" target="_blank" aria-label="Element Plus" class="nav-link"><!---->Element Plus<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>优秀案例</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://vue-admin-beautiful.com/vue-admin-beautiful-element/?hmsr=github&amp;hmpl=&amp;hmcu=&amp;hmkw=&amp;hmci=#/index" rel="noopener noreferrer" target="_blank" aria-label="vue-admin-better" class="nav-link"><!---->vue-admin-better<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://vue-admin-beautiful.com/admin-plus/#/index" rel="noopener noreferrer" target="_blank" aria-label="Vue Admin plus" class="nav-link"><!---->Vue Admin plus<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://panjiachen.github.io/vue-element-admin/" rel="noopener noreferrer" target="_blank" aria-label="vue-element-admin" class="nav-link"><!---->vue-element-admin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="http://vue3.youlai.tech/" rel="noopener noreferrer" target="_blank" aria-label="vue3-element-admin" class="nav-link"><!---->vue3-element-admin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="http://192.168.32.108:8012/#/" rel="noopener noreferrer" target="_blank" aria-label="Fits知识库" class="nav-link"><!---->Fits知识库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="http://192.168.32.60:3001/" rel="noopener noreferrer" target="_blank" aria-label="Demo演示" class="nav-link"><!---->Demo演示<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/caoguanjie/fitsadmin-docs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">基础</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/fitsadmin-docs/guide/quickstart.html" class="nav-link sidebar-link sidebar-page" aria-label="介绍"><!---->介绍<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/layout.html" class="nav-link sidebar-link sidebar-page" aria-label="布局"><!---->布局<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/router-and-nav.html" class="nav-link sidebar-link sidebar-page" aria-label="路由和侧边栏"><!---->路由和侧边栏<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/permission.html" class="nav-link sidebar-link sidebar-page" aria-label="权限验证"><!---->权限验证<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/tags-view.html" class="nav-link sidebar-link sidebar-page" aria-label="快捷导航(标签栏导航)"><!---->快捷导航(标签栏导航)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/new-page.html" class="nav-link sidebar-link sidebar-page" aria-label="新增页面"><!---->新增页面<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/style.html" class="nav-link sidebar-link sidebar-page" aria-label="样式"><!---->样式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/server.html" class="nav-link sidebar-link sidebar-page" aria-label="与服务端交互"><!---->与服务端交互<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/mock-data.html" class="nav-link sidebar-link sidebar-page" aria-label="Mock Data"><!---->Mock Data<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/import.html" class="nav-link sidebar-link sidebar-page" aria-label="外部导入模块"><!---->外部导入模块<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/deploy.html" class="nav-link sidebar-link sidebar-page" aria-label="构建和发布"><!---->构建和发布<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/piniajs.html" class="nav-link sidebar-link sidebar-page" aria-label="Pinia状态管理"><!---->Pinia状态管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/style-guide.html" class="nav-link sidebar-link sidebar-page" aria-label="风格指南"><!---->风格指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active"><!----><span class="title">进阶</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/fitsadmin-docs/guide/monorepo.html" class="nav-link sidebar-link sidebar-page" aria-label="pnpm+changesets的monorepo实践"><!---->pnpm+changesets的monorepo实践<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/wujie.html" class="nav-link sidebar-link sidebar-page" aria-label="微前端wujie"><!---->微前端wujie<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/eslint.html" class="nav-link sidebar-link sidebar-page" aria-label="ESLint"><!---->ESLint<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/elementplus.html" class="nav-link sidebar-link sidebar-page" aria-label="整合Element-Plus"><!---->整合Element-Plus<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/srcAlias.html" class="nav-link sidebar-link sidebar-page" aria-label="路径别名配置"><!---->路径别名配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/auto-imports.html" class="nav-link sidebar-link sidebar-page" aria-label="按需自动导入"><!---->按需自动导入<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/envirmoment.html" class="nav-link sidebar-link sidebar-page" aria-label="多环境配置"><!---->多环境配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/cross-domin.html" class="nav-link sidebar-link sidebar-page" aria-label="浏览器跨域处理"><!---->浏览器跨域处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/fitsadmin-docs/guide/http.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="HTTP服务"><!---->HTTP服务<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#前言" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="前言"><!---->前言<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#项目需求" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="项目需求"><!---->项目需求<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#目录说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="目录说明"><!---->目录说明<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#安装-axios" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="安装 axios"><!---->安装 axios<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#基本框架" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="基本框架"><!---->基本框架<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#http服务的调用方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="http服务的调用方式"><!---->http服务的调用方式<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#http的接口类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="http的接口类型"><!---->http的接口类型<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#接口的扩展" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="接口的扩展"><!---->接口的扩展<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#ts中的枚举用法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ts中的枚举用法"><!---->ts中的枚举用法<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#axios拦截器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="axios拦截器"><!---->axios拦截器<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#如何取消重复请求" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="如何取消重复请求"><!---->如何取消重复请求<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#axios-的-canceltoken" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="axios 的 cancelToken"><!---->axios 的 cancelToken<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#两种方法的区别与应用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="两种方法的区别与应用"><!---->两种方法的区别与应用<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#canceltoken的源码分析" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="cancelToken的源码分析"><!---->cancelToken的源码分析<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#canceltoken的实际应用" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="CancelToken的实际应用"><!---->CancelToken的实际应用<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#loading的显示和隐藏" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="loading的显示和隐藏"><!---->loading的显示和隐藏<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#代码说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="代码说明"><!---->代码说明<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#如何重试请求" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="如何重试请求"><!---->如何重试请求<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#核心实现" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="核心实现"><!---->核心实现<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#刷新token" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="刷新token"><!---->刷新token<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#实现思路" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="实现思路"><!---->实现思路<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#代码实现" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="代码实现"><!---->代码实现<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#发现问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="发现问题"><!---->发现问题<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#同时发起两个或以上的请求时-其他接口如何重试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="同时发起两个或以上的请求时，其他接口如何重试"><!---->同时发起两个或以上的请求时，其他接口如何重试<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#不同时间差发起两个或以上的请求时-其他接口如何重试" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="不同时间差发起两个或以上的请求时，其他接口如何重试"><!---->不同时间差发起两个或以上的请求时，其他接口如何重试<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#转换请求参数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="转换请求参数"><!---->转换请求参数<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#参考资料" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="参考资料"><!---->参考资料<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/iconfont.html" class="nav-link sidebar-link sidebar-page" aria-label="Svg图标"><!---->Svg图标<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/wangEditor.html" class="nav-link sidebar-link sidebar-page" aria-label="wangEditor富文本编辑器"><!---->wangEditor富文本编辑器<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/echart.html" class="nav-link sidebar-link sidebar-page" aria-label="Echarts图表"><!---->Echarts图表<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/keepalive.html" class="nav-link sidebar-link sidebar-page" aria-label="Keepalive页面缓存机制"><!---->Keepalive页面缓存机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/jenkins.html" class="nav-link sidebar-link sidebar-page" aria-label="Jenkins自动部署"><!---->Jenkins自动部署<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">其他</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/fitsadmin-docs/guide/function-list.html" class="nav-link sidebar-link sidebar-page" aria-label="功能清单"><!---->功能清单<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/svn.html" class="nav-link sidebar-link sidebar-page" aria-label="svn设置忽略文件"><!---->svn设置忽略文件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/memory-leak.html" class="nav-link sidebar-link sidebar-page" aria-label="内存泄露（memory leak）"><!---->内存泄露（memory leak）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/micro-frontends.html" class="nav-link sidebar-link sidebar-page" aria-label="微前端架构技术选型"><!---->微前端架构技术选型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/CHANGELOG.html" class="nav-link sidebar-link sidebar-page" aria-label="更新日志"><!---->更新日志<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->HTTP服务</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2021年7月14日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">caoguanjie</span></span><span property="author" content="caoguanjie"></span></span><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2021年7月14日</span><meta property="datePublished" content="2021-07-14T00:00:00.000Z"></span><!----><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2021年7月14日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 31 分钟</span><meta property="timeRequired" content="PT31M"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down" localizeddate="2021年7月14日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 9312 字</span><meta property="wordCount" content="9312"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#前言" class="router-link-active router-link-exact-active toc-link level2">前言</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#项目需求" class="router-link-active router-link-exact-active toc-link level2">项目需求</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#目录说明" class="router-link-active router-link-exact-active toc-link level2">目录说明</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#安装-axios" class="router-link-active router-link-exact-active toc-link level2">安装 axios</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#基本框架" class="router-link-active router-link-exact-active toc-link level2">基本框架</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#http服务的调用方式" class="router-link-active router-link-exact-active toc-link level3">http服务的调用方式</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#http的接口类型" class="router-link-active router-link-exact-active toc-link level2">http的接口类型</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#接口的扩展" class="router-link-active router-link-exact-active toc-link level3">接口的扩展</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#ts中的枚举用法" class="router-link-active router-link-exact-active toc-link level3">ts中的枚举用法</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#axios拦截器" class="router-link-active router-link-exact-active toc-link level2">axios拦截器</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#如何取消重复请求" class="router-link-active router-link-exact-active toc-link level2">如何取消重复请求</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#axios-的-canceltoken" class="router-link-active router-link-exact-active toc-link level3">axios 的 cancelToken</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#两种方法的区别与应用" class="router-link-active router-link-exact-active toc-link level3">两种方法的区别与应用</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#canceltoken的源码分析" class="router-link-active router-link-exact-active toc-link level3">cancelToken的源码分析</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#canceltoken的实际应用" class="router-link-active router-link-exact-active toc-link level3">CancelToken的实际应用</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#loading的显示和隐藏" class="router-link-active router-link-exact-active toc-link level2">loading的显示和隐藏</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#代码说明" class="router-link-active router-link-exact-active toc-link level3">代码说明</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#如何重试请求" class="router-link-active router-link-exact-active toc-link level2">如何重试请求</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#核心实现" class="router-link-active router-link-exact-active toc-link level3">核心实现</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#刷新token" class="router-link-active router-link-exact-active toc-link level2">刷新token</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#实现思路" class="router-link-active router-link-exact-active toc-link level3">实现思路</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#代码实现" class="router-link-active router-link-exact-active toc-link level3">代码实现</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#发现问题" class="router-link-active router-link-exact-active toc-link level3">发现问题</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#同时发起两个或以上的请求时-其他接口如何重试" class="router-link-active router-link-exact-active toc-link level3">同时发起两个或以上的请求时，其他接口如何重试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#不同时间差发起两个或以上的请求时-其他接口如何重试" class="router-link-active router-link-exact-active toc-link level3">不同时间差发起两个或以上的请求时，其他接口如何重试</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#转换请求参数" class="router-link-active router-link-exact-active toc-link level2">转换请求参数</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/http.html#参考资料" class="router-link-active router-link-exact-active toc-link level2">参考资料</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="http服务" tabindex="-1"><a class="header-anchor" href="#http服务" aria-hidden="true">#</a> HTTP服务</h1><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>在前后端分离的项目中，我个人认为http协议是最重要的一环，它是前后端沟通的桥梁，也是数据动态化的唯一途径，所以每一个新框架搭建的时候，http服务的封装永远都是我花费最多心思的模块。本次ionic5的框架也不例外，ionic5 Vue版本，毫无疑问是采用它的老朋友<code>axios</code>,它是基于promise的http库，可运行在浏览器端和node.js中。他有很多优秀的特性，例如拦截请求和响应、取消请求、转换json、客户端防御XSRF等。所以我们的尤大大也是果断放弃了对其官方库vue-resource的维护，直接推荐我们使用axios库。如果还对axios不了解的，可以移步<a href="https://axios-http.com/zh/docs/intro" target="_blank" rel="noopener noreferrer">axios文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>在这里我可能要多啰嗦几句，这次封装http给我的感触很大，因为我两年前用angular2+封装了http服务，通过对比发现这两者的区别很大，angular2+ 给应用提供了一个 HTTP 客户端 API，也就是 <code>@angular/common/http</code> 中的 <code>HttpClient</code> 服务类。它基于浏览器提供的 <code>XMLHttpRequest</code> 接口。 <code>HttpClient</code> 带来的其它优点包括：可测试性、强类型的请求和响应对象、发起请求与接收响应时的拦截器支持，以及更好的、基于可观察<code>（Observable）</code>对象的 API 以及流式错误处理机制。在最新angular的官方文档上， <code>HttpClient</code> 和 <code>Rxjs</code>结合越来越紧密了，如果还对Rxjs不了解的，可以移步<a href="https://cn.rx.js.org/" target="_blank" rel="noopener noreferrer">Rxjs文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>总结一下就是vue是axios库的<code>Promise</code>（承诺），angular2+是用<code>Observable</code>（可观察者对象）.</p><div class="custom-container info"><p class="custom-container-title">可观察对象(Observable) vs 承诺(Promise)</p><p>可观察对象经常拿来和承诺进行对比。有一些关键的不同点：</p><ul><li>可观察对象是声明式的，在被订阅之前，它不会开始执行。承诺是在创建时就立即执行的。这让可观察对象可用于定义那些应该按需执行的菜谱。</li><li>可观察对象能提供多个值。承诺只提供一个。这让可观察对象可用于随着时间的推移获取多个值。</li><li>可观察对象会区分串联处理和订阅语句。承诺只有 <code>.then()</code> 语句。这让可观察对象可用于创建供系统的其它部分使用而不希望立即执行的复杂菜谱。</li><li>可观察对象的 <code>subscribe()</code> 会负责处理错误。承诺会把错误推送给它的子承诺。这让可观察对象可用于进行集中式、可预测的错误处理。</li></ul></div><h5 id="如果看成状态机" tabindex="-1"><a class="header-anchor" href="#如果看成状态机" aria-hidden="true">#</a> 如果看成状态机</h5><ul><li>Promise 具有 3 个状态：pending、resolved、rejected（如果 Cancelable Promise 正式通过，那么还会增加一个状态）。</li><li>Observable 有 N + 3 个状态：idle、pending、resolved_0、resolved_1 … resolved_N、completed 和 error。</li></ul><p>总结：相比于 Promise 这个有限状态机而言，Observable 既可能是有限状态机，也可能是无限状态机（N 为无穷）。</p><p>我个人用了promise和Observable两者之后，我简单的、粗略地发表一些意见，不一定百分百对，可以作为大家的一个参考思路，我认为Observable就想一个工作流，当用户执行<code>subscribe</code>订阅之后，数据被创建，到传输到<code>subscribe</code>接口这段时间之间，Observable可以用很多操作符号，例如<code>map()</code>、<code>do()</code>等等方式，对数据进行优雅的处理，然后返回用户想要的数据。就例如一头猪被宰了之后，放在屠宰场的工作台流水线上进行切割、分拣、清洗、包装之后，再拉到超市上贩卖的过程一样，<code>subscribe</code>方法拿到的数据，就是超市上售卖的成品猪肉。Observable可以干预流水线上所有流程，实现对数据的定制化。Promise就不能干预流水线上任何流程，它能做就是下单买猪肉，屠宰场做好的成品了，他拿到就是超市在售卖的成品猪肉。所以我在使用axios库的时候，对请求数据的处理和数据完成后的处理，只能在axios库中<code>interceptors</code>拦截器完成，但是angular2+就不用使用http的拦截器，一样很优雅处理各种数据，两者各有优劣。</p><h2 id="项目需求" tabindex="-1"><a class="header-anchor" href="#项目需求" aria-hidden="true">#</a> 项目需求</h2><p>一个完整的HTTP服务要包括以下内容：</p><ol><li>能转化特殊字符，例如+，-，[]</li><li>能识别浏览器的不同状态码,例如：5xx/4xx/3xx</li><li>对请求服务进行拦截，处理get和post、put等不同类型的请求参数</li><li>对捕获错误统一报错（包括请求超时，统一报错）</li><li>在HTTP请求发起或者结束，开启或者关闭loading动画</li><li>对请求成功返回的状态进行预处理</li><li>对请求失败的异常信息进行预处理</li><li>同一个页面多个请求只发起一个loading动画</li><li>多次点击按钮，只能触发一次请求，能做到拦截重复请求，取消请求</li><li>支持同步请求，主要作用于默默登录，登录完之后，用户无感知获取新token，不影响原来的接口返回参数</li><li>接受请求超时或者http状态为5xx的时候，进行重试接口</li><li>路由切换取消当前所有pending状态的请求,并且可配置白名单</li><li>单独取消发出的某个请求，针对例如：文件上传比较久，然后想取消的。（尚未开发）</li></ol><h2 id="目录说明" tabindex="-1"><a class="header-anchor" href="#目录说明" aria-hidden="true">#</a> 目录说明</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>                        
├── src                                 
│   ├── utils                     <span class="token comment"># 工具类</span>
│       ├── http                  <span class="token comment"># http服务</span>
│           ├── axiosCancle.ts    <span class="token comment"># 拦截重复请求，取消请求</span>
│           ├── axiosLoading.ts   <span class="token comment"># 显示loading界面和隐藏loading界面的逻辑</span>
│           ├── axiosRetry.ts     <span class="token comment"># 重试接口的逻辑</span>
│           ├── checkStatus.ts    <span class="token comment"># 主要针对一些http协议的状态码进行针对性的一些处理</span>
│           ├── index.ts          <span class="token comment"># http服务的入口文件，初步定义了axios的一些基本属性</span>
│           ├── interceptors.ts   <span class="token comment"># axios库的拦截器方法</span>
│           └── types.ts          <span class="token comment"># 预定义的接口类型</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>http服务存放在<code>/src/utils/http</code>目录底下，一共有7个文件，分别的功能如下：</p><ul><li><code>axiosCancle.ts</code>文件主要解决了多次点击按钮，只能触发一次请求，能做到拦截重复请求，取消请求的功能</li><li><code>axiosLoading.ts</code>文件主要封装了 显示loading界面和隐藏loading界面的逻辑</li><li><code>axiosRetry.ts</code> 文件主要封装了当接口类型为get/put/delete,且请求超时或者状态码为5xx的时候，会发起两次重试接口的逻辑</li><li><code>checkStatus.ts</code> 文件主要针对一些http协议的状态码进行针对性的一些处理</li><li><code>index.ts</code> http服务的入口文件，初步定义了axios的一些基本属性，例如api地址，拦截器的方法等等</li><li><code>interceptors.ts</code> axios库的拦截器方法，包括请求拦截和响应拦截，上面所有文件，都是围绕着这个文件的逻辑处理进行，里面是http服务封装的核心内容。</li><li><code>types.ts</code> 在封装http服务过程中要定义一些接口类型，或者针对axios的已有接口类型进行接口拓展或者继承，都将在这个文件定义，可以说这个文件主要是定义或者声明变量接口的一个集中文件。</li></ul><h2 id="安装-axios" tabindex="-1"><a class="header-anchor" href="#安装-axios" aria-hidden="true">#</a> 安装 axios</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> axios<span class="token punctuation">;</span> // 安装axios
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="基本框架" tabindex="-1"><a class="header-anchor" href="#基本框架" aria-hidden="true">#</a> 基本框架</h2><p><code>index.ts</code>http服务的入口文件，初步定义了axios的一些基本属性，例如api地址，拦截器的方法等等</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> axios<span class="token punctuation">,</span> <span class="token punctuation">{</span> AxiosInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> requestFail<span class="token punctuation">,</span> requestSuccess<span class="token punctuation">,</span> responseFail<span class="token punctuation">,</span> responseSuccess <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./interceptors&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> service<span class="token operator">:</span> AxiosInstance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token operator">:</span> fitsConfig<span class="token punctuation">.</span>baseURL<span class="token punctuation">,</span> <span class="token comment">// url = base url + request url</span>
  timeout<span class="token operator">:</span> fitsConfig<span class="token punctuation">.</span>httpTimeOut<span class="token punctuation">,</span>
  retries<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">// 重试的次数</span>
  retryDelay<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token comment">// 每一次重试，会延迟多少秒</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 请求拦截</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>requestSuccess<span class="token punctuation">,</span> requestFail<span class="token punctuation">)</span>

<span class="token comment">// 响应拦截</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>responseSuccess<span class="token punctuation">,</span> responseFail<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> service<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="http服务的调用方式" tabindex="-1"><a class="header-anchor" href="#http服务的调用方式" aria-hidden="true">#</a> http服务的调用方式</h3><p>在<code>src/api/app.ts</code>放http的调用接口。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 导入index文件中http模块</span>
<span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">&quot;@/utils/http&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getUserInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">&#39;/Common/User&#39;</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">&#39;get&#39;</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1111</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">&quot;ddd&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    isLoading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 拓展的属性</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="http的接口类型" tabindex="-1"><a class="header-anchor" href="#http的接口类型" aria-hidden="true">#</a> http的接口类型</h2><p><code>types.ts</code> 在封装http服务过程中要定义一些接口类型，或者针对axios的已有接口类型进行接口拓展或者继承，都将在这个文件定义，可以说这个文件主要是定义或者声明变量接口的一个集中文件。</p><p>在这个文件中，你可以看到ts中关于接口类型的枚举、接口的拓展。</p><h3 id="接口的扩展" tabindex="-1"><a class="header-anchor" href="#接口的扩展" aria-hidden="true">#</a> 接口的扩展</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 拓展AxiosRequestConfig的接口，在他原来已有的基础上拓展更多的属性</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
       <span class="token comment">// 是否显示loading界面</span>
       isLoading<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// 是否显示提示信息</span>
       isShowMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// 成功的文本信息</span>
       successMessageText<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
       <span class="token comment">// 是否显示成功信息</span>
       isShowSuccessMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// 是否显示失败信息</span>
       isShowErrorMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
       <span class="token comment">// 错误的文本信息</span>
       errorMessageText<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
       <span class="token comment">// 旧的参数类型，默默登录，换token的时候，需要</span>
       oldParams<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
       <span class="token comment">// 旧的URL，URL在请求拦截会被改变，默默登录，换token的时候，需要</span>
       oldURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
       <span class="token comment">// 错误消息提示类型</span>
       errorMessageMode<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&#39;alert&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;toast&#39;</span><span class="token punctuation">;</span>
       <span class="token comment">// 失败前重试的次数,默认是一次</span>
       retries<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> 
       <span class="token comment">// 控制重试请求之间延迟的回调。默认是2000毫秒，默认是1秒</span>
       retryDelay<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
       <span class="token comment">// 当前重试的次数，或者说当前是第几次重试</span>
       retryCount<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name">AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span><span class="token punctuation">{</span>
        RetCode<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
        Message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
        ReturnData<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container danger"><p class="custom-container-title">为什么要扩展AxiosRequestConfig?</p></div><p>首先在vscode上，找到index.ts入口文件，点击关键字<code>axios</code>,按住Ctrl键，点击关键字，查看源码，如下：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
  url<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  method<span class="token operator">?</span><span class="token operator">:</span> Method<span class="token punctuation">;</span>
  baseURL<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  transformRequest<span class="token operator">?</span><span class="token operator">:</span> AxiosTransformer <span class="token operator">|</span> AxiosTransformer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  transformResponse<span class="token operator">?</span><span class="token operator">:</span> AxiosTransformer <span class="token operator">|</span> AxiosTransformer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  headers<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  params<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  paramsSerializer<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  timeout<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  timeoutErrorMessage<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  withCredentials<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  adapter<span class="token operator">?</span><span class="token operator">:</span> AxiosAdapter<span class="token punctuation">;</span>
  auth<span class="token operator">?</span><span class="token operator">:</span> AxiosBasicCredentials<span class="token punctuation">;</span>
  responseType<span class="token operator">?</span><span class="token operator">:</span> ResponseType<span class="token punctuation">;</span>
  xsrfCookieName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  xsrfHeaderName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  onUploadProgress<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>progressEvent<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  onDownloadProgress<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>progressEvent<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  maxContentLength<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  validateStatus<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>status<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  maxBodyLength<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  maxRedirects<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  socketPath<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  httpAgent<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  httpsAgent<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  proxy<span class="token operator">?</span><span class="token operator">:</span> AxiosProxyConfig <span class="token operator">|</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  cancelToken<span class="token operator">?</span><span class="token operator">:</span> CancelToken<span class="token punctuation">;</span>
  decompress<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosInstance</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosPromise<span class="token punctuation">;</span>
  <span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosPromise<span class="token punctuation">;</span>
  defaults<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">;</span>
  interceptors<span class="token operator">:</span> <span class="token punctuation">{</span>
    request<span class="token operator">:</span> AxiosInterceptorManager<span class="token operator">&lt;</span>AxiosRequestConfig<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    response<span class="token operator">:</span> AxiosInterceptorManager<span class="token operator">&lt;</span>AxiosResponse<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">getUri</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span> <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">delete</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">head</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">options</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">put</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">patch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">R</span> <span class="token operator">=</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">R</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AxiosStatic</span> <span class="token keyword">extends</span> <span class="token class-name">AxiosInstance</span> <span class="token punctuation">{</span>
  <span class="token function">create</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> AxiosInstance<span class="token punctuation">;</span>
  Cancel<span class="token operator">:</span> CancelStatic<span class="token punctuation">;</span>
  CancelToken<span class="token operator">:</span> CancelTokenStatic<span class="token punctuation">;</span>
  <span class="token function">isCancel</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">all</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>values<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token generic-function"><span class="token function">spread</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">R</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>array<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">R</span><span class="token punctuation">;</span>
  <span class="token function">isAxiosError</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> payload <span class="token keyword">is</span> AxiosError<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> <span class="token keyword">const</span> axios<span class="token operator">:</span> AxiosStatic<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们看到源码可以发现，axios 实例化 <code>create</code>事件的出入参数接口类型都是： <code>AxiosRequestConfig</code></p><p>然而源码中的属性是固定的，但是我们需要更多属性去配合我们做业务上的变化，例如是否控制loading的显示隐藏、是否需要打开提示框，定义重试的次数和延迟时间等等，这些属性都是源码没有的。基于这种原因，所以我们需要拓展更多属性，可能有人会问不拓展会发生什么？会产生什么问题？</p><p>如果不拓展接口属性，在ts项目中，因为没有发现这个属性，所以会报错，编译就会不通过，如果不是开启严格模式，在一般的js项目中，这种一般不会有问题，在js中，如果没有这个属性，会自动添加这个属性，在tslint的规则中，因为是强类型语言，所以不拓展属性，就会编译不通过</p><p><img src="/fitsadmin-docs/images/20220823045254.png" alt="图 2"></p><p>接口的拓展后，不仅能拥有原来的属性，还能自动合并你定义的属性，接口的拓展关键代码是</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
        <span class="token comment">// 自定义属性</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我在其中还尝试过ts的接口继承，但是在实际开发过程发现不太合适，因为会改变接口类型的名字，以下是接口继承的范例:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> AxiosRequestConfig from axios
<span class="token keyword">interface</span> <span class="token class-name">customAxiosRequestConfig</span> <span class="token keyword">extends</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
        <span class="token comment">// 自定义属性</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上面代码可以看出来，定义的<code>customAxiosRequestConfig</code>接口是可以继承<code>AxiosRequestConfig</code>所有属性和自定义属性的，但是不符合我们的需求，如果我们用了<code>customAxiosRequestConfig</code>接口名字，就改变了源码中<code>AxiosRequestConfig</code>的接口名字，会导致源码中很多定义了这个名字的接口都要相应的修改，工程量太大，而且没必要，因为接口的拓展就已经很完美的解决问题了，不需要继承。</p><h3 id="ts中的枚举用法" tabindex="-1"><a class="header-anchor" href="#ts中的枚举用法" aria-hidden="true">#</a> ts中的枚举用法</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: 请求结果集
 */</span>
<span class="token keyword">export</span> <span class="token keyword">enum</span> ResultEnum <span class="token punctuation">{</span>
    <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token comment">// 查询成功、操作成功  </span>
    <span class="token constant">ERROR</span> <span class="token operator">=</span> <span class="token number">1002</span><span class="token punctuation">,</span>   <span class="token comment">// 操作失败、查询失败  </span>
    <span class="token constant">STYSTEM_ERROR</span> <span class="token operator">=</span> <span class="token number">2001</span><span class="token punctuation">,</span> <span class="token comment">// 系统异常  </span>
    <span class="token constant">LOGIN_FAIL</span> <span class="token operator">=</span> <span class="token number">2002</span><span class="token punctuation">,</span>    <span class="token comment">// 登录身份验证失效</span>
    <span class="token constant">DOUBLE_REQUEST</span> <span class="token operator">=</span> <span class="token number">2003</span><span class="token punctuation">,</span> <span class="token comment">// 重复请求</span>
    <span class="token constant">PARAMAR_ERROR</span> <span class="token operator">=</span> <span class="token number">2004</span><span class="token punctuation">,</span>  <span class="token comment">// 参数不符合要求</span>
    <span class="token constant">APPID_LOWER</span> <span class="token operator">=</span> <span class="token number">2005</span><span class="token punctuation">,</span>  <span class="token comment">// APP版本过低</span>
    <span class="token constant">APPID_ERROR</span> <span class="token operator">=</span> <span class="token number">2006</span><span class="token punctuation">,</span>  <span class="token comment">// APPID无效、微信获取用户信息失败</span>
    <span class="token constant">HOT_UNPDATE</span> <span class="token operator">=</span> <span class="token number">2007</span><span class="token punctuation">,</span>  <span class="token comment">// 需要进行热更新检查</span>
    <span class="token constant">USER_UNPDATE</span><span class="token operator">=</span> <span class="token number">2008</span><span class="token punctuation">,</span>  <span class="token comment">// 用户信息已变更		</span>
    <span class="token constant">FORCE_OFFLINE</span><span class="token operator">=</span><span class="token number">2009</span><span class="token punctuation">,</span>  <span class="token comment">// 强制下线</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="axios拦截器" tabindex="-1"><a class="header-anchor" href="#axios拦截器" aria-hidden="true">#</a> axios拦截器</h2><p>打开<code>interceptors.ts</code>文件，可以看到请求拦截和响应拦截，基本框架如下：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 请求拦截器</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">requestSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断当前请求是否设置了不显示Loading</span>
    <span class="token comment">// 在请求发出去之前拦截请求参数，包括param和body，</span>
    <span class="token comment">// get接口的数据，属性要用Data[id]=1111&amp;Data[text]这个格式才能请求成功</span>
    <span class="token comment">// post请求，需要把所有属性的数据包裹在Data{}里面</span>
    <span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 请求失败拦截</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">requestFail</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里极少情况会进来，暂时没有找到主动触发的方法，估计只有浏览器不兼容时才会触发，欢迎后面同学补充</span>
    <span class="token comment">// 看了几个GitHub的issue，有人甚至提出了这个方法是不必要的（因为没有触发的场景），不过还是建议大家按照官方的写法，避免不必要的错误</span>
    <span class="token comment">// 进来之后没法发起请求</span>
    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 用resolve会令这个请求的promise不会被中断，还是会把error返回到请求中的then的流程中</span>
    <span class="token comment">// return Promise.resolve(error); </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token doc-comment comment">/**
 * 响应成功拦截器
 * 只有返回的状态码是2xx，都会进来这里
 * 1. 返回data里面的数据，只保留公司接口规范的数据
 * 2. Axios 接口超时统一处理，请求超时的话，可以重新发起一次请求
 * 3. 针对公司自定义的各种状态码进行处理
 * 4. 能默默登录，换取新的token
 * 5. 能关闭loading界面
 * <span class="token keyword">@param</span> <span class="token parameter">response</span> 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> 响应失败拦截器 统一处理http异常
 * <span class="token keyword">@description</span> 注意如果取消请求，一样走responseFail的流程
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseFail</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> AxiosError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. http状态码非2开头的都会进来这里，如404,500等</span>
    <span class="token comment">// 2. 取消请求也会进入这里，CancelToken，可以用axios.isCancel(err)来判断是取消的请求</span>
    <span class="token comment">// 3. 请求运行有异常也会进入这里，如故意将headers写错：axios.defaults.headers = &#39;123&#39;,或者在request中有语法或解析错误也会进入这里</span>
    <span class="token comment">// 4. 这里会处理一些达到重连的条件的接口，进行重连。</span>
    <span class="token comment">// 进入这里意味着请求失败，axios会进入catch分支</span>
   
        <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="如何取消重复请求" tabindex="-1"><a class="header-anchor" href="#如何取消重复请求" aria-hidden="true">#</a> 如何取消重复请求</h2><p>在开发中，经常会遇到接口重复请求导致的各种问题。</p><p>对于重复的get请求，会导致页面更新多次，发生页面抖动的现象，影响用户体验。</p><p>对于重复的post请求，会导致在服务端生成两次记录（例如运维组提交退件申请，一不小心就会在后台产生两条记录）。</p><p>本次http服务更新，提供以下问题的解决方案：</p><ol><li>路由切换的时候，取消当前所有接口处于pending状态的请求</li><li>当用户多次点击按钮，对同一个接口同时发起多次请求的时候，保留第一次请求，中断后面多余的请求。</li></ol><p>网上找了一些博主的方法，大部分都是拦截了前面的请求。比如说发了一个请求a, 在 a 还没有完成时，又发了一个与 a 一样的请求 a2 ,大部分的方法是取消了请求a只保留a2，以上方法在接口快的时候是不会有问题的。但是接口慢的时候，a接口都快要请求完成了，这时给它来了个取消，很浪费后端资源，就是第一个接口a后端已经差不多处理好数据，正准备返回的时候，前端突然中断它，然后再发起一个相同的接口a2，后端又要重新处理一遍，因此不太合理。</p><h3 id="axios-的-canceltoken" tabindex="-1"><a class="header-anchor" href="#axios-的-canceltoken" aria-hidden="true">#</a> axios 的 cancelToken</h3><p>在axios官方文档上要取消一个正在发出或已发出但是还没有返回数据的请求，用到的是axios.CancelToken这个对像里面的方法，官方案例如下：</p><p>第一种方法：使用 CancelToken.source 工厂方法创建 cancel token，像这样：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> CancelToken<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/user/12345&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>thrown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Request canceled&#39;</span><span class="token punctuation">,</span> thrown<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token comment">// 处理错误</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/user/12345&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&#39;new name&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> source<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 取消请求（message 参数是可选的）</span>
source<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token string">&#39;Operation canceled by the user.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二种方法： 通过传递一个 executor 函数到 CancelToken 的构造函数来创建 cancel token：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> CancelToken <span class="token operator">=</span> axios<span class="token punctuation">.</span>CancelToken<span class="token punctuation">;</span>
<span class="token keyword">let</span> cancel<span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/user/12345&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cancelToken<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// executor 函数接收一个 cancel 函数作为参数</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// cancel the request</span>
<span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="两种方法的区别与应用" tabindex="-1"><a class="header-anchor" href="#两种方法的区别与应用" aria-hidden="true">#</a> 两种方法的区别与应用</h3><p>第一种方法是多个请求共用一个token,适合在某一时间同时取消所有请求，第二种方法每个请求有独立的token,适合每个请求分情况是否进行单独取消。</p><p>根据我们的需求，很明显我们要采用第二种更加灵活。</p><h3 id="canceltoken的源码分析" tabindex="-1"><a class="header-anchor" href="#canceltoken的源码分析" aria-hidden="true">#</a> cancelToken的源码分析</h3><p>为了让大家更加直观了解cancelToken是如何做到生成令牌，通过令牌是取消接口，我们对源码进行一波分析，让大家了解一下他的设计思想</p><p>先看官方的源码：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//路径在： node_module/axios/lib/cancel/CancelToken.js</span>

<span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Cancel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./Cancel&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">CancelToken</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> executor <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&#39;executor must be a function.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
    * 定义一个将来能执行取消请求的promise对象，当这个promise的状态为完成时(fullfilled),
    * 就会触发取消请求的操作（执行then函数）。而执行resolve就能将promise的状态置为完成状态。
    * 这里把resolve赋值给resolvePromise，就是为了在这个promise外能执行resolve而改变这个promise的状态
    * 注意这个promise对象被赋值给CancelToken实例的属性promise，将来定义then函数就是通过这个属性得到promise
    */</span>
    <span class="token keyword">var</span> resolvePromise<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">promiseExecutor</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        resolvePromise <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
    * 将CancelToken实例赋值给token
    * 执行executor函数，将cancel方法传入executor，
    * cancel方法可调用resolvePromise方法，即触发取消请求的操作
    */</span>
    <span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 取消已响应 返回</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        token<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 这里执行的就是promise的resolve方法，改变状态</span>
        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">CancelToken</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">throwIfRequested</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">throwIfRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 这里可以看清楚source函数的真面目</span>
CancelToken<span class="token punctuation">.</span><span class="token function-variable function">source</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> cancel<span class="token punctuation">;</span>
    <span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// c 就是CancelToken中给executor传入的cancel方法</span>
        cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">token</span><span class="token operator">:</span> token<span class="token punctuation">,</span>
        <span class="token literal-property property">cancel</span><span class="token operator">:</span> cancel
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> CancelToken<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>CancelToken</code>是一个构造函数，通过<code>new CancelToken()</code>得到的是一个实例对象，它只有一个属性<code>promise</code>, 它的值是一个能触发取消请求的Promise对象。</p><pre><code>token = new CancelToken(executor function) ===&gt; { promise: Promise对象 }
</code></pre><p>执行CancelToken函数做了两件事：</p><ol><li>创建一个Promise对象，且将这个对象赋值给promise属性，其resolve参数被暴露出来以备cancel函数执行。这个就是点睛之笔，通过暴露resolve给全局变量，让promise触发时机，由外面的方法所控制。</li><li>执行<code>executor</code>函数，将内部定义的<code>cancel</code>函数作为参数传递给<code>executor</code></li></ol><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 源码相当于：</span>
<span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 取消动作已响应 返回</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    token<span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cancel</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里执行的就是promise的resolve方法，改变状态</span>
    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">executor</span><span class="token punctuation">(</span>cancel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以执行</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">let</span> cancel
token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cancel <span class="token operator">=</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因此得到结果是：</p><ul><li>token值为{promise: Promise对象}</li><li>executor函数被执行，即cancel = c执行，因此变量cancel被赋值了，值就是CanelToken内部的那个cancel函数。</li></ul><h3 id="canceltoken的实际应用" tabindex="-1"><a class="header-anchor" href="#canceltoken的实际应用" aria-hidden="true">#</a> CancelToken的实际应用</h3><p>上面我们讲明白了原理，下面讲一下实际如何使用</p><!----><p>上面重要的知识点是：es6语法中的Map的方法的具体使用。有兴趣的同学，百度查一下具体用法。</p><h2 id="loading的显示和隐藏" tabindex="-1"><a class="header-anchor" href="#loading的显示和隐藏" aria-hidden="true">#</a> loading的显示和隐藏</h2><h3 id="代码说明" tabindex="-1"><a class="header-anchor" href="#代码说明" aria-hidden="true">#</a> 代码说明</h3><ol><li>基本原理是通过 axios 提供的请求拦截和响应拦截的接口，控制 loading 的显示或者隐藏。</li><li>loding 效果这里采用的是 ionic 中提供的 loadingController 组件来实现</li><li>内部有个计数器，确保同一时刻如果有多个请求的话，不会同时出现多个 loading，而是只有 1 个。并且在所有请求结束后才会隐藏 loading。</li><li>使用了 lodash 的 debounce 防抖。因为有时会碰到在一次请求完毕后又立刻又发起一个新的请求的情况（比如删除一个表格条目后立刻进行刷新）。这种情况会造成连续 loading 两次，并且中间有一次极短的闪烁。通过防抖可以让 300ms 间隔内的 loading 便合并为一次，避免闪烁的情况。</li><li>默认所有请求都会自动有 loading 效果。如果某个请求不需要 loading 效果，可以在请求参数AxiosRequestConfig中设置isLoading设置为false</li></ol><!----><h2 id="如何重试请求" tabindex="-1"><a class="header-anchor" href="#如何重试请求" aria-hidden="true">#</a> 如何重试请求</h2><p>这里主要封装关于http出现网络错误或幂等请求（GET、HEAD、OPTIONS、PUT 或 DELETE）上的 5xx 错误，http请求将会重连的操作</p><p>这里设计了一个http的概念：<a href="https://www.zuimoban.com/php/other/7171_2.html" target="_blank" rel="noopener noreferrer">幂等请求<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>针对是否达到重试的条件，我做了以下判断</p><!----><h3 id="核心实现" tabindex="-1"><a class="header-anchor" href="#核心实现" aria-hidden="true">#</a> 核心实现</h3><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span> 响应失败拦截器 统一处理http异常
 * <span class="token keyword">@param</span> <span class="token parameter">error</span> CustomAxiosError 自定义类型
 * <span class="token keyword">@returns</span> 
 * <span class="token keyword">@description</span> 注意如果取消请求，一样走responseFail的流程
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseFail</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> AxiosError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// more something code</span>

  <span class="token comment">// 以下是重试逻辑</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">.</span>config <span class="token operator">||</span> <span class="token operator">!</span>error<span class="token punctuation">.</span>config<span class="token punctuation">.</span>retries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>config<span class="token punctuation">}</span> <span class="token operator">=</span> error<span class="token punctuation">;</span>
        config<span class="token punctuation">.</span>retryCount <span class="token operator">=</span> config<span class="token punctuation">.</span>retryCount <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> shouldRetry <span class="token operator">=</span> <span class="token function">isNetworkOrIdempotentRequestErrors</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span>retryCount  <span class="token operator">&lt;</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>retries <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
        <span class="token keyword">if</span><span class="token punctuation">(</span>shouldRetry<span class="token punctuation">)</span><span class="token punctuation">{</span>
            config<span class="token punctuation">.</span>retryCount <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                config<span class="token punctuation">.</span>url <span class="token operator">=</span> config<span class="token punctuation">.</span>oldURL<span class="token punctuation">;</span>
                config<span class="token punctuation">.</span>params <span class="token operator">=</span> config<span class="token punctuation">.</span>oldParams<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>retryDelay <span class="token operator">||</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="刷新token" tabindex="-1"><a class="header-anchor" href="#刷新token" aria-hidden="true">#</a> 刷新token</h2><p>项目一直存在一个需求：前端登录后，后端返回token，当接口返回token过期时，要求用登录接口，默默登录，获取新的token，前端需要做到无痛刷新token，即请求刷新token时要做到用户无感知。</p><h3 id="实现思路" tabindex="-1"><a class="header-anchor" href="#实现思路" aria-hidden="true">#</a> 实现思路</h3><p>拦截接口返回后的数据。检查如果是token过期的状态码，先发起登录请求，获取接口返回的新token，保存到本地，再进行所有接口的重试。</p><h3 id="代码实现" tabindex="-1"><a class="header-anchor" href="#代码实现" aria-hidden="true">#</a> 代码实现</h3><p>后端接口一般会有一个约定好的数据结构，如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span><span class="token literal-property property">RetCode</span><span class="token operator">:</span> <span class="token number">2002</span><span class="token punctuation">,</span> <span class="token literal-property property">Message</span><span class="token operator">:</span> <span class="token string">&#39;token过期&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">ReturnData</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如我这里，后端约定当{RetCode === 2002时表示token过期了，此时就要求刷新token。我主要使用的响应拦截</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>
<span class="token doc-comment comment">/**
 * <span class="token keyword">@description</span>: 请求结果集
 */</span>
<span class="token keyword">export</span> <span class="token keyword">enum</span> ResultEnum <span class="token punctuation">{</span>
    <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token comment">// 查询成功、操作成功  </span>
    <span class="token constant">ERROR</span> <span class="token operator">=</span> <span class="token number">1002</span><span class="token punctuation">,</span>   <span class="token comment">// 操作失败、查询失败  </span>
    <span class="token constant">STYSTEM_ERROR</span> <span class="token operator">=</span> <span class="token number">2001</span><span class="token punctuation">,</span> <span class="token comment">// 系统异常  </span>
    <span class="token constant">LOGIN_FAIL</span> <span class="token operator">=</span> <span class="token number">2002</span><span class="token punctuation">,</span>    <span class="token comment">// 登录身份验证失效</span>
    <span class="token constant">DOUBLE_REQUEST</span> <span class="token operator">=</span> <span class="token number">2003</span><span class="token punctuation">,</span> <span class="token comment">// 重复请求</span>
    <span class="token constant">PARAMAR_ERROR</span> <span class="token operator">=</span> <span class="token number">2004</span><span class="token punctuation">,</span>  <span class="token comment">// 参数不符合要求</span>
    <span class="token constant">APPID_LOWER</span> <span class="token operator">=</span> <span class="token number">2005</span><span class="token punctuation">,</span>  <span class="token comment">// APP版本过低</span>
    <span class="token constant">APPID_ERROR</span> <span class="token operator">=</span> <span class="token number">2006</span><span class="token punctuation">,</span>  <span class="token comment">// APPID无效、微信获取用户信息失败</span>
    <span class="token constant">HOT_UNPDATE</span> <span class="token operator">=</span> <span class="token number">2007</span><span class="token punctuation">,</span>  <span class="token comment">// 需要进行热更新检查</span>
    <span class="token constant">USER_UNPDATE</span><span class="token operator">=</span> <span class="token number">2008</span><span class="token punctuation">,</span>  <span class="token comment">// 用户信息已变更		</span>
    <span class="token constant">FORCE_OFFLINE</span><span class="token operator">=</span><span class="token number">2009</span><span class="token punctuation">,</span>  <span class="token comment">// 强制下线</span>
<span class="token punctuation">}</span>
<span class="token comment">// 属性token的方法</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">refreshToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> LoginID<span class="token operator">:</span> <span class="token string">&#39;caogj&#39;</span><span class="token punctuation">,</span> Password<span class="token operator">:</span> <span class="token string">&#39;1111111&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 重新请求</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> RetCode<span class="token punctuation">,</span> ReturnData <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>RetCode <span class="token operator">===</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;app/setToken&#39;</span><span class="token punctuation">,</span> ReturnData<span class="token punctuation">.</span>LoginToken<span class="token punctuation">)</span>
            <span class="token keyword">const</span> config <span class="token operator">=</span> response<span class="token punctuation">.</span>config
            <span class="token comment">// 由于requestSuccess拦截器里面对URL进行了改造，所以这里把最原始的URL转化出来</span>
            config<span class="token punctuation">.</span>url <span class="token operator">=</span> config<span class="token punctuation">.</span>oldURL<span class="token punctuation">;</span>
            config<span class="token punctuation">.</span>params <span class="token operator">=</span> config<span class="token punctuation">.</span>oldParams<span class="token punctuation">;</span>
            <span class="token comment">// 最先的接口返回2002，也是最先返回正式的结果，剩余的接口再按顺序返回</span>
            <span class="token keyword">return</span> <span class="token function">http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//刷新token失败，神仙也救不了了，跳转到首页重新登录吧</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;refreshtoken error =&gt;&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token comment">//刷新token失败，神仙也救不了了，跳转到首页重新登录吧 </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
 * 响应成功拦截器
 * 只有返回的状态码是2xx，都会进来这里
 * 1. 返回data里面的数据，只保留公司接口规范的数据
 * 2. Axios 接口超时统一处理，请求超时的话，可以重新发起一次请求
 * 3. 误触按钮导致重复请求可以被取消
 * <span class="token keyword">@param</span> <span class="token parameter">response</span> 
 * <span class="token keyword">@returns</span> 
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>config <span class="token operator">&amp;&amp;</span> <span class="token function">removePendingMap</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>config <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>config<span class="token punctuation">.</span>isLoading <span class="token operator">!==</span> <span class="token boolean">false</span>  <span class="token operator">&amp;&amp;</span> <span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 关闭loading</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> RetCode<span class="token punctuation">,</span> Message<span class="token punctuation">,</span> ReturnData <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// 请求成功</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 请求失败</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 系统异常</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// 这里理解为2002</span>
            <span class="token comment">// 登录失败</span>
           <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 更多状态，请参照枚举ResultEnum类型，进行业务处理</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里要注意几件事：</p><ul><li>真实项目中请求登录的账号密码<code>{ LoginID: &#39;caogj&#39;, Password: &#39;1111111&#39; }</code>会由store全局调用。</li><li>由于requestSuccess拦截器里面对URL进行了改造，所以这里把最原始的URL转化出来，我们再发起请求的时候，要把URL和params重新转化一下。</li></ul><p>以上就基本做到了无痛刷新token，当token正常时，正常返回，当token已过期，则axios内部进行一次刷新token和重试。对调用者来说，axios内部的刷新token是一个黑盒，是无感知的，因此需求已经做到了。</p><h3 id="发现问题" tabindex="-1"><a class="header-anchor" href="#发现问题" aria-hidden="true">#</a> 发现问题</h3><p>上面的代码还是存在一些问题的，没有考虑到多次请求的问题，因此需要进一步优化。</p><h4 id="如何防止多次刷新token" tabindex="-1"><a class="header-anchor" href="#如何防止多次刷新token" aria-hidden="true">#</a> 如何防止多次刷新token</h4><p>如果refreshToken接口还没返回，此时再有一个过期的请求进来，上面的代码就会再一次执行refreshToken，这就会导致多次执行刷新token的接口，因此需要防止这个问题。我们可以在request.js中用一个变量isRefreshing来标记当前是否正在刷新token的状态，如果正在刷新则不再调用刷新token的接口。</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 是否正在刷新的标记</span>
<span class="token keyword">let</span> isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// 请求成功</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 请求失败</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 系统异常</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// 这里理解为2002</span>
            <span class="token comment">// 登录失败</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>

        <span class="token comment">// 更多状态，请参照枚举ResultEnum类型，进行业务处理</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样子就可以避免在刷新token时再进入方法了。但是这种做法是相当于把其他失败的接口给舍弃了，假如同时发起两个请求，且几乎同时返回，第一个请求肯定是进入了refreshToken后再重试，而第二个请求则被丢弃了，仍是返回失败，所以接下来还得解决其他接口的重试问题。</p><h3 id="同时发起两个或以上的请求时-其他接口如何重试" tabindex="-1"><a class="header-anchor" href="#同时发起两个或以上的请求时-其他接口如何重试" aria-hidden="true">#</a> 同时发起两个或以上的请求时，其他接口如何重试</h3><p>两个接口几乎同时发起和返回，第一个接口会进入刷新token后重试的流程，而第二个接口需要先存起来，然后等刷新token后再重试。同样，如果同时发起三个请求，此时需要缓存后两个接口，等刷新token后再重试。由于接口都是异步的，处理起来会有点麻烦。</p><p>当第二个过期的请求进来，token正在刷新，我们先将这个请求存到一个数组队列中，想办法让这个请求处于等待中，一直等到刷新token后再逐个重试清空请求队列。 那么如何做到让这个请求处于等待中呢？为了解决这个问题，我们得借助Promise。将请求存进队列中后，同时返回一个Promise，让这个Promise一直处于Pending状态（即不调用resolve），此时这个请求就会一直等啊等，只要我们不执行resolve，这个请求就会一直在等待。当刷新请求的接口返回来后，我们再调用resolve，逐个重试。最终代码：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 是否正在刷新的标记</span>
<span class="token keyword">let</span> isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">// 重试队列，每一项将是一个待执行的函数形式</span>
<span class="token keyword">let</span> requestQueues<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">refreshToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span> LoginID<span class="token operator">:</span> <span class="token string">&#39;caogj&#39;</span><span class="token punctuation">,</span> Password<span class="token operator">:</span> <span class="token string">&#39;1111111&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 重新请求</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> RetCode<span class="token punctuation">,</span> ReturnData <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>RetCode <span class="token operator">===</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span> <span class="token comment">// something</span>
            <span class="token comment">// 最先的接口返回2002，也是最先返回正式的结果，剩余的接口再按顺序返回</span>
            <span class="token comment">// 已经刷新了token，将所有队列中的请求进行重试</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>requestQueues <span class="token operator">&amp;&amp;</span> requestQueues<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                requestQueues<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>callback <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                requestQueues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            isRefreshing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">http</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//刷新token失败，神仙也救不了了，跳转到首页重新登录吧</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;refreshtoken error =&gt;&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token comment">//刷新token失败，神仙也救不了了，跳转到首页重新登录吧 </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// 请求成功</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 请求失败</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 系统异常</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// 这里理解为2002</span>
            <span class="token comment">// 登录失败</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 当遇到正在默默登录的接口，返回一个未执行resolve的promise</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 将resolve放进队列，用一个函数形式来保存，等token刷新后直接执行</span>
                    requestQueues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">http</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>

        <span class="token comment">// 更多状态，请参照枚举ResultEnum类型，进行业务处理</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里可能比较难理解的是requests这个队列中保存的是一个函数，这是为了让resolve不执行，先存起来，等刷新token后更方便调用这个函数使得resolve执行。这个设计思想跟axios中的取消请求的令牌cancelToken是一样的，大家可以看回前面的源码分析。</p><h3 id="不同时间差发起两个或以上的请求时-其他接口如何重试" tabindex="-1"><a class="header-anchor" href="#不同时间差发起两个或以上的请求时-其他接口如何重试" aria-hidden="true">#</a> 不同时间差发起两个或以上的请求时，其他接口如何重试</h3><p>这里的意思是当页面有两个接口a和b接口，a接口发起了token刷新重试操作，当token接口没有及时返回token的时候，b接口马上就发起了，这个时候token还没有回来，这样会导致了a和b接口都执行了一次刷新token的操作，这样会引发一系列的问题，例如第一次换取的token会被第二次token覆盖，或者第一次是通过授权码换取的token，第二次授权码失效了导致了b接口的失败。</p><p>针对以上的情况，我们调整以下步骤</p><div class="md-enhance-mermaid loading"><svg xmlns="http://www.w3.org/2000/svg" class="icon loading-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="loading icon"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" strokewidth="2"><animate attributename="r" repeatcount="indefinite" dur="1s" values="0;40" keytimes="0;1" keysplines="0 0.2 0.8 1" calcmode="spline" begin="0s"></animate><animate attributename="opacity" repeatcount="indefinite" dur="1s" values="1;0" keytimes="0;1" keysplines="0.2 0 0.8 1" calcmode="spline" begin="0s"></animate></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" strokewidth="2"><animate attributename="r" repeatcount="indefinite" dur="1s" values="0;40" keytimes="0;1" keysplines="0 0.2 0.8 1" calcmode="spline" begin="-0.333s"></animate><animate attributename="opacity" repeatcount="indefinite" dur="1s" values="1;0" keytimes="0;1" keysplines="0.2 0 0.8 1" calcmode="spline" begin="-0.333s"></animate></circle><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" strokewidth="2"><animate attributename="r" repeatcount="indefinite" dur="1s" values="0;40" keytimes="0;1" keysplines="0 0.2 0.8 1" calcmode="spline" begin="-0.667s"></animate><animate attributename="opacity" repeatcount="indefinite" dur="1s" values="1;0" keytimes="0;1" keysplines="0.2 0 0.8 1" calcmode="spline" begin="-0.667s"></animate></circle></svg></div><p>最终代码：</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 重置请求参数</span>
<span class="token keyword">const</span> <span class="token function-variable function">resetRequestParams</span> <span class="token operator">=</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>url <span class="token operator">=</span> config<span class="token punctuation">.</span>oldURL
    config<span class="token punctuation">.</span>params <span class="token operator">=</span> config<span class="token punctuation">.</span>oldParams
    <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">responseSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token operator">:</span> AxiosResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>RetCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token operator">:</span>
            <span class="token comment">// 请求成功</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 请求失败</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">STYSTEM_ERROR</span><span class="token operator">:</span>
            <span class="token comment">// 系统异常</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> ResultEnum<span class="token punctuation">.</span><span class="token constant">LOGIN_FAIL</span><span class="token operator">:</span> <span class="token comment">// 这里理解为2002</span>
            <span class="token comment">// 登录失败</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>UserModule<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRefreshing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  isRefreshing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                  <span class="token keyword">return</span> <span class="token function">refreshToken</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 当遇到正在默默登录的接口，返回一个未执行resolve的promise</span>
                  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                      <span class="token comment">// 将resolve放进队列，用一个函数形式来保存，等token刷新后直接执行</span>
                      requestQueues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">http</span><span class="token punctuation">(</span><span class="token function">resetRequestParams</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                      <span class="token punctuation">}</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span> 
         <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
         	<span class="token comment">// 当由于接口快慢问题，会导致授权接口还没有返回token的时候，然后又发起了新一个请求，</span>
          <span class="token comment">// 新请求因为没有token，又会直接报2002，导致又需要去请求一次授权，有时候会覆盖token或者引发其他问题。</span>
                <span class="token keyword">return</span> <span class="token function">http</span><span class="token punctuation">(</span><span class="token function">resetRequestParams</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 更多状态，请参照枚举ResultEnum类型，进行业务处理</span>
    <span class="token punctuation">}</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="转换请求参数" tabindex="-1"><a class="header-anchor" href="#转换请求参数" aria-hidden="true">#</a> 转换请求参数</h2><p>转换参数的逻辑，是放在请求之前的拦截器里面：requestSuccess</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// 请求拦截器</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">requestSuccess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>request<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断当前请求是否设置了不显示Loading</span>
    request<span class="token punctuation">.</span>isLoading <span class="token operator">!==</span> <span class="token boolean">false</span>  <span class="token operator">&amp;&amp;</span> <span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> _params <span class="token operator">=</span> <span class="token punctuation">{</span>
        token<span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>token<span class="token punctuation">,</span>
        AppID<span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppID<span class="token punctuation">,</span>
        sourceType<span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>platform
    <span class="token punctuation">}</span>
    <span class="token comment">// 默默登录时候，需要这两个参数</span>
    request<span class="token punctuation">.</span>oldParams <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">;</span>
    request<span class="token punctuation">.</span>oldURL <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;GET&#39;</span> <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// fits get接口的数据，属性要用Data[id]=1111&amp;Data[text]这个格式才能请求成功</span>
        <span class="token keyword">let</span> url<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
        url <span class="token operator">+=</span> <span class="token string">&#39;?&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            url <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Data[&#39;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&#39;]&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
        request<span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 公司的接口post的数据要包裹在 Data对象里面。</span>

       <span class="token comment">// 为了解决重试几次接口之后，Data对象不断被重复包裹，所以要加一层判断，如果一旦存在之后，不在再包裹一层</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> _data <span class="token operator">=</span> <span class="token punctuation">{</span> Data<span class="token operator">:</span> request<span class="token punctuation">.</span>data <span class="token punctuation">}</span>
            request<span class="token punctuation">.</span>data <span class="token operator">=</span> _data
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// console.log(request)</span>
    <span class="token comment">// 将token、APPid等信息合并到原来params上面</span>
    request<span class="token punctuation">.</span>params <span class="token operator">=</span> _params
    <span class="token function">addPending</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关键代码:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  url <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token string">&#39;Data[&#39;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&#39;]&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>为什么要组装get的参数，是因为公司要求get的参数要被Data[]包住。这样拼接成URL转换，放到URL的属性上面，在浏览器上的network上能看到没有转义的中括号的参数。如果直接放到Parman里面，则会在谷歌上看到转义后的乱码参数 <img src="/fitsadmin-docs/images/20220823045745.png" alt="图 3"></p><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2><ol><li><a href="https://zhuanlan.zhihu.com/p/133739952" target="_blank" rel="noopener noreferrer">Angular与Rxjs学习<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://segmentfault.com/a/1190000020210980" target="_blank" rel="noopener noreferrer">axios如何利用promise无痛刷新token<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://segmentfault.com/a/1190000023073514" target="_blank" rel="noopener noreferrer">axios拦截重复请求<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://segmentfault.com/a/1190000027078266" target="_blank" rel="noopener noreferrer">一套全面又有实际意义的axios封装+api管理方案<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2023/7/5 03:00:45</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 374348532@qq.com">caoguanjie</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/fitsadmin-docs/guide/cross-domin.html" class="nav-link prev" aria-label="浏览器跨域处理"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->浏览器跨域处理</div></a><a href="/fitsadmin-docs/guide/iconfont.html" class="nav-link next" aria-label="Svg图标"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">Svg图标<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">广东丰德科技有限公司 | Copyright © 软件事业部 前端框架组</div><!----></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/fitsadmin-docs/assets/app.5dd2b556.js" defer></script>
  </body>
</html>
