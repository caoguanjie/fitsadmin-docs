<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://192.168.32.60:8080/fitsadmin-docs/guide/memory-leak.html"><meta property="og:site_name" content="FitsAdmin"><meta property="og:title" content="内存泄露（memory leak）"><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-07-07T10:54:00.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="caoguanjie"><meta property="article:published_time" content="2023-06-19T00:00:00.000Z"><meta property="article:modified_time" content="2023-07-07T10:54:00.000Z"><link rel="icon" href=" /fitsadmin-docs/images/favicon.ico"><title>内存泄露（memory leak） | FitsAdmin</title><meta name="description" content="基于vue3-element-admin为模板的前端框架">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/fitsadmin-docs/assets/style.683853ee.css">
    <link rel="modulepreload" href="/fitsadmin-docs/assets/app.5dd2b556.js"><link rel="modulepreload" href="/fitsadmin-docs/assets/clientConfigs.7ea3e47f.js"><link rel="modulepreload" href="/fitsadmin-docs/assets/memory-leak.html.3ca0aa0c.js"><link rel="modulepreload" href="/fitsadmin-docs/assets/memory-leak.html.e80757e1.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/fitsadmin-docs/" class="brand"><img class="logo" src="/fitsadmin-docs/images/logo.png" alt="FitsAdmin"><!----><span class="site-name hide-in-pad">FitsAdmin</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/fitsadmin-docs/guide/quickstart.html" class="nav-link active" aria-label="指南"><!---->指南<!----></a></div><div class="nav-item hide-in-mobile"><a href="/fitsadmin-docs/components/about.html" class="nav-link" aria-label="组件"><!---->组件<!----></a></div><div class="nav-item hide-in-mobile"><a href="/fitsadmin-docs/resources/" class="nav-link" aria-label="资源"><!---->资源<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="生态系统"><span class="title"><!---->生态系统</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架相关</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://192.168.32.60:3002/" rel="noopener noreferrer" target="_blank" aria-label="FitsAdminV2" class="nav-link"><!---->FitsAdminV2<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="http://192.168.32.108:3000/" rel="noopener noreferrer" target="_blank" aria-label="Yapi接口管理" class="nav-link"><!---->Yapi接口管理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="/fitsadmin-docs/resources/encrypt.html" class="nav-link" aria-label="项目的SVN地址"><!---->项目的SVN地址<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>官方库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://cn.vuejs.org/" rel="noopener noreferrer" target="_blank" aria-label="Vue3.x" class="nav-link"><!---->Vue3.x<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://pinia.vuejs.org/" rel="noopener noreferrer" target="_blank" aria-label="Pinia" class="nav-link"><!---->Pinia<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://cn.vitejs.dev/" rel="noopener noreferrer" target="_blank" aria-label="Vite" class="nav-link"><!---->Vite<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://vueuse.org/" rel="noopener noreferrer" target="_blank" aria-label="VueUse" class="nav-link"><!---->VueUse<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://router.vuejs.org/zh/" rel="noopener noreferrer" target="_blank" aria-label="Vue Router" class="nav-link"><!---->Vue Router<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://element-plus.org/zh-CN/#/zh-CN" rel="noopener noreferrer" target="_blank" aria-label="Element Plus" class="nav-link"><!---->Element Plus<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>优秀案例</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://vue-admin-beautiful.com/vue-admin-beautiful-element/?hmsr=github&amp;hmpl=&amp;hmcu=&amp;hmkw=&amp;hmci=#/index" rel="noopener noreferrer" target="_blank" aria-label="vue-admin-better" class="nav-link"><!---->vue-admin-better<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://vue-admin-beautiful.com/admin-plus/#/index" rel="noopener noreferrer" target="_blank" aria-label="Vue Admin plus" class="nav-link"><!---->Vue Admin plus<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://panjiachen.github.io/vue-element-admin/" rel="noopener noreferrer" target="_blank" aria-label="vue-element-admin" class="nav-link"><!---->vue-element-admin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="http://vue3.youlai.tech/" rel="noopener noreferrer" target="_blank" aria-label="vue3-element-admin" class="nav-link"><!---->vue3-element-admin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="http://192.168.32.108:8012/#/" rel="noopener noreferrer" target="_blank" aria-label="Fits知识库" class="nav-link"><!---->Fits知识库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="http://192.168.32.60:3001/" rel="noopener noreferrer" target="_blank" aria-label="Demo演示" class="nav-link"><!---->Demo演示<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/caoguanjie/fitsadmin-docs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">基础</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/fitsadmin-docs/guide/quickstart.html" class="nav-link sidebar-link sidebar-page" aria-label="介绍"><!---->介绍<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/layout.html" class="nav-link sidebar-link sidebar-page" aria-label="布局"><!---->布局<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/router-and-nav.html" class="nav-link sidebar-link sidebar-page" aria-label="路由和侧边栏"><!---->路由和侧边栏<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/permission.html" class="nav-link sidebar-link sidebar-page" aria-label="权限验证"><!---->权限验证<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/tags-view.html" class="nav-link sidebar-link sidebar-page" aria-label="快捷导航(标签栏导航)"><!---->快捷导航(标签栏导航)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/new-page.html" class="nav-link sidebar-link sidebar-page" aria-label="新增页面"><!---->新增页面<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/style.html" class="nav-link sidebar-link sidebar-page" aria-label="样式"><!---->样式<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/server.html" class="nav-link sidebar-link sidebar-page" aria-label="与服务端交互"><!---->与服务端交互<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/mock-data.html" class="nav-link sidebar-link sidebar-page" aria-label="Mock Data"><!---->Mock Data<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/import.html" class="nav-link sidebar-link sidebar-page" aria-label="外部导入模块"><!---->外部导入模块<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/deploy.html" class="nav-link sidebar-link sidebar-page" aria-label="构建和发布"><!---->构建和发布<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/piniajs.html" class="nav-link sidebar-link sidebar-page" aria-label="Pinia状态管理"><!---->Pinia状态管理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/style-guide.html" class="nav-link sidebar-link sidebar-page" aria-label="风格指南"><!---->风格指南<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">进阶</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/fitsadmin-docs/guide/monorepo.html" class="nav-link sidebar-link sidebar-page" aria-label="pnpm+changesets的monorepo实践"><!---->pnpm+changesets的monorepo实践<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/wujie.html" class="nav-link sidebar-link sidebar-page" aria-label="微前端wujie"><!---->微前端wujie<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/eslint.html" class="nav-link sidebar-link sidebar-page" aria-label="ESLint"><!---->ESLint<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/elementplus.html" class="nav-link sidebar-link sidebar-page" aria-label="整合Element-Plus"><!---->整合Element-Plus<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/srcAlias.html" class="nav-link sidebar-link sidebar-page" aria-label="路径别名配置"><!---->路径别名配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/auto-imports.html" class="nav-link sidebar-link sidebar-page" aria-label="按需自动导入"><!---->按需自动导入<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/envirmoment.html" class="nav-link sidebar-link sidebar-page" aria-label="多环境配置"><!---->多环境配置<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/cross-domin.html" class="nav-link sidebar-link sidebar-page" aria-label="浏览器跨域处理"><!---->浏览器跨域处理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/http.html" class="nav-link sidebar-link sidebar-page" aria-label="HTTP服务"><!---->HTTP服务<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/iconfont.html" class="nav-link sidebar-link sidebar-page" aria-label="Svg图标"><!---->Svg图标<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/wangEditor.html" class="nav-link sidebar-link sidebar-page" aria-label="wangEditor富文本编辑器"><!---->wangEditor富文本编辑器<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/echart.html" class="nav-link sidebar-link sidebar-page" aria-label="Echarts图表"><!---->Echarts图表<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/keepalive.html" class="nav-link sidebar-link sidebar-page" aria-label="Keepalive页面缓存机制"><!---->Keepalive页面缓存机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/jenkins.html" class="nav-link sidebar-link sidebar-page" aria-label="Jenkins自动部署"><!---->Jenkins自动部署<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active"><!----><span class="title">其他</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/fitsadmin-docs/guide/function-list.html" class="nav-link sidebar-link sidebar-page" aria-label="功能清单"><!---->功能清单<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/svn.html" class="nav-link sidebar-link sidebar-page" aria-label="svn设置忽略文件"><!---->svn设置忽略文件<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="内存泄露（memory leak）"><!---->内存泄露（memory leak）<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#什么是js内存泄露" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="什么是JS内存泄露"><!---->什么是JS内存泄露<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#vue3几种导致内存增加的方式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="vue3几种导致内存增加的方式"><!---->vue3几种导致内存增加的方式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#如何调试和定位内存泄露" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="如何调试和定位内存泄露"><!---->如何调试和定位内存泄露<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#内存工具栏面板说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="内存工具栏面板说明"><!---->内存工具栏面板说明<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#快照面板说明" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="快照面板说明"><!---->快照面板说明<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#谷歌浏览器的任务管理器" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="谷歌浏览器的任务管理器"><!---->谷歌浏览器的任务管理器<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#fitsadminv1-0发现的-内存泄露-的情况" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="FitsAdminV1.0发现的“内存泄露”的情况"><!---->FitsAdminV1.0发现的“内存泄露”的情况<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#第一种-所有页面不缓存" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="第一种:所有页面不缓存"><!---->第一种:所有页面不缓存<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#第二种-所有页面缓存" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="第二种:所有页面缓存"><!---->第二种:所有页面缓存<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#如何解决内存泄露" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="如何解决内存泄露"><!---->如何解决内存泄露<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#fitsadmin到底有没有存在内存泄露的情况" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="FitsAdmin到底有没有存在内存泄露的情况？"><!---->FitsAdmin到底有没有存在内存泄露的情况？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#vue-devtools是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Vue Devtools是什么？"><!---->Vue Devtools是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#解决内存泄露的方法是-升级新版本的vue代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="解决内存泄露的方法是：升级新版本的vue代码"><!---->解决内存泄露的方法是：升级新版本的vue代码<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#第二种-所有页面缓存-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="第二种:所有页面缓存"><!---->第二种:所有页面缓存<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#_2023年6月30日发现的内存泄露点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2023年6月30日发现的内存泄露点"><!---->2023年6月30日发现的内存泄露点<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#fitsdialog组件存在内存泄露" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="FitsDialog组件存在内存泄露"><!---->FitsDialog组件存在内存泄露<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#toolbarcustomcolumn组件存在内存泄露" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ToolbarCustomColumn组件存在内存泄露"><!---->ToolbarCustomColumn组件存在内存泄露<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#_2023年7月6日解决teleport组件带来的问题" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2023年7月6日解决Teleport组件带来的问题"><!---->2023年7月6日解决Teleport组件带来的问题<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#旧代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="旧代码"><!---->旧代码<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#修改后的代码" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="修改后的代码"><!---->修改后的代码<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#优化效果" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="优化效果"><!---->优化效果<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#_2023年7月7日" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2023年7月7日"><!---->2023年7月7日<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/micro-frontends.html" class="nav-link sidebar-link sidebar-page" aria-label="微前端架构技术选型"><!---->微前端架构技术选型<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/fitsadmin-docs/guide/CHANGELOG.html" class="nav-link sidebar-link sidebar-page" aria-label="更新日志"><!---->更新日志<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->内存泄露（memory leak）</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" localizeddate="2023年6月19日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">caoguanjie</span></span><span property="author" content="caoguanjie"></span></span><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2023年6月19日</span><meta property="datePublished" content="2023-06-19T00:00:00.000Z"></span><!----><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down" localizeddate="2023年6月19日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 22 分钟</span><meta property="timeRequired" content="PT22M"></span><span class="words-info" aria-label="字数🔠" data-balloon-pos="down" localizeddate="2023年6月19日" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 6508 字</span><meta property="wordCount" content="6508"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#什么是js内存泄露" class="router-link-active router-link-exact-active toc-link level2">什么是JS内存泄露</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#vue3几种导致内存增加的方式" class="router-link-active router-link-exact-active toc-link level2">vue3几种导致内存增加的方式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#如何调试和定位内存泄露" class="router-link-active router-link-exact-active toc-link level2">如何调试和定位内存泄露</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#内存工具栏面板说明" class="router-link-active router-link-exact-active toc-link level3">内存工具栏面板说明</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#快照面板说明" class="router-link-active router-link-exact-active toc-link level3">快照面板说明</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#谷歌浏览器的任务管理器" class="router-link-active router-link-exact-active toc-link level3">谷歌浏览器的任务管理器</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#fitsadminv1-0发现的-内存泄露-的情况" class="router-link-active router-link-exact-active toc-link level2">FitsAdminV1.0发现的“内存泄露”的情况</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#第一种-所有页面不缓存" class="router-link-active router-link-exact-active toc-link level3">第一种:所有页面不缓存</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#第二种-所有页面缓存" class="router-link-active router-link-exact-active toc-link level3">第二种:所有页面缓存</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#如何解决内存泄露" class="router-link-active router-link-exact-active toc-link level2">如何解决内存泄露</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#fitsadmin到底有没有存在内存泄露的情况" class="router-link-active router-link-exact-active toc-link level3">FitsAdmin到底有没有存在内存泄露的情况？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#vue-devtools是什么" class="router-link-active router-link-exact-active toc-link level3">Vue Devtools是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#解决内存泄露的方法是-升级新版本的vue代码" class="router-link-active router-link-exact-active toc-link level3">解决内存泄露的方法是：升级新版本的vue代码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#第二种-所有页面缓存-1" class="router-link-active router-link-exact-active toc-link level3">第二种:所有页面缓存</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#_2023年6月30日发现的内存泄露点" class="router-link-active router-link-exact-active toc-link level2">2023年6月30日发现的内存泄露点</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#fitsdialog组件存在内存泄露" class="router-link-active router-link-exact-active toc-link level3">FitsDialog组件存在内存泄露</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#toolbarcustomcolumn组件存在内存泄露" class="router-link-active router-link-exact-active toc-link level3">ToolbarCustomColumn组件存在内存泄露</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#_2023年7月6日解决teleport组件带来的问题" class="router-link-active router-link-exact-active toc-link level2">2023年7月6日解决Teleport组件带来的问题</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#旧代码" class="router-link-active router-link-exact-active toc-link level3">旧代码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#修改后的代码" class="router-link-active router-link-exact-active toc-link level3">修改后的代码</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#优化效果" class="router-link-active router-link-exact-active toc-link level3">优化效果</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/fitsadmin-docs/guide/memory-leak.html#_2023年7月7日" class="router-link-active router-link-exact-active toc-link level2">2023年7月7日</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="内存泄露-memory-leak" tabindex="-1"><a class="header-anchor" href="#内存泄露-memory-leak" aria-hidden="true">#</a> 内存泄露（memory leak）</h1><h2 id="什么是js内存泄露" tabindex="-1"><a class="header-anchor" href="#什么是js内存泄露" aria-hidden="true">#</a> 什么是JS内存泄露</h2><p><code>JS的内存泄漏</code>指的是在JavaScript程序中，由于一些对象或变量无法被垃圾回收机制正确释放，导致占用的内存无法被回收，从而造成内存的持续增长，最终导致程序运行变慢甚至崩溃的问题。 内存泄漏通常发生在以下情况下：</p><ol><li><code>未及时清除不再使用的对象或变量</code>：如果一个对象或变量不再被程序使用，但没有被正确清除，垃圾回收机制无法识别并回收这部分内存。</li><li><code>循环引用：</code>当两个或多个对象之间存在相互引用，而且这些对象都不再被程序使用时，垃圾回收机制也无法回收它们占用的内存。</li><li><code>定时器未清除：</code>如果在程序中使用了定时器，但在不需要时没有正确清除，定时器会一直占用内存，导致内存泄漏。</li><li><code>闭包未释放：</code>如果在函数内部定义了闭包，并且这个闭包引用了外部函数的变量，而这个闭包没有被正确释放，也会导致内存泄漏。</li></ol><h2 id="vue3几种导致内存增加的方式" tabindex="-1"><a class="header-anchor" href="#vue3几种导致内存增加的方式" aria-hidden="true">#</a> vue3几种导致内存增加的方式</h2><p>在Vue 3中，可能会出现以下几种情况导致内存不断增加：</p><ol><li><code>未正确销毁组件：</code>：在Vue 3中，组件的生命周期钩子函数发生了变化，需要手动调用<code>unmounted</code>函数来销毁组件。如果未正确销毁组件，可能会导致内存泄漏。</li><li><code>大量使用响应式数据：</code>Vue 3中的响应式系统使用了Proxy代理对象，相比Vue 2中的Object.defineProperty，性能更高，但是如果大量使用响应式数据，可能会导致内存占用过高。</li><li><code>频繁创建和销毁组件：</code>如在Vue 3中，组件的创建和销毁比Vue 2更加高效，但是如果频繁创建和销毁组件，可能会导致内存占用过高,例如<code>v-if</code>,<code>v-for</code>。</li><li><code>频繁使用动态组件（component）：</code>在Vue 3中，动态组件的创建和销毁比静态组件更加耗费资源，如果频繁使用动态组件，可能会导致内存占用过高。</li></ol><div class="custom-container warning"><p class="custom-container-title">注意</p><p>框架中使用的<code>src/layout/components/AppMain.vue</code>布局文件，里面的用到<code>v-if</code>和<code>&lt;component :is=&quot;Component&quot; /&gt;</code>都是吃内存的大户，也是影响内存大小的重要因素，但是这个布局是合理需要的，属于正常范围的内存占用，不是内存泄露的主导因素</p></div><p>在以往的vue3项目代码中，有很多前端开发都滥用响应式数据（Proxy代理对象），很多情况下变量的声明是不是需要使用响应式的，使用普通对象即可，但是截止目前代码检查发现，只要命名变量都要赋予它们响应式，这样的话，也会带来内存增加风险，从而导致内存泄露，页面崩溃的结果。Vue3中，<code>ref()</code>、<code>reactive()</code>、<code>toRef()</code>、<code>toRef()</code>、<code>computed()</code>等响应式API可以帮助我们更方便地管理组件的状态和响应式数据。以下是一些需要使用这些API的情况：</p><ol><li><code>需要管理组件的状态：</code>ref可以用来管理组件的状态，可以将一个普通的变量转换为响应式数据，方便在模板<code>&lt;template&gt;</code>中使用。如果你需要管理组件的状态，就需要使用ref,通俗点说，就是如果这个变量是作用于模板<code>&lt;template&gt;</code>里面的任何一个标签的话，是可以采用响应式声明。</li><li><code>需要管理复杂的响应式数据：</code>reactive可以用来管理复杂的响应式数据，可以将一个对象转换为响应式数据，方便在模板中使用。如果你需要管理复杂的响应式数据，就需要使用reactive。</li><li><code>需要将响应式数据转换为普通变量：</code>toRef、toRefs可以将一个响应式数据转换为普通变量，方便在组件中使用。如果你需要将响应式数据转换为普通变量，就需要使用toRef。 总之，如果你需要管理组件的状态、管理复杂的响应式数据或将响应式数据转换为普通变量，就需要使用ref、reactive、toRef等API。否则，可以不使用这些API。</li></ol><h2 id="如何调试和定位内存泄露" tabindex="-1"><a class="header-anchor" href="#如何调试和定位内存泄露" aria-hidden="true">#</a> 如何调试和定位内存泄露</h2><p>这里一般是使用谷歌浏览器（Chrome）的<code>内存工具栏</code>和<code>任务管理器</code>进行调试和定位内存泄露问题，下面简单介绍一下调试的流程</p><h3 id="内存工具栏面板说明" tabindex="-1"><a class="header-anchor" href="#内存工具栏面板说明" aria-hidden="true">#</a> 内存工具栏面板说明</h3><p><img src="/fitsadmin-docs/images/20230619033457.png" alt="图 1"><br> 这里的面板要注意两点内容：</p><ul><li>第一，生成快照，是根据右边的性能分析内容，生成相应的快照，这个快照的大小是临时存放在内存中，生成的快照越多，内存占用越大。</li><li>第二：点击垃圾回收按钮，会马上触发<code>js垃圾回收机制</code>清理多余的符合条件的对象和数组等内容，释放内存。</li></ul><div class="custom-container tip"><p class="custom-container-title">什么是js垃圾回收机制</p><p>JavaScript的垃圾回收机制是一种自动化的内存管理机制，它会自动检测不再使用的对象，并将其从内存中删除，以释放内存空间。垃圾回收机制通过跟踪对象的引用计数来确定哪些对象可以被删除。当一个对象不再被引用时，它的引用计数会减少，当引用计数为0时，该对象就可以被垃圾回收机制删除。JavaScript的垃圾回收机制可以帮助开发人员避免手动管理内存，从而提高开发效率和代码质量。JavaScript的垃圾回收机制是自动触发的，它会在特定的时机自动运行。具体来说，垃圾回收机制会在以下情况下触发：</p><ul><li>当内存达到一定阈值时：JavaScript引擎会设置一个内存阈值，当内存使用量超过这个阈值时，就会触发垃圾回收机制。</li><li>当程序空闲时：JavaScript引擎会在程序空闲时触发垃圾回收机制，这样可以避免影响程序的性能。</li><li>当程序退出时：当程序退出时，JavaScript引擎会自动运行垃圾回收机制，以释放所有未使用的内存。 总之，JavaScript的垃圾回收机制是自动触发的，它会在特定的时机自动运行，以释放未使用的内存，但是我们也可以通过内存工具栏进行手动触发</li></ul></div><h3 id="快照面板说明" tabindex="-1"><a class="header-anchor" href="#快照面板说明" aria-hidden="true">#</a> 快照面板说明</h3><p><img src="/fitsadmin-docs/images/20230619034836.png" alt="图 2"></p><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>在Chrome的内存工具栏中，</p><ul><li>浅层大小（Shallow Size）指的是一个对象本身占用的内存大小，不包括其引用的其他对象占用的内存。</li><li>保留大小（Retained Size）则是指一个对象及其引用的其他对象占用的总内存大小。保留大小可以更好地反映一个对象对整个程序内存占用的影响，因为它考虑了对象之间的引用关系。例如，一个对象引用了其他对象，即使这些被引用的对象本身占用的内存很小，但是它们被引用后会被保留在内存中，因此对整个程序的内存占用也会有影响。</li><li><code>(closure)</code>代表了闭包代码占用了内存的大小</li></ul></div><h3 id="谷歌浏览器的任务管理器" tabindex="-1"><a class="header-anchor" href="#谷歌浏览器的任务管理器" aria-hidden="true">#</a> 谷歌浏览器的任务管理器</h3><h4 id="window" tabindex="-1"><a class="header-anchor" href="#window" aria-hidden="true">#</a> Window</h4><p><img src="/fitsadmin-docs/images/20230619035425.png" alt="图 3"></p><h4 id="macos" tabindex="-1"><a class="header-anchor" href="#macos" aria-hidden="true">#</a> MacOS</h4><p><img src="/fitsadmin-docs/images/20230619035453.png" alt="图 4"></p><p>这里的任务管理器能详细的看到浏览器中每个选项卡的内存占用情况，但是要注意一点的是，开启了F12开发者模式后，看到内存工具栏的内存<code>js堆大小</code>占用的内存大小不等于任务管理器的内存占用大小。因为任务管理器中的大小还要包括浏览器执行当前页面的js时需要部份内存，所以任务管理器的内存大小要比内存工具栏看到的内存大小要略大一点。</p><p><img src="/fitsadmin-docs/images/20230619035948.png" alt="图 5"></p><h2 id="fitsadminv1-0发现的-内存泄露-的情况" tabindex="-1"><a class="header-anchor" href="#fitsadminv1-0发现的-内存泄露-的情况" aria-hidden="true">#</a> FitsAdminV1.0发现的“内存泄露”的情况</h2><div class="custom-container note"><p class="custom-container-title">注</p><p>FitsAdminV1.0的涉及的版本如下： vue: v3.2.37 vite: v2.9.7</p></div><p>为了调试内存是否真的泄露，我简单写了一个组件，组件内声明了一个约<code>80MB</code>大小的变量。后面都以这个测试组件进行内存的测试</p><details class="custom-container details"><summary>一个80m的测试组件</summary><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>组件view<span class="token operator">&lt;</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;myname&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&#39;TableView&#39;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span> setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue-router&#39;</span><span class="token punctuation">;</span>

<span class="token comment">//大概80mb</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span><span class="token number">20000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> myname <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    myname<span class="token punctuation">.</span>value <span class="token operator">=</span> route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>name
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="第一种-所有页面不缓存" tabindex="-1"><a class="header-anchor" href="#第一种-所有页面不缓存" aria-hidden="true">#</a> 第一种:所有页面不缓存</h3><p>按正常情况下，所有页面不缓存的话，从第一个页面跳转到第二个页面的时候，第一个页面一段时间后会触发js垃圾回收机制，会清掉第一个页面的80m内存占用。但是实际测试的情况就是，第一个页面和第二页面的内存同时占用了80m内存，并没有按理想的情况回收80m</p><p><video width="100%" muted="" controls autoplay loop><source src="/fitsadmin-docs/images/QQ20230619-164441-HD.mp4" type="video/mp4"></video></p><p>由上面视频可以看出，每次生成一个测试组件<code>TableView.vue</code>，都会给内存增加80m，而且主动调用js垃圾回收机制，页面占用的内存也没有回收，此时也可以初步判断是，测试组件里面的变量产生了内存泄露。</p><h3 id="第二种-所有页面缓存" tabindex="-1"><a class="header-anchor" href="#第二种-所有页面缓存" aria-hidden="true">#</a> 第二种:所有页面缓存</h3><p>按理论来看，页面缓存所占用的内存是一定大于没有缓存的，因为被缓存的组件是不会被js垃圾回收的，它会一直占用内存，所以当页面多且组件占用内存大的情况的项目，通常是页面缓存和不缓存混合存在的，全局设置页面缓存风险会高点。</p><p><video width="100%" muted="" controls autoplay loop><source src="/fitsadmin-docs/images/QQ20230619-174601-HD.mp4" type="video/mp4"></video></p><p>从上面视频可以看出，每次生成的新的测试组件，主动点了垃圾清理，也不会被回收，导致页面内存越来越大。</p><h2 id="如何解决内存泄露" tabindex="-1"><a class="header-anchor" href="#如何解决内存泄露" aria-hidden="true">#</a> 如何解决内存泄露</h2><h3 id="fitsadmin到底有没有存在内存泄露的情况" tabindex="-1"><a class="header-anchor" href="#fitsadmin到底有没有存在内存泄露的情况" aria-hidden="true">#</a> FitsAdmin到底有没有存在内存泄露的情况？</h3><p>我在vue的官方github库中<a href="https://github.com/vuejs/core/issues/6591#issuecomment-1259161408" target="_blank" rel="noopener noreferrer">issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>找到了答案, Vue3创造者尤雨溪回复：</p><p><img src="/fitsadmin-docs/images/20230619055850.png" alt="图 6"></p><p>按他说的话，通俗点翻译就是，他们并没有泄露，只是当前组件有可能对上一个组件有引用关系，导致了上一个组件并没有被回收，这个的确占用了一定的内存。</p><p>但是他被自己打脸了，事实上，他这种引用方式，的确造成了内存的泄露，他自己也回复了：</p><p><img src="/fitsadmin-docs/images/20230619060238.png" alt="图 7"></p><div class="custom-container danger"><p class="custom-container-title">结论</p><p>就是vue3.2.x的确是存在内存泄露的情况，无论是开发环境还是生产环境，但是内存泄露不是vue框架代码引起的，而是vue代码的测试工具Vue Devtools引起的。</p></div><h3 id="vue-devtools是什么" tabindex="-1"><a class="header-anchor" href="#vue-devtools是什么" aria-hidden="true">#</a> Vue Devtools是什么？</h3><p>Vue Devtools是一款用于Vue.js开发的浏览器扩展程序，它可以帮助开发人员更方便地调试和分析Vue.js应用程序。Vue Devtools可以在浏览器中显示Vue.js组件树、数据、事件和生命周期等信息，还可以实时监测Vue.js应用程序的状态变化，方便开发人员进行调试和优化。Vue Devtools支持Chrome、Firefox和Edge等主流浏览器，可以通过Chrome Web Store、Firefox Add-ons和Microsoft Edge Add-ons等渠道进行下载和安装。</p><p>Vue Devtools的代码能够调试Vue的代码，其原理是通过与Vue应用程序进行通信来获取应用程序的状态和行为信息。具体来说，Vue Devtools会与Vue应用程序建立一个通信通道，通过这个通道可以获取Vue应用程序的组件树、数据、事件和生命周期等信息。当开发人员在浏览器中使用Vue Devtools时，它会通过这个通道与Vue应用程序进行交互，从而实现调试功能。</p><p>在Vue应用程序中，开发人员可以通过在代码中添加相关的配置来启用Vue Devtools的通信功能。一旦启用，Vue Devtools就可以与Vue应用程序建立通信通道，并获取应用程序的状态和行为信息。通过这个通道，Vue Devtools可以实时监测Vue应用程序的状态变化，并在浏览器中显示相关的调试信息。</p><p>总之，Vue Devtools的代码能够调试Vue的代码，其原理是通过与Vue应用程序进行通信来获取应用程序的状态和行为信息。这种通信机制可以帮助开发人员更方便地调试和分析Vue应用程序。</p><h3 id="解决内存泄露的方法是-升级新版本的vue代码" tabindex="-1"><a class="header-anchor" href="#解决内存泄露的方法是-升级新版本的vue代码" aria-hidden="true">#</a> 解决内存泄露的方法是：升级新版本的vue代码</h3><p>将框架的<code>vue@3.2.37</code>版本升级到截止文档发布之前最新的版本<code>vue@3.2.47 (2023-02-02)</code>, <a href="https://github.com/vuejs/core/blob/main/changelogs/CHANGELOG-3.2.md" target="_blank" rel="noopener noreferrer">vue3.2官方版本更新说明<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>上面说的Vue Devtools引起的内存泄露的问题，在版本<code>3.2.41 (2022-10-14)</code>已经修复了</p><p><img src="/fitsadmin-docs/images/20230619061444.png" alt="图 8"></p><p>在终端输入命令,即可以解决问题：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i vue@3.2.47
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>升级完vue的版本之后，我们继续来测试一下。</p><h4 id="第一种-所有页面不缓存-1" tabindex="-1"><a class="header-anchor" href="#第一种-所有页面不缓存-1" aria-hidden="true">#</a> 第一种:所有页面不缓存</h4><p><video width="100%" muted="" controls autoplay loop><source src="/fitsadmin-docs/images/QQ20230619-182629-HD.mp4" type="video/mp4"></video></p><p>从上面视频可以看出，升级vue的版本之后，内存增加的过程如下：</p><ol><li>生成第一个内存快照是：初始首页，固定占用22.8m的内存</li><li>当加载路径<code>/table/1</code>的时候，会生成第一个测试组件，此时点击生成第二个快照，此时内存占用103m，这个是初始22.8m，加上此时显示的第一个组件的内存。</li><li>这个时候加载路径<code>/table/2</code>，生成第二个测试组件，内存马上增加了多80m，达到了183m左右，我此时主动点击了js垃圾回收按钮，这个时候内存占用下降到100m左右，此时点击生成第三次快照，你会发现第二次和第三次的快照都是103m，证明第一个页面的测试组件所占用的80m已经被浏览器回收了，并且释放了。后面几次操作都是反复验证这个问题。</li></ol><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>上面我为什么不录浏览器的任务管理器的内存占用情况？从上面的理论知识打底后，我们已经明确知道了，内存工具的<code>垃圾桶</code>图标就是主动触发js回收机制的调试工具，js垃圾回收是需要一定的时机的，为了更快让大家提现效果，所以采取了主动触发的方式。从上面的理论知识我们也可以知道，当我们测试在频繁切换页面是，内存是会一直增加的，那会不会最终也会页面崩溃呢？理论上是不会的，因为如果已经验证了消失的页面是可以被回收的话，当内存增加到一定程度的话，会触发垃圾回收机制，就不会出现崩溃的情况，之前项目出现崩溃的情况，更多是内存一直在增加，缺没有被回收，内存低的时候，就发生了崩溃现象。</p></div><h3 id="第二种-所有页面缓存-1" tabindex="-1"><a class="header-anchor" href="#第二种-所有页面缓存-1" aria-hidden="true">#</a> 第二种:所有页面缓存</h3><p><video width="100%" muted="" controls autoplay loop><source src="/fitsadmin-docs/images/QQ20230619-185041-HD.mp4" type="video/mp4"></video></p><p>从上面的视频可以看出来，被缓存的测试组件，再怎么触发都不会被回收，因为这个组件都被<code>keepalive</code>组件缓存下来的，并不会消失。</p><div class="custom-container tip"><p class="custom-container-title">总结</p><ol><li>如果解决了内存泄露的问题后，项目组中使用全局组件缓存的方案不可取了，因为内存还是会因为你新开多少个页签就新增多少m固定的内存占用。后续各个项目组的前端开发最好根据项目组需要的复杂页面进行缓存，提高性能，对于一些简单的页面不采用缓存，不然会导致页面崩溃的情况</li><li>项目已出现内存泄露的问题后，前端开发者，按照下面步骤进行升级即可解决问题： <ul><li>先执行命令：<code>npm i vue@3.2.47</code></li><li>把项目中的<code>package-lock.json</code>文件删掉</li><li>再执行<code>npm install</code>命令重新生成<code>package-lock.json</code></li></ul></li></ol></div><h2 id="_2023年6月30日发现的内存泄露点" tabindex="-1"><a class="header-anchor" href="#_2023年6月30日发现的内存泄露点" aria-hidden="true">#</a> 2023年6月30日发现的内存泄露点</h2><p>原本以为解决了vue的版本问题就能解决内存泄露的，但是我在项目中更新之后，发现结果并没有按照我们想象的想法来，内存并没有释放多少，虽然有减少，但是提升有限 于是我开始进行漫长的排查内存泄露的原因过程。下面直接说结果，找寻的过程就不做过多的赘叙了。</p><h3 id="fitsdialog组件存在内存泄露" tabindex="-1"><a class="header-anchor" href="#fitsdialog组件存在内存泄露" aria-hidden="true">#</a> FitsDialog组件存在内存泄露</h3><p>起因是在<code>element-plus</code>的<code>issues</code>看到一篇文章：<a href="https://github.com/element-plus/element-plus/issues/8972" target="_blank" rel="noopener noreferrer">Component-dialog dialog组件导致内存泄漏 #8972<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>看完文章之后发现这个内存泄露的根本原因是：vue的内置组件<code>Teleport</code>导致的，在vue的github的<code>issues</code>,也有相应的文章<a href="https://github.com/vuejs/core/issues/6347" target="_blank" rel="noopener noreferrer">The onUnmounted callback is not triggered when using Teleport #6347<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。大体的意思就是：包裹在<code>Teleport</code>组件里面的组件，无法正常调用销毁钩子函数<code>onUnmounted</code>导致了组件无法正常销毁。</p><p>有上面的证据作为理论进行分析的话，大概就是如果弹窗组件<code>FitsDialog</code>组件在页面切换之后，没有正确进行销毁，于是弹窗组件就被缓存在内存了，由于弹窗组件的上层组件是列表组件的页面，弹窗和列表组件存在父子关系，会导致整个列表页面被缓存下来，此时占用的内存无法被正常回收，一定程度导致了内存过高。</p><div class="custom-container warning"><p class="custom-container-title">总结</p><p>截止到vue的版本v3.2.47，依然没有解决这个问题。后面前端开发如果要利用element-plus的<code>el-dialog</code>组件的时候，或者vue的<code>Teleport</code>要注意这个影响。</p></div><h4 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法" aria-hidden="true">#</a> 解决方法</h4><p>在<code>element-plus</code>的<code>issues</code>的帖子中有个临时的方法，给<code>el-dialog</code>加上<code>append-to-body</code>属性，在一定程度解决这个问题，实践之后，我发现加上属性之后，其实就是没有再使用vue<code>Teleport</code>组件了,会直接把弹窗组件的dom节点插入到body结束标签的上面，从而达到释放内存的效果。</p><p>因此 <code>FitsDialog</code>组件要修改的内容如下：</p><p>1.给<code>el-dialog</code>组件加上<code>append-to-body</code>,其他地方的代码不用动</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>elDialogRef<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>props.class ? props.class + <span class="token punctuation">&#39;</span> fits-dialog<span class="token punctuation">&#39;</span> : <span class="token punctuation">&#39;</span>fits-dialog<span class="token punctuation">&#39;</span><span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">:close-on-click-modal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogProp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isVisible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">append-to-body</span>
            <span class="token attr-name">:top</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>props.dialogProp.top ? props.dialogProp.top : dialogMarginTop<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>emitcancel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
           
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>调整弹窗的高度计算方法，让弹窗居中偏上的位置显示</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 这里的代码主要是，当弹窗内容超过540的高度的时候，自动居中
 * 当弹窗内容低于540高度的时候，marginTop: -10vh。也能达到大概居中的目的
 */</span>
<span class="token keyword">function</span> <span class="token function">updatedWindowHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 实际弹窗部分</span>
    <span class="token keyword">const</span> dialogWindowHeight <span class="token operator">=</span> elDialogRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>dialogContentRef<span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height
    <span class="token comment">// 黑色阴影的div</span>
    <span class="token keyword">const</span> dialogWrapWindowHeight <span class="token operator">=</span> elDialogRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>dialogContentRef<span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>$parent<span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 下面是旧代码
     if (dialogWindowHeight &gt; 540) <span class="token punctuation">{</span>
         dialogMarginTop.value = &quot;0&quot;;
     <span class="token punctuation">}</span> else <span class="token punctuation">{</span>
         dialogMarginTop.value = dialogWrapWindowHeight &lt; 540 ? &quot;20px&quot; : &quot;-10vh&quot;;
     <span class="token punctuation">}</span>
     */</span>
    
    <span class="token comment">// 下面是调整之后的代码</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dialogWindowHeight <span class="token operator">&gt;</span> dialogWrapWindowHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dialogMarginTop<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 第一个2是为了弹框居中，第二个2是了弹框处于居中再上一半的距离，因为人的视线是在窗口的中部以上的位置，</span>
        dialogMarginTop<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">(</span>dialogWrapWindowHeight <span class="token operator">-</span> dialogWindowHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token string">&#39;px&#39;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="toolbarcustomcolumn组件存在内存泄露" tabindex="-1"><a class="header-anchor" href="#toolbarcustomcolumn组件存在内存泄露" aria-hidden="true">#</a> ToolbarCustomColumn组件存在内存泄露</h3><p>这个组件主要用于列表的工具栏，控制表格的排列的顺序和显示隐藏的组件，解决上面的<code>FitsDialog</code>组件的内存泄露问题，不解决这个组件，你会发现，页面一样没有减少内存，我也是排查好久，很难才能重新出来这个关联关系的</p><p>其实不是这个组件存在问题，根本原因出现在<code>el-popover</code>，看到这个组件，就让我联想到上面的<code>el-dialog</code>都是弹窗式的组件，很难不让我不怀疑根本原因，是不是归根到底还是<code>vue</code>的内置组件<code>Teleport</code>惹得祸呢？</p><p>这个问题也在在<code>element-plus</code>的<code>issues</code>中找到相关讨论：<a href="https://github.com/element-plus/element-plus/issues/6378" target="_blank" rel="noopener noreferrer">[Component] [popover] el-popover content won&#39;t be destroyed with :teleported=&quot;false&quot; #6378<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。果不其然啊，根据简单dom的结构和<code>el-popover</code>开放出来的api来看，这个弹窗组件也是利用了<code>Teleport</code>组件，因此那里用到了<code>el-popover</code>、<code>el-dialog</code>这两个组件，都会缓存它们的父级组件，从而导致了页面在切换过程中，本该会销毁掉的页面，缺错过了销毁阶段，占用的内存也得不到释放</p><h4 id="解决办法" tabindex="-1"><a class="header-anchor" href="#解决办法" aria-hidden="true">#</a> 解决办法</h4><p>给<code>el-popover</code>组件增加<code>:teleported=&quot;false&quot;</code>的属性，这个属性在文档中有说明：<code>当 popover 组件长时间不触发且 persistent 属性设置为 false 时, popover 将会被删除</code></p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-popover</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popoverRef<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:persistent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-popover</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container danger"><p class="custom-container-title">注意</p><p><code>:persistent=&quot;false&quot;</code>是有缺陷的，官网说的很清楚，只有长时间不触发才会，释放内存，但是如果你在刚进来页面就点击了这个弹框，就会激发了，这个时候内存是不会释放的，并且研究证明，这个popover组件并没有类似<code>el-dialog</code>组件那样<code>append-to-body</code>方式，能配置不使用<code>Teleport</code>组件。</p></div><p>由上面两个组件就可以分析，受<code>Teleport</code>组件影响的组件就太多了，例如</p><ul><li><code>el-select</code></li><li><code>el-date-picker</code></li><li><code>el-cascader</code>级联选择器</li></ul><p>根据<code>vue/core</code>github上面issue的方案，修改组件的源码，也无法正常解决。</p><p><img src="/fitsadmin-docs/images/20230703044056.png" alt="图 8"></p><p>截止7月3日之前，内存泄露问题没有很好的方案可以解决，在没有vue官方团队没有修复bug之前，还是采用全局页面缓存的方式最合适，至少不会因为页面左右切换导致不断有新的内存泄露产生。</p><h2 id="_2023年7月6日解决teleport组件带来的问题" tabindex="-1"><a class="header-anchor" href="#_2023年7月6日解决teleport组件带来的问题" aria-hidden="true">#</a> 2023年7月6日解决<code>Teleport</code>组件带来的问题</h2><p>在上面的排查过程中，我们很明确知道vue3的<code>Teleport</code>组件有明显的内存泄露问题，在没有得到官方修复的消息之前，我们还是得解决问题的。</p><p>经过一系列对vue3源码的理解，我对vue的源码进行的修复，经过实践，修复的代码可取，能直接解决内存泄露的问题。</p><h3 id="旧代码" tabindex="-1"><a class="header-anchor" href="#旧代码" aria-hidden="true">#</a> 旧代码</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 路径：src/components/Teleport.ts</span>
<span class="token keyword">const</span> <span class="token function-variable function">isTeleportDisabled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>disabled <span class="token operator">||</span> props<span class="token punctuation">.</span>disabled <span class="token operator">===</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>doRemove <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isTeleportDisabled</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">hostRemove</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shapeFlag <span class="token operator">&amp;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">unmount</span><span class="token punctuation">(</span>
          child<span class="token punctuation">,</span>
          parentComponent<span class="token punctuation">,</span>
          parentSuspense<span class="token punctuation">,</span>
          <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token operator">!</span><span class="token operator">!</span>child<span class="token punctuation">.</span>dynamicChildren
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改后的代码" tabindex="-1"><a class="header-anchor" href="#修改后的代码" aria-hidden="true">#</a> 修改后的代码</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>doRemove <span class="token operator">&amp;&amp;</span> <span class="token function">hostRemove</span><span class="token punctuation">(</span>anchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>shapeFlag <span class="token operator">&amp;</span> <span class="token number">16</span> <span class="token comment">/* ShapeFlags.ARRAY_CHILDREN */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> shouldRemove <span class="token operator">=</span> doRemove <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isTeleportDisabled</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> child <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">unmount</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> shouldRemove<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token operator">!</span>child<span class="token punctuation">.</span>dynamicChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container info"><p class="custom-container-title">相关信息</p><p>为什么修改这里呢？我们以el-dialog的例子来测试</p></div><p>当我们使用apeendToBody的时候，传给isTeleportDisabled的props如图，props里面的disabled属性为false，可以参考</p><p><img src="/fitsadmin-docs/images/20230707041807.png" alt="图 0"></p><p>当没有使用appendToBody的时候，props里面的disabled为true，导致isTeleportDisabled判断为true，导致无法执行umount</p><p><img src="/fitsadmin-docs/images/20230707041830.png" alt="图 1"></p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>我已经优化的源码上传到<a href="https://github.com/caoguanjie/vue3-runtime-core" target="_blank" rel="noopener noreferrer">github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, 想要调整项目代码的前端开发们，可以执行命令：<code>npm i https://github.com/caoguanjie/vue3-runtime-core</code>即可完成代码的替换 不过要注意，我优化的版本是v3.2.47，不同版本的，请升级到这个版本。这个版本上面已经说过解决了vue Devtools产生的泄露问题。</p></div><h3 id="优化效果" tabindex="-1"><a class="header-anchor" href="#优化效果" aria-hidden="true">#</a> 优化效果</h3><blockquote><p>要说明一点，下面视频是模拟每开一个tabs页面就增加80m左右的内存，至于优化固定90m是因为第一个tab的缓存永远的清除不了，这个是调试开发时vue devtools的bug，在生产环境上不会出现。</p></blockquote><h4 id="优化之前" tabindex="-1"><a class="header-anchor" href="#优化之前" aria-hidden="true">#</a> 优化之前</h4><p><video width="100%" muted="" controls autoplay loop><source src="/fitsadmin-docs/images/old.mp4" type="video/mp4"></video></p><h4 id="优化之后" tabindex="-1"><a class="header-anchor" href="#优化之后" aria-hidden="true">#</a> 优化之后</h4><p><video width="100%" muted="" controls autoplay loop><source src="/fitsadmin-docs/images/new.mp4" type="video/mp4"></video></p><h2 id="_2023年7月7日" tabindex="-1"><a class="header-anchor" href="#_2023年7月7日" aria-hidden="true">#</a> 2023年7月7日</h2><p>做完上面所有操作后，我同步到框架demo的项目里面，发现框架中的用户管理还是存在泄露情况。</p><p><img src="/fitsadmin-docs/images/20230707043536.png" alt="图 2"></p><p>排查到内存泄露的原因是： vxe-table的搜索区域用了<code>el-select</code>这个渲染器</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">&#39;tap&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;用户标签&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">itemRender</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ElSelect&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// multiple: true,</span>
            <span class="token literal-property property">collapseTags</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">collapseTagsTooltip</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">clearable</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;项目私立&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进一步我们排查到<code>/src/utils/base/VXETablePluginElement.ts</code>这个文件的渲染器</p><p><img src="/fitsadmin-docs/images/20230707050318.png" alt="图 3"></p><p>为了排查内存泄露情况，我又简单写了个<a href="/images/vue-project.zip" target="_blank" rel="noopener noreferrer">例子<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，证明了vxe-table集成element-plus的渲染器是不会发生泄露的，可能在复杂的业务里面还有其他影响因素，我还没有排查出来的，因此后续有时间我还会继续排查下去的，毕竟我的例子和项目，打包环境和其他依赖并不完全相同，只有vue的版本保持一致而已，后续等框架继续更新，我再排查情况。</p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2023/7/7 10:54:00</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 374348532@qq.com">caoguanjie</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/fitsadmin-docs/guide/svn.html" class="nav-link prev" aria-label="svn设置忽略文件"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->svn设置忽略文件</div></a><a href="/fitsadmin-docs/guide/micro-frontends.html" class="nav-link next" aria-label="微前端架构技术选型"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">微前端架构技术选型<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">广东丰德科技有限公司 | Copyright © 软件事业部 前端框架组</div><!----></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/fitsadmin-docs/assets/app.5dd2b556.js" defer></script>
  </body>
</html>
